<!doctype html>
<html lang="en" class="no-js">
<head>
  <title>PrintJS</title>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <script type="text/javascript" src="http://code.jquery.com/jquery-1.6.2.min.js"></script>
  <script type="text/javascript" src="/static/javascripts/jquery.base64.js"></script>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
   <script src="http://cdn.socket.io/stable/socket.io.js"></script>
  <script>WEB_SOCKET_SWF_LOCATION = 'http://cdn.socket.io/stable/WebSocketMain.swf';</script>
  
  <style>

   
  </style>
  
  <script src="/static/javascripts/preso-dnd-lib.js"></script>
  <script src="/static/javascripts/thingiview/javascripts/Three.js"></script>
  <script src="/static/javascripts/thingiview/javascripts/plane.js"></script>
  <script src="/static/javascripts/thingiview/javascripts/thingiview.js"></script>

  <script>
    window.onload = function() {
      // You may want to place these lines inside an onload handler
      CFInstall.check({
        mode: "inline", // the default
        node: "prompt"
      });

      thingiurlbase = "/static/javascripts/thingiview/javascripts";
      thingiview = new Thingiview("viewer");
      thingiview.setObjectColor('#C0D8F0');
      thingiview.initScene();
      // thingiview.setShowPlane(true);
      if (getUrlVars()["stl"]) {
        thingiview.loadSTL(getUrlVars()["stl"]);
      } else {
      // default obj?
      //   thingiview.loadSTL("../examples/objects/cube.stl");
      }
      

        var s = new io.Socket(window.location.hostname, {port: 8001, rememberTransport: false});
        s.connect();

        s.addEvent('connect', function() {
            //s.send('New participant joined');
        });

        s.addEvent('message', function(data) {
            $("#chat").append($("<div>",{text:data}));
        });

        //send the message when submit is clicked
        $('#chatform').submit(function (evt) {
            var line = $('#chatform [type=text]').val()
            $('#chatform [type=text]').val('')
            s.send(line);
            return false;
        });
    };
    
    function getUrlVars() {
    	var vars = {};
    	var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
    		vars[key] = value;
    	});
    	return vars;
    }   
    
    // model drag and drop support
    var reader = new FileReader();
    reader.onload = function(e) {
     document.querySelector('img').src = e.target.result;
    };
    function onDrop(e) {
     reader.readAsDataURL(e.dataTransfer.files[0]);
    };
    document.addEventListener('DOMContentLoaded', function(e) {
     var dndc = new DNDFileController('dropzone');
    }, false);

     

$(document).ready(function() {
  $('#print').click(function() {
    alert('Your model is now printing! Enjoy!');
    $.post('/',  $('#print').data('text'), function() {
        });
  });
  
   // static urls
   $('.file').click(function() {
    var file_name = $(this).attr('file');
    var sample_reader = new FileReader();
    
    sample_reader.onload = (function(theFile) {
      console.log('loaded');
      return function(e) {
        console.log(e.target.result)
        current_file_data = $.base64Decode(e.target.result.replace(/^data:base64,/, ''));
        console.log('static file data '+current_file_data);
        $('#print').data('text', current_file_data);
      };
    })(file_name);
    
    console.log('getting ready to load');
    eval('thingiview.load'+$(this).attr('filetype')+'(file_name)');
    console.log('getting ready to read');
    sample_reader.readAsDataURL(file_name);
    $('.video').hide();
    
  });
  
  
  $("#enable-debug-pane").click(function(){
    $("#debug-pane").show();
    $("#enable-debug-pane").hide();
  });
  
});
  </script>
  <link href="/static/stylesheets/layout.css" rel="stylesheet" type="text/css" />
  <link href="/static/stylesheets/style.css" rel="stylesheet" type="text/css" />
  <style>

  </style>
</head>
<body>

<div id="prompt">
  <!-- if IE without GCF, prompt goes here -->
</div>

<header>
  <h1><a href="http://github.com/LawrenceLeung/PrintJS">PrintJS</a> 3D Printing for the masses</h1>
</header>

<div id="page">
<div id="sidebar" style="float:right;width:40%">

</div>

<p id="controls">
  <input onclick="thingiview.setCameraView('top');" type="button" value="Top" /> 
  <input onclick="thingiview.setCameraView('side');" type="button" value="Side" /> 
  <input onclick="thingiview.setCameraView('bottom');" type="button" value="Bottom" /> 
  <input onclick="thingiview.setCameraView('diagonal');" type="button" value="Diagonal" /> 
 
  <input onclick="thingiview.setCameraZoom(5);" type="button" value="Zoom +" /> 
  <input onclick="thingiview.setCameraZoom(-5);" type="button" value="Zoom -" /> 
 
  Rotation: <input onclick="thingiview.setRotation(true);" type="button" value="on" /> | <input onclick="thingiview.setRotation(false);" type="button" value="off" />

  <a href="#" id="print">Print Me</a>
</p>

<div id="dropzone">
  <div id="viewer" style="width:70%;height:500px"></div>
</div>
<div id="thumbnails">
</div>


<br style='clear:both'/>

<div id="console">
Command line: 

    <div id="chat">
    </div>
    <form id="chatform">
    <input type="text" />
    </form>    
</div> 
<br style='clear:both'/>

<footer>
    
  &larr; <a href="http://github.com/LawrenceLeung">Lawrence Leung</a> and <a href="http://github.com/ricaurte">Justin Ricaurte</a> Google HTML5 Hackathon, Seattle 2011
</footer>

  
<a href='javascript:void(0)' id='enable-debug-pane'>Show debug pane</a>
<div id='debug-pane'>

<p>
  <input onclick="thingiview.setObjectMaterial('wireframe');" type="button" value="Wireframe" /> 
  <input onclick="thingiview.setObjectMaterial('solid');" type="button" value="Solid" />
</p>

<p>
  Plane: <a href="#" onclick="thingiview.setShowPlane(false)">Hide</a> | <a href="#" onclick="thingiview.setShowPlane(true)">Show</a><br/>
  Background Color: <a href="#" onclick="thingiview.setBackgroundColor('#606060')">Gray</a> | <a href="#" onclick="thingiview.setBackgroundColor('#ffffff')">White</a> | <a href="#" onclick="thingiview.setBackgroundColor('#000000')">Black</a><br/>
  Object Color: <a href="#" onclick="thingiview.setObjectColor('#ffffff')">White</a> | <a href="#" onclick="thingiview.setObjectColor('#aa0000')">Red</a> | <a href="#" onclick="thingiview.setObjectColor('#CDFECD')">Green</a> | <a href="#" onclick="thingiview.setObjectColor('#C0D8F0')">Blue</a><br/>
</p>



  <!--<div id="imperial-march" style="display: none;">
    <audio src="http://dmeb.net/dveb/sounds/march.mp3" controls="controls" preload="preload"></audio>
  </div>-->
  <iframe class="video" id="imperial-march" style="display: none;" width="425" height="349" src="http://www.youtube.com/embed/Ce07wUVsBHU" frameborder="0" allowfullscreen></iframe>  <h3></h3>
  <iframe class="video" id="dragon" style="display: none;" width="560" height="349" src="http://www.youtube.com/embed/jlACgYHtWCI" frameborder="0" allowfullscreen></iframe>
  <h3>ASCII STL Files</h3>
  <ul>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/cube.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/cube.stl">download</a> Cube with hole</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/groove_mount.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/groove_mount.stl">download</a> Groove Mount</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/wade.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/wade.stl">download</a> Wade Extruder (buggy)</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/tree.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/tree.stl">download</a> Tree</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/mbotplate1.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/mbotplate1.stl">download</a> Prusa Plate 1 (big)</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/mbotplate2.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/mbotplate2.stl">download</a> Prusa Plate 2</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/triangle.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/triangle.stl">download</a> Twisted Triangle Box (way too huge)</li>
  </ul>
  
  <h3>BINARY STL Files</h3>
  <ul>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/cube_binary.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/cube_binary.stl">download</a> Cube with hole</li>
    <li><a onclick="$('.video').hide(); $('#imperial-march').show(); thingiview.loadSTL('/static/javascripts/thingiview/examples/objects/vader.stl')" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/vader.stl">download</a> Darth Vader</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/39t17p.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/39t17p.stl">download</a> Wade Gear</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/shell.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/shell.stl">download</a> Shell (big and buggy)</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/walt.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/walt.stl">download</a> Walt (way too huge)</li>
    <li><a onclick="$('.video').hide(); $('#dragon').show(); thingiview.loadSTL('/static/javascripts/thingiview/examples/objects/dragonheadfixed.stl')" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/dragonheadfixed.stl">download</a> Dragon! (huge)</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/walt_small.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/walt_small.stl">download</a> Walt Low Poly (big, but manageable)</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/voltron_v2bf.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/voltron_v2bf.stl">download</a> Voltron</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/big-hand.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/big-hand.stl">download</a> Big Hand</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/all_small.stl" filetype="STL" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/all_small.stl">download</a> Inverted Normals</li>
  </ul>
  
  <h3>OBJ Files</h3>
  <ul>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/cube.obj" filetype="OBJ" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/cube.obj">download</a> Cube</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/teddy.obj" filetype="OBJ" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/teddy.obj">download</a> Teddy</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/teapot.obj" filetype="OBJ" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/teapot.obj">download</a> Tea Pot (buggy)</li>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/walt_small.obj" filetype="OBJ" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/walt_small.obj">download</a> Walt Low Poly (big, but manageable)</li>
  </ul>
  
  <h3>ASCII PLY Files</h3>
  <ul>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/gnome_ascii.ply" filetype="PLY" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/gnome_ascii.ply">download</a> Gnome</li>
  </ul>

  <h3>BINARY PLY Files</h3>
  <ul>
    <li><a class="file" file="/static/javascripts/thingiview/examples/objects/gnome_binary.ply" filetype="PLY" href="#">render</a> | <a href="/static/javascripts/thingiview/examples/objects/gnome_binary.ply">download</a> Gnome</li>
  </ul>



</div>



</div><!-- end div#page -->
</body>
</html>
