bespin.tiki.register("::text_editor",{name:"text_editor",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"}});
bespin.tiki.module("text_editor:commands/editing",function(x,s){var u=x("settings").settings,q=x("environment").env,f=x("rangeutils:utils/range");s.backspace=function(){q.view.performBackspaceOrDelete(true)};s.deleteCommand=function(){q.view.performBackspaceOrDelete(false)};s.deleteLines=function(){if(!q.model.readOnly)if(q.model.lines.length!=1){var d=q.view;d.groupChanges(function(){var b=d.getSelectedRange(),j=q.model.lines,i=j.length-1,g;g=b.start.row==i?{col:j[i-1].length,row:i-1}:{col:0,row:b.start.row};
d.replaceCharacters({start:g,end:b.end.row==i?{col:j[i].length,row:i}:{col:0,row:b.end.row+1}},"");d.moveCursorTo(g)})}};var e=function(d,b){var j=b.getSelectedRange().start;d=/^\s*/.exec(d.lines[j.row].substring(0,j.col));b.insertText("\n"+d)};s.insertText=function(d){q.view.insertText(d.text)};s.newline=function(){e(q.model,q.view)};s.joinLines=function(){var d=q.model;if(!d.readOnly){var b=q.view,j=b.getSelectedRange(),i=d.lines,g=j.end.row;i.length!=g&&b.groupChanges(function(){b.replaceCharacters({start:{col:i[g].length,
row:g},end:{col:/^\s*/.exec(i[g+1])[0].length,row:g+1}},"")})}};s.openLine=function(){if(!q.model.readOnly){var d=q.model,b=q.view,j=b.getSelectedRange().end.row;b.moveCursorTo({row:j,col:d.lines[j].length});e(d,b)}};s.tab=function(){var d=q.view;d.groupChanges(function(){var b=u.get("tabstop"),j=d.getSelectedRange(),i="";if(f.isZeroLength(j)){var g=q.model.lines[j.start.row].substring(j.start.col).match(/^\s*/)[0].length;b=b-(j.start.col+g)%b;for(var k=0;k<b;k++)i+=" ";d.replaceCharacters({start:j.start,
end:j.start},i);d.moveCursorTo({col:j.start.col+b+g,row:j.end.row})}else{for(k=0;k<b;k++)i+=" ";for(k=j.start.row-1;k++<j.end.row;){g=k==j.start.row?j.start.col:0;d.replaceCharacters({start:{row:k,col:g},end:{row:k,col:g}},i)}d.setSelection({start:j.start,end:{col:j.end.col+b,row:j.end.row}})}}.bind(this))};s.untab=function(){var d=q.view;d.groupChanges(function(){var b=u.get("tabstop"),j=d.getSelectedRange(),i=q.model.lines,g=0;if(f.isZeroLength(j)){g=Math.min(i[j.start.row].substring(0,j.start.col).match(/\s*$/)[0].length,
(j.start.col-b)%b||b);d.replaceCharacters({start:{col:j.start.col-g,row:j.start.row},end:j.start},"");d.moveCursorTo({row:j.start.row,col:j.end.col-g})}else{for(var k,m=j.start.row-1;m++<j.end.row;){k=m==j.start.row?j.start.col:0;g=Math.min(i[m].substring(k).match(/^\s*/)[0].length,b);d.replaceCharacters({start:{row:m,col:k},end:{row:m,col:k+g}},"")}d.setSelection({start:{row:j.start.row,col:j.start.col},end:{row:j.end.row,col:j.end.col-g}})}}.bind(this))}});
bespin.tiki.module("text_editor:commands/editor",function(x,s){x("bespin:plugins");var u=x("settings").settings,q=x("environment").env;s.findNextCommand=function(){var e=q.view,d=e.editor.searchController,b=e.getSelectedRange();if(d=d.findNext(b.end,true)){e.setSelection(d,true);e.focus()}};s.findPrevCommand=function(){var e=q.view,d=e.editor.searchController,b=e.getSelectedRange();if(d=d.findPrevious(b.start,true)){e.setSelection(d,true);e.focus()}};var f=function(e){var d=q.view,b=d.getSelectedCharacters();
e=e(b);d=d.getSelectedRange();q.model.replaceCharacters(d,e)};s.replaceCommand=function(e){f(function(d){return d.replace(e.search+"/g",e.replace)})};s.entabCommand=function(){tabstop=u.get("tabstop");f(function(e){return e.replace(" {"+tabstop+"}","\t")})};s.detabCommand=function(){tabstop=u.get("tabstop");f(function(e){return e.replace("\t",(new Array(tabstop+1)).join(" "))})};s.trimCommand=function(e){f(function(d){d=d.split("\n");d=d.map(function(b){if(e.side==="left"||e.side==="both")b=b.replace(/^\s+/,
"");if(e.side==="right"||e.side==="both")b=b.replace(/\s+$/,"");return b});return d.join("\n")})};s.ucCommand=function(){f(function(e){return e.toUpperCase()})};s.lcCommand=function(){f(function(e){return e.toLowerCase()})}});
bespin.tiki.module("text_editor:commands/movement",function(x,s){x("rangeutils:utils/range");var u=x("environment").env;s.moveDown=function(){u.view.moveDown()};s.moveLeft=function(){u.view.moveLeft()};s.moveRight=function(){u.view.moveRight()};s.moveUp=function(){u.view.moveUp()};s.selectDown=function(){u.view.selectDown()};s.selectLeft=function(){u.view.selectLeft()};s.selectRight=function(){u.view.selectRight()};s.selectUp=function(){u.view.selectUp()};var q=function(j,i){var g=u.view,k=u.model.lines,
m=g.getSelectedRange(true);i=i?m.end.row:k.length-1;g.moveCursorTo({row:i,col:k[i].length},j)};s.moveLineEnd=function(){q(false,true)};s.selectLineEnd=function(){q(true,true)};s.moveDocEnd=function(){q(false,false)};s.selectDocEnd=function(){q(true,false)};var f=function(j,i){var g=u.view,k=g.getSelectedRange(true);g.moveCursorTo({row:i?k.end.row:0,col:0},j)};s.moveLineStart=function(){f(false,true)};s.selectLineStart=function(){f(true,true)};s.moveDocStart=function(){f(false,false)};s.selectDocStart=
function(){f(true,false)};var e=function(j,i,g,k,m){var p=0,y=false;if(k<0){g--;if(m)p=1}for(;g<i.length&&g>-1;){if(m=j.isDelimiter(i[g]))p++;else y=true;if((m||p>1)&&y)break;g+=k}k<0&&g++;return g},d=function(j){var i=u.view,g=u.model.lines,k=i.getSelectedRange(true).end,m=k.row;k=k.col;var p=g[m],y=false;if(k>=p.length){m++;y=true;if(m<g.length){k=0;p=g[m]}else p=""}k=e(i,p,k,1,y);i.moveCursorTo({row:m,col:k},j)},b=function(j){var i=u.view,g=u.model.lines,k=i.getSelectedRange(true).end,m=k.row;
k=k.col;var p=g[m],y=false;if(k>p.length)k=p.length;else if(k==0){m--;y=true;if(m>-1){p=g[m];k=p.length}else p=""}k=e(i,p,k,-1,y);i.moveCursorTo({row:m,col:k},j)};s.moveNextWord=function(){d(false)};s.selectNextWord=function(){d(true)};s.movePreviousWord=function(){b(false)};s.selectPreviousWord=function(){b(true)};s.selectAll=function(){u.view.selectAll()}});
bespin.tiki.module("text_editor:commands/scrolling",function(x,s){var u=x("environment").env;s.scrollDocStart=function(){u.view.scrollToPosition({col:0,row:0})};s.scrollDocEnd=function(){u.view.scrollToPosition(u.model.range.end)};s.scrollPageDown=function(){u.view.scrollPageDown()};s.scrollPageUp=function(){u.view.scrollPageUp()}});
bespin.tiki.module("text_editor:controllers/layoutmanager",function(x,s){var u=x("bespin:util/util"),q=x("events").Event;x("rangeutils:utils/range");var f=x("syntax_manager").SyntaxManager,e=x("models/textstorage").TextStorage,d=x("bespin:plugins").catalog,b=x("settings").settings,j=x("bespin:util/scratchcanvas"),i={};x=function(){var g=b.get("fontsize"),k=b.get("fontface");k=g+"px "+k;for(var m=j.get(),p="",y=0;y<100;y++)p+="M";k=m.measureStringWidth(k,p)/100;i.characterWidth=k;i.lineHeight=Math.floor(g*
1.6);i.lineAscent=Math.floor(g*1.3)};x();d.registerExtension("settingChange",{match:"font[size|face]",pointer:x});s.LayoutManager=function(g){this.changedTextAtRow=new q;this.invalidatedRects=new q;this.fontDimension=i;if(g.textStorage){g._textStorage=g.textStorage;delete g.textStorage}else this._textStorage=new e;u.mixin(this,g);this._textStorage.changed.add(this.textStorageChanged.bind(this));this.textLines=[{characters:"",colors:[{start:0,end:0,color:"plain"}]}];this.syntaxManager=g=new f(this);
g.attrsChanged.add(this._attrsChanged.bind(this));this._size={width:0,height:0};this.sizeChanged=new q;this._height=0;this._recomputeEntireLayout()};s.LayoutManager.prototype={_maximumWidth:0,_textStorage:null,_size:null,sizeChanged:null,_theme:{},margin:{left:5,bottom:6,top:0,right:12},pluginCatalog:d,syntaxManager:null,textLines:null,_attrsChanged:function(g,k){this.updateTextRows(g,k);this.invalidatedRects(this,this.rectsForRange({start:{row:g,col:0},end:{row:k,col:0}}))},_computeInvalidRects:function(g,
k){var m=this.characterRectForPosition(g.start),p={x:m.x,y:m.y,width:Number.MAX_VALUE,height:m.height};return g.end.row===k.end.row?[p]:[p,{x:0,y:m.y+i.lineHeight,width:Number.MAX_VALUE,height:Number.MAX_VALUE}]},_lastCharacterPosition:function(){return{row:this.textLines.length-1,col:this._maximumWidth}},_recalculateMaximumWidth:function(){var g=0;this.textLines.forEach(function(k){k=k.characters.length;if(g<k)g=k});this._maximumWidth=g;this.size={width:g,height:this.textLines.length}},_recomputeEntireLayout:function(){var g=
this._textStorage.range;this._recomputeLayoutForRanges(g,g)},_recomputeLayoutForRanges:function(g,k){for(var m=g.start.row,p=g.end.row,y=k.end.row,v=y-m+1,h=this._textStorage.lines,A=this._theme.plain,F=[],o=0;o<v;o++)F[o]={characters:h[m+o],colors:[{start:0,end:null,color:A}]};this.textLines=u.replace(this.textLines,m,p-m+1,F);this._recalculateMaximumWidth();p=this.textLines.length;v=this.syntaxManager;if(this._height!==p)this._height=p;v.invalidateRow(m);this.updateTextRows(m,y+1);this.changedTextAtRow(this,
m);this.invalidatedRects(this,this._computeInvalidRects(g,k))},boundingRect:function(){return this.rectsForRange({start:{row:0,col:0},end:{row:this.textLines.length-1,col:this._maximumWidth}})[0]},characterAtPoint:function(g){var k=this.margin,m=g.x-k.left,p=i.characterWidth,y=this._textStorage;g=y.clampPosition({row:Math.floor((g.y-k.top)/i.lineHeight),col:Math.floor(m/p)});y=y.lines[g.row].length;g.partialFraction=m<0||g.col===y?0:m%p/p;return g},characterRangeForBoundingRect:function(g){var k=
i.lineHeight,m=i.characterWidth,p=this.margin,y=g.x-p.left;p=g.y-p.top;return{start:{row:Math.max(Math.floor(p/k),0),col:Math.max(Math.floor(y/m),0)},end:{row:Math.floor((p+g.height-1)/k),col:Math.floor((y+g.width-1)/m)+1}}},characterRectForPosition:function(g){return this.rectsForRange({start:g,end:{row:g.row,col:g.col+1}})[0]},lineRectForRow:function(g){return this.rectsForRange({start:{row:g,col:0},end:{row:g,col:this._maximumWidth}})[0]},rectForPosition:function(g){var k=this.margin,m=i.characterWidth,
p=i.lineHeight;return{x:k.left+m*g.col,y:k.top+p*g.row,width:m,height:p}},rectsForRange:function(g){var k=i.characterWidth,m=i.lineHeight,p=this._maximumWidth,y=this.margin,v=g.start,h=g.end;g=v.row;var A=v.col;v=h.row;h=h.col;if(g===v)return[{x:y.left+k*A,y:y.top+m*g,width:k*(h-A),height:m}];var F=[],o;if(A===0)o=g;else{o=g+1;F.push({x:y.left+k*A,y:y.top+m*g,width:99999,height:m})}if(h===0)p=v-1;else if(h===p)p=v;else{p=v-1;F.push({x:y.left,y:y.top+m*v,width:k*h,height:m})}F.push({x:y.left,y:y.top+
m*o,width:99999,height:m*(p-o+1)});return F},textStorageChanged:function(g,k){this._recomputeLayoutForRanges(g,k)},updateTextRows:function(g,k){var m=this.textLines;k=this.syntaxManager.getAttrsForRows(g,k);for(var p=0;p<k.length;p++)m[g+p].colors=k[p]}};Object.defineProperties(s.LayoutManager.prototype,{size:{set:function(g){if(g.width!==this._size.width||g.height!==this._size.height){this.sizeChanged(g);this._size=g}},get:function(){return this._size}},textStorage:{get:function(){return this._textStorage}}})});
bespin.tiki.module("text_editor:controllers/search",function(x,s){var u=x("bespin:util/util");x("rangeutils:utils/range");x("bespin:console");s.EditorSearchController=function(q){this.editor=q};s.EditorSearchController.prototype={editor:null,_escapeString:/(\/|\.|\*|\+|\?|\||\(|\)|\[|\]|\{|\}|\\)/g,_findMatchesInString:function(q){var f=[],e=this.searchRegExp,d;for(e.lastIndex=0;;){d=e.exec(q);if(d===null)break;f.push(d);e.lastIndex=d.index+d[0].length}return f},_makeRange:function(q,f){return{start:{row:f,
col:q.index},end:{row:f,col:q.index+q[0].length}}},isRegExp:null,searchRegExp:null,searchText:null,setSearchText:function(q,f){this.searchRegExp=f?new RegExp(q):new RegExp(q.replace(this._escapeString,"\\$1"),"gi");this.isRegExp=f;this.searchText=q},findNext:function(q,f){var e=this.searchRegExp;if(u.none(e))return null;q=q||this.editor.textView.getSelectedRange().end;var d=this.editor.layoutManager.textStorage.lines,b;e.lastIndex=q.col;var j;for(j=q.row;j<d.length;j++){b=e.exec(d[j]);if(!u.none(b))return this._makeRange(b,
j)}if(!f)return null;for(j=0;j<=q.row;j++){b=e.exec(d[j]);if(!u.none(b))return this._makeRange(b,j)}return null},findPrevious:function(q,f){if(u.none(this.searchRegExp))return null;q=q||this.editor.textView.getSelectedRange().start;var e=this.editor.buffer.layoutManager.textStorage.lines,d;d=this._findMatchesInString(e[q.row].substring(0,q.col));if(d.length!==0)return this._makeRange(d[d.length-1],q.row);var b;for(b=q.row-1;b!==-1;b--){d=this._findMatchesInString(e[b]);if(d.length!==0)return this._makeRange(d[d.length-
1],b)}if(!f)return null;for(b=e.length-1;b>=q.row;b--){d=this._findMatchesInString(e[b]);if(d.length!==0)return this._makeRange(d[d.length-1],b)}return null}}});
bespin.tiki.module("text_editor:controllers/undo",function(x,s){var u=x("bespin:console").console,q=x("environment").env;s.EditorUndoController=function(f){this.editor=f;f=this.textView=f.textView;f.beganChangeGroup.add(function(e,d){this._beginTransaction();this._record.selectionBefore=d}.bind(this));f.endedChangeGroup.add(function(e,d){this._record.selectionAfter=d;this._endTransaction()}.bind(this));f.replacedCharacters.add(function(e,d,b){if(!this._inTransaction)throw new Error("UndoController.textViewReplacedCharacters() called outside a transaction");
this._record.patches.push({oldCharacters:this._deletedCharacters,oldRange:d,newCharacters:b,newRange:this.editor.layoutManager.textStorage.resultingRangeForReplacement(d,b.split("\n"))});this._deletedCharacters=null}.bind(this));f.willReplaceRange.add(function(e,d){if(!this._inTransaction)throw new Error("UndoController.textViewWillReplaceRange() called outside a transaction");this._deletedCharacters=this.editor.layoutManager.textStorage.getCharacters(d)}.bind(this))};s.EditorUndoController.prototype=
{_inTransaction:false,_record:null,textView:null,_beginTransaction:function(){if(this._inTransaction){u.trace();throw new Error("UndoController._beginTransaction() called with a transaction already in place");}this._inTransaction=true;this._record={patches:[]}},_endTransaction:function(){if(!this._inTransaction)throw new Error("UndoController._endTransaction() called without a transaction in place");this.editor.buffer.undoManager.registerUndo(this,this._record);this._record=null;this._inTransaction=
false},_tryApplyingPatches:function(f){var e=this.editor.layoutManager.textStorage;f.forEach(function(d){e.replaceCharacters(d.oldRange,d.newCharacters)});return true},_undoOrRedo:function(f,e){if(this._inTransaction)throw new Error("UndoController._undoOrRedo() called while in a transaction");if(!this._tryApplyingPatches(f))return false;this.textView.setSelection(e,true);return true},redo:function(f){var e=f.patches.concat();e.reverse();return this._undoOrRedo(e,f.selectionAfter)},undo:function(f){return this._undoOrRedo(f.patches.map(function(e){return{oldCharacters:e.newCharacters,
oldRange:e.newRange,newCharacters:e.oldCharacters,newRange:e.oldRange}}),f.selectionBefore)}};s.undoManagerCommand=function(f,e){q.editor.buffer.undoManager[e.commandExt.name]()}});
bespin.tiki.module("text_editor:models/buffer",function(x,s){var u=x("environment").env,q=x("bespin:util/util"),f=x("bespin:promise").Promise,e=x("models/textstorage").TextStorage,d=x("controllers/layoutmanager").LayoutManager,b=x("undomanager").UndoManager;s.Buffer=function(j,i){this._file=j;this._model=new e(i);this._layoutManager=new d({textStorage:this._model});this.undoManager=new b;if(j)this.reload().then(function(){this._updateSyntaxManagerInitialContext()}.bind(this));else{this.loadPromise=
new f;this.loadPromise.resolve()}i=u.session?u.session.history:null;var g,k,m;if(i&&j&&(g=i.getHistoryForPath(j.path))){k=g.selection;m=g.scroll}this._selectedRange=k||{start:{row:0,col:0},end:{row:0,col:0}};this._scrollOffset=m||{x:0,y:0}};s.Buffer.prototype={undoManager:null,loadPromise:null,_scrollOffset:null,_selectedRange:null,_selectedRangeEndVirtual:null,_layoutManager:null,_file:null,_model:null,save:function(){return this._file.saveContents(this._model.value)},saveAs:function(j){var i=new f;
j.saveContents(this._model.value).then(function(){this._file=j;this._updateSyntaxManagerInitialContext();i.resolve()}.bind(this),function(g){i.reject(g)});return i},reload:function(){var j=this,i;return this.loadPromise=i=this._file.loadContents().then(function(g){j._model.value=g})},_updateSyntaxManagerInitialContext:function(){var j=this._file.extension();this._layoutManager.syntaxManager.setSyntaxFromFileExt(j===null?"":j)},untitled:function(){return q.none(this._file)}};Object.defineProperties(s.Buffer.prototype,
{layoutManager:{get:function(){return this._layoutManager}},syntaxManager:{get:function(){}},file:{get:function(){return this._file}},model:{get:function(){return this._model}}})});
bespin.tiki.module("text_editor:models/textstorage",function(x,s){var u=x("events").Event,q=x("bespin:util/util");x=function(f){this._lines=f!==null&&f!==undefined?f.split("\n"):[""];this.changed=new u;return this};x.prototype={_lines:null,readOnly:false,clampPosition:function(f){var e=this._lines,d=f.row;if(d<0)return{row:0,col:0};else if(d>=e.length)return this.range.end;f=Math.max(0,Math.min(f.col,e[d].length));return{row:d,col:f}},clampRange:function(f){var e=this.clampPosition(f.start);f=this.clampPosition(f.end);
return{start:e,end:f}},deleteCharacters:function(f){this.replaceCharacters(f,"")},displacePosition:function(f,e){var d=e>0,b=this._lines,j=b.length;for(e=Math.abs(e);e!==0;e--)if(d){var i=b[f.row].length;if(f.row===j-1&&f.col===i)return f;f=f.col===i?{row:f.row+1,col:0}:{row:f.row,col:f.col+1}}else{if(f.row===0&&f.col==0)return f;if(f.col===0){b=this._lines;f={row:f.row-1,col:b[f.row-1].length}}else f={row:f.row,col:f.col-1}}return f},getCharacters:function(f){var e=this._lines,d=f.start,b=f.end,
j=d.row;f=b.row;var i=d.col;d=b.col;if(j===f)return e[j].substring(i,d);b=e[j].substring(i);j=e.slice(j+1,f);e=e[f].substring(0,d);return[b].concat(j,e).join("\n")},getLines:function(){return this._lines},getRange:function(){var f=this._lines,e=f.length-1;return{start:{row:0,col:0},end:{row:e,col:f[e].length}}},getValue:function(){return this._lines.join("\n")},insertCharacters:function(f,e){this.replaceCharacters({start:f,end:f},e)},replaceCharacters:function(f,e){if(this.readOnly)throw new Error("Attempt to modify a read-only text storage object");
var d=e.split("\n"),b=d.length,j=this.resultingRangeForReplacement(f,d),i=f.start,g=f.end,k=i.row,m=g.row,p=this._lines;d[0]=p[k].substring(0,i.col)+d[0];d[b-1]+=p[m].substring(g.col);this._lines=q.replace(p,k,m-k+1,d);this.changed(f,j,e)},resultingRangeForReplacement:function(f,e){var d=e.length;f=f.start;return{start:f,end:{row:f.row+d-1,col:(d===1?f.col:0)+e[d-1].length}}},setLines:function(f){this.setValue(f.join("\n"))},setValue:function(f){this.replaceCharacters(this.range,f)}};s.TextStorage=
x;Object.defineProperties(s.TextStorage.prototype,{lines:{get:function(){return this.getLines()},set:function(f){return this.setLines(f)}},range:{get:function(){return this.getRange()}},value:{get:function(){return this.getValue()},set:function(f){this.setValue(f)}}})});
bespin.tiki.module("text_editor:utils/rect",function(x,s){s._distanceFromBounds=function(u,q,f){if(u<q)return u-q;if(u>=f)return u-f;return 0};s.merge=function(u){var q;do{q=false;for(var f=[],e=0;e<u.length;e++){var d=u[e];f.push(d);for(var b=e+1;b<u.length;b++){var j=u[b];if(s.rectsSideBySide(d,j)||s.rectsIntersect(d,j)){u.splice(b,1);f[f.length-1]=s.unionRects(d,j);q=true;break}}}u=f}while(q);return u};s.offsetFromRect=function(u,q){return{x:s._distanceFromBounds(q.x,u.x,s.maxX(u)),y:s._distanceFromBounds(q.y,
u.y,s.maxY(u))}};s.rectsIntersect=function(u,q){u=s.intersectRects(u,q);return u.width!==0&&u.height!==0};s.rectsSideBySide=function(u,q){if(u.x==q.x&&u.width==q.width)return u.y<q.y?u.y+u.height==q.y:q.y+q.height==u.y;else if(u.y==q.y&&u.height==q.height)return u.x<q.x?u.x+u.width==q.x:q.x+q.width==u.x;return false};s.intersectRects=function(u,q){u={x:Math.max(s.minX(u),s.minX(q)),y:Math.max(s.minY(u),s.minY(q)),width:Math.min(s.maxX(u),s.maxX(q)),height:Math.min(s.maxY(u),s.maxY(q))};u.width=Math.max(0,
u.width-u.x);u.height=Math.max(0,u.height-u.y);return u};s.minX=function(u){return u.x||0};s.maxX=function(u){return(u.x||0)+(u.width||0)};s.minY=function(u){return u.y||0};s.maxY=function(u){return(u.y||0)+(u.height||0)};s.pointInRect=function(u,q){return u.x>=s.minX(q)&&u.y>=s.minY(q)&&u.x<=s.maxX(q)&&u.y<=s.maxY(q)};s.unionRects=function(u,q){u={x:Math.min(s.minX(u),s.minX(q)),y:Math.min(s.minY(u),s.minY(q)),width:Math.max(s.maxX(u),s.maxX(q)),height:Math.max(s.maxY(u),s.maxY(q))};u.width=Math.max(0,
u.width-u.x);u.height=Math.max(0,u.height-u.y);return u};s.rectsEqual=function(u,q,f){if(!u||!q)return u==q;if(!f&&f!==0)f=0.1;if(u.y!=q.y&&Math.abs(u.y-q.y)>f)return false;if(u.x!=q.x&&Math.abs(u.x-q.x)>f)return false;if(u.width!=q.width&&Math.abs(u.width-q.width)>f)return false;if(u.height!=q.height&&Math.abs(u.height-q.height)>f)return false;return true}});
bespin.tiki.module("text_editor:views/canvas",function(x,s){var u=x("bespin:util/util"),q=x("utils/rect"),f=x("events").Event;s.CanvasView=function(e,d,b){if(e){this._preventDownsize=d||false;this._clearOnFullInvalid=b||false;this._clippingFrame=this._frame={x:0,y:0,width:0,height:0};this._invalidRects=[];d=document.createElement("canvas");d.setAttribute("style","position: absolute");d.innerHTML="canvas tag not supported by your browser";e.appendChild(d);this.domNode=d;this.clippingChanged=new f;
this.clippingChanged.add(this.clippingFrameChanged.bind(this))}};s.CanvasView.prototype={domNode:null,clippingChanged:null,_canvasContext:null,_canvasId:null,_invalidRects:null,_lastRedrawTime:null,_redrawTimer:null,_clippingFrame:null,_preventDownsize:false,_clearOnFullInvalid:false,_frame:null,_getContext:function(){if(this._canvasContext===null)this._canvasContext=this.domNode.getContext("2d");return this._canvasContext},computeWithClippingFrame:function(e,d){var b=this.clippingFrame;return{x:e+
b.x,y:d+b.y}},minimumRedrawDelay:1E3/30,clippingFrameChanged:function(){this.invalidate()},drawRect:function(){},render:function(){if(!(this._renderTimer||this._redrawTimer))this._renderTimer=setTimeout(this._tryRedraw.bind(this),0)},invalidate:function(){this._invalidRects="all";this.render()},invalidateRect:function(e){var d=this._invalidRects;if(d!=="all"){d.push(e);this.render()}},_tryRedraw:function(){this._renderTimer=null;var e=(new Date).getTime(),d=this._lastRedrawTime,b=this.minimumRedrawDelay;
if(d===null||e-d>=b)this._redraw();else if(this._redrawTimer===null)this._redrawTimer=window.setTimeout(this._redraw.bind(this),b)},_redraw:function(){var e=this.clippingFrame;e={x:Math.round(e.x),y:Math.round(e.y),width:e.width,height:e.height};var d=this._getContext();d.save();d.translate(-e.x,-e.y);var b=this._invalidRects;if(b==="all"){this._clearOnFullInvalid&&d.clearRect(0,0,this.domNode.width,this.domNode.height);this.drawRect(e,d)}else q.merge(b).forEach(function(j){j=q.intersectRects(j,e);
if(j.width!==0&&j.height!==0){d.save();var i=j.x,g=j.y,k=j.width,m=j.height;d.beginPath();d.moveTo(i,g);d.lineTo(i+k,g);d.lineTo(i+k,g+m);d.lineTo(i,g+m);d.closePath();d.clip();this.drawRect(j,d);d.restore()}},this);d.restore();this._invalidRects=[];this._redrawTimer=null;this._lastRedrawTime=(new Date).getTime()}};Object.defineProperties(s.CanvasView.prototype,{clippingFrame:{get:function(){return this._clippingFrame},set:function(e){e=u.mixin(u.clone(this._clippingFrame),e);if(this._clippingFrame===
null||!q.rectsEqual(e,this._clippingFrame)){this._clippingFrame=e;this.clippingChanged()}}},frame:{get:function(){return this._frame},set:function(e){var d=this.domNode,b=d.style,j=this._preventDownsize,i=d.width,g=d.height;b=d.style;b.left=e.x+"px";b.top=e.y+"px";var k,m;if(e.width!==i)if(e.width<i)j||(k=true);else k=true;if(e.height!==g)if(e.height<g)j||(m=true);else m=true;if(k)this.domNode.width=e.width;if(m)this.domNode.height=e.height;this._frame=e;this.clippingFrame={width:e.width,height:e.height}}}})});
bespin.tiki.module("text_editor:views/editor",function(x,s){function u(o){var z=v.plugins.text_editor.provides,C=z.length,G={};if(o){o=o.themestyles;if(o.currentThemeVariables&&o.currentThemeVariables.text_editor)G=o.currentThemeVariables.text_editor}for(;C--;)if(z[C].ep==="themevariable"){o=e.mixin(e.clone(z[C].defaultValue),G[z[C].name]);switch(z[C].name){case "gutter":case "editor":case "scroller":case "highlighter":F[z[C].name]=o}}}var q=x("rangeutils:utils/range"),f=x("views/scroller"),e=x("bespin:util/util"),
d=x("models/buffer").Buffer,b=x("completion:controller").CompletionController,j=x("controllers/search").EditorSearchController,i=x("controllers/undo").EditorUndoController,g=x("events").Event,k=x("views/gutter").GutterView;x("controllers/layoutmanager");var m=f.ScrollerCanvasView,p=x("views/text").TextView,y=x("underscore")._,v=x("bespin:plugins").catalog,h=x("keyboard:keyboard").keyboardManager,A=x("settings").settings,F={};u();v.registerExtension("themeChange",{pointer:u});s.EditorView=function(o){this.elementAppended=
new g;var z=this.element=this.container=document.createElement("div");z.style.overflow="visible";z.style.position="relative";this.scrollOffsetChanged=new g;this.willChangeBuffer=new g;this.selectionChanged=new g;this.textChanged=new g;this.gutterView=new k(z,this);this.textView=new p(z,this);var C=new m(this,f.LAYOUT_VERTICAL),G=new m(this,f.LAYOUT_HORIZONTAL);this.verticalScroller=C;this.horizontalScroller=G;this.completionController=new b(this);this.editorUndoController=new i(this);this.searchController=
new j(this);this._textViewSize=this._oldSize={width:0,height:0};this._themeData=F;this.buffer=new d(null,o);this.elementAppended.add(function(){var M=A.get("fontsize"),Z=A.get("fontface");this._font=M+"px "+Z;v.registerExtension("themeChange",{pointer:this._themeVariableChange.bind(this)});v.registerExtension("settingChange",{match:"font[size|face]",pointer:this._fontSettingChanged.bind(this)});v.registerExtension("dimensionsChanged",{pointer:this.dimensionsChanged.bind(this)});this._dontRecomputeLayout=
false;this._recomputeLayout();z.addEventListener(e.isMozilla?"DOMMouseScroll":"mousewheel",this._onMouseWheel.bind(this),false);C.valueChanged.add(function(T){this.scrollOffset={y:T}}.bind(this));G.valueChanged.add(function(T){this.scrollOffset={x:T}}.bind(this));this.scrollOffsetChanged.add(function(T){this._updateScrollOffsetChanged(T)}.bind(this))}.bind(this))};s.EditorView.prototype={elementAppended:null,textChanged:null,selectionChanged:null,scrollOffsetChanged:null,willChangeBuffer:null,_textViewSize:null,
_textLinesCount:0,_gutterViewWidth:0,_oldSize:null,_buffer:null,_dontRecomputeLayout:true,_themeData:null,_layoutManagerSizeChanged:function(o){var z=this.layoutManager.fontDimension;this._textViewSize={width:o.width*z.characterWidth,height:o.height*z.lineHeight};if(this._textLinesCount!==o.height){this.gutterView.computeWidth()!==this._gutterViewWidth?this._recomputeLayout(true):this.gutterView.invalidate();this._textLinesLength=o.height}this._updateScrollers();this.scrollOffset={}},_updateScrollers:function(){if(!this._dontRecomputeLayout){var o=
this.textViewPaddingFrame,z=this._textViewSize.width,C=this._textViewSize.height,G=this.scrollOffset,M=this.verticalScroller,Z=this.horizontalScroller;if(C<o.height)M.isVisible=false;else{M.isVisible=true;M.proportion=o.height/C;M.maximum=C-o.height;M.value=G.y}if(z<o.width)Z.isVisible=false;else{Z.isVisible=true;Z.proportion=o.width/z;Z.maximum=z-o.width;Z.value=G.x}}},_onMouseWheel:function(o){var z=0;if(o.wheelDelta)z=-o.wheelDelta;else if(o.detail)z=o.detail*40;var C=true;if(o.axis){if(o.axis==
o.HORIZONTAL_AXIS)C=false}else if(o.wheelDeltaY||o.wheelDeltaX){if(o.wheelDeltaX==o.wheelDelta)C=false}else if(o.shiftKey)C=false;C?this.scrollBy(0,z):this.scrollBy(z*5,0);e.stopEvent(o)},scrollTo:function(o){this.scrollOffset=o},scrollBy:function(o,z){this.scrollOffset={x:this.scrollOffset.x+o,y:this.scrollOffset.y+z}},_recomputeLayout:function(o){if(!this._dontRecomputeLayout){var z=this.container.offsetWidth,C=this.container.offsetHeight;if(!(!o&&z==this._oldSize.width&&C==this._oldSize.height)){this._oldSize=
{width:z,height:C};this._gutterViewWidth=o=this.gutterView.computeWidth();this.gutterView.frame={x:0,y:0,width:o,height:C};this.textView.frame={x:o,y:0,width:z-o,height:C};var G=this._themeData.scroller.padding,M=this._themeData.scroller.thickness;this.horizontalScroller.frame={x:o+G,y:C-(M+G),width:z-(o+2*G+M),height:M};this.verticalScroller.frame={x:z-(G+M),y:G,width:M,height:C-(2*G+M)};this.scrollOffset={};this._updateScrollers();this.gutterView.invalidate();this.textView.invalidate();this.verticalScroller.invalidate();
this.horizontalScroller.invalidate()}}},dimensionsChanged:function(){this._recomputeLayout()},_font:null,_fontSettingChanged:function(){var o=A.get("fontsize"),z=A.get("fontface");this._font=o+"px "+z;this.layoutManager._recalculateMaximumWidth();this._layoutManagerSizeChanged(this.layoutManager.size);this.textView.invalidate()},_themeVariableChange:function(){this._recomputeLayout(true)},_updateScrollOffsetChanged:function(o){this.verticalScroller.value=o.y;this.horizontalScroller.value=o.x;this.textView.clippingFrame=
{x:o.x,y:o.y};this.gutterView.clippingFrame={y:o.y};this._updateScrollers();this.gutterView.invalidate();this.textView.invalidate()},processKeyEvent:function(o,z,C){C=y(C).clone();C.completing=this.completionController.isCompleting();return h.processKeyEvent(o,z,C)},convertTextViewPoint:function(o){var z=this.scrollOffset;return{x:o.x-z.x+this._gutterViewWidth,y:o.y-z.y}},replace:function(o,z,C){if(!q.isRange(o))throw new Error('replace(): expected range but found "'+o+"'");if(!e.isString(z))throw new Error('replace(): expected text string but found "'+
text+'"');var G=q.normalizeRange(o),M=this.textView,Z=M.getSelectedRange(false);return M.groupChanges(function(){M.replaceCharacters(G,z);if(C)M.setSelection(Z);else{var T=z.split("\n");T=T.length>1?{row:o.start.row+T.length-1,col:T[T.length-1].length}:q.addPositions(o.start,{row:0,col:z.length});M.moveCursorTo(T)}})},getText:function(o){if(!q.isRange(o))throw new Error('getText(): expected range but found "'+o+'"');return this.layoutManager.textStorage.getCharacters(q.normalizeRange(o))},setLineNumber:function(o){if(!e.isNumber(o))throw new Error("setLineNumber(): lineNumber must be a number");
this.textView.moveCursorTo({row:o-1,col:0})},setCursor:function(o){if(!q.isPosition(o))throw new Error('setCursor(): expected position but found "'+o+'"');this.textView.moveCursorTo(o)},changeGroup:function(o){return this.textView.groupChanges(function(){o(this)}.bind(this))},addTags:function(o){this.completionController.tags.add(o)}};Object.defineProperties(s.EditorView.prototype,{themeData:{get:function(){return this._themeData},set:function(){throw new Error("themeData can't be changed directly. Use themeManager.");
}},font:{get:function(){return this._font},set:function(){throw new Error("font can't be changed directly. Use settings fontsize and fontface.");}},buffer:{set:function(o){if(o!==this._buffer){if(!o.loadPromise.isResolved())throw new Error("buffer.set(): the new buffer must first be loaded!");if(this._buffer!==null){this.layoutManager.sizeChanged.remove(this);this.layoutManager.textStorage.changed.remove(this);this.textView.selectionChanged.remove(this)}this.willChangeBuffer(o);v.publish(this,"editorChange",
"buffer",o);this.layoutManager=o.layoutManager;this._buffer=o;var z=this.layoutManager,C=this.textView;z.sizeChanged.add(this,this._layoutManagerSizeChanged.bind(this));z.textStorage.changed.add(this,this.textChanged.bind(this));C.selectionChanged.add(this,this.selectionChanged.bind(this));this.textView.setSelection(o._selectedRange,false);this.scrollOffsetChanged(o._scrollOffset);this.layoutManager.sizeChanged(this.layoutManager.size);this._recomputeLayout()}},get:function(){return this._buffer}},
frame:{get:function(){return{width:this.container.offsetWidth,height:this.container.offsetHeight}}},textViewPaddingFrame:{get:function(){var o=e.clone(this.textView.frame),z=this.textView.padding;o.width-=z.left+z.right;o.height-=z.top+z.bottom;return o}},scrollOffset:{set:function(o){if(o.x===undefined)o.x=this.scrollOffset.x;if(o.y===undefined)o.y=this.scrollOffset.y;var z=this.textViewPaddingFrame;if(o.y<0)o.y=0;else if(this._textViewSize.height<z.height)o.y=0;else if(o.y+z.height>this._textViewSize.height)o.y=
this._textViewSize.height-z.height;if(o.x<0)o.x=0;else if(this._textViewSize.width<z.width)o.x=0;else if(o.x+z.width>this._textViewSize.width)o.x=this._textViewSize.width-z.width;if(!(o.x===this.scrollOffset.x&&o.y===this.scrollOffset.y)){this.buffer._scrollOffset=o;this.scrollOffsetChanged(o);v.publish(this,"editorChange","scrollOffset",o)}},get:function(){return this.buffer._scrollOffset}},readOnly:{get:function(){return this._buffer.model.readOnly},set:function(o){this._buffer.model.readOnly=o}},
focus:{get:function(){return this.textView.hasFocus},set:function(o){if(!e.isBoolean(o))throw new Error('set focus: expected boolean but found "'+o+'"');this.textView.hasFocus=o}},selection:{get:function(){return e.clone(this.textView.getSelectedRange(false))},set:function(o){if(!q.isRange(o))throw new Error("set selection: position/selection must be supplied");this.textView.setSelection(o)}},selectedText:{get:function(){return this.getText(this.selection)},set:function(o){if(!e.isString(o))throw new Error('set selectedText: expected string but found "'+
o+'"');return this.replace(this.selection,o)}},value:{get:function(){return this.layoutManager.textStorage.value},set:function(o){if(!e.isString(o))throw new Error('set value: expected string but found "'+o+'"');return this.replace(this.layoutManager.textStorage.range,o,false)}},syntax:{get:function(){return this.layoutManager.syntaxManager.getSyntax()},set:function(o){if(!e.isString(o))throw new Error('set syntax: expected string but found "'+newValue+'"');return this.layoutManager.syntaxManager.setSyntax(o)}}})});
bespin.tiki.module("text_editor:views/gutter",function(x,s){var u=x("bespin:util/util"),q=x("views/canvas").CanvasView;s.GutterView=function(f,e){q.call(this,f,true);this.editor=e};s.GutterView.prototype=new q;u.mixin(s.GutterView.prototype,{drawRect:function(f,e){var d=this.editor.themeData.gutter;e.fillStyle=d.backgroundColor;e.fillRect(f.x,f.y,f.width,f.height);e.save();e.translate(d.paddingLeft,0);var b=this.editor.layoutManager,j=b.characterRangeForBoundingRect(f);f=Math.min(j.end.row,b.textLines.length-
1);var i=b.fontDimension.lineAscent;e.fillStyle=d.color;e.font=this.editor.font;for(d=j.start.row;d<=f;d++)e.fillText(""+(d+1),-0.5,b.lineRectForRow(d).y+i-0.5);e.restore()},computeWidth:function(){var f=this.editor.themeData.gutter,e=this.editor.layoutManager;return e.fontDimension.characterWidth*(""+e.textLines.length).length+(f.paddingLeft+f.paddingRight)}})});
bespin.tiki.module("text_editor:views/scroller",function(x,s){var u=x("bespin:util/util"),q=x("events").Event,f=x("bespin:console").console,e=x("utils/rect"),d=x("views/canvas").CanvasView,b=s.LAYOUT_HORIZONTAL=0,j=s.LAYOUT_VERTICAL=1;s.ScrollerCanvasView=function(i,g){d.call(this,i.container,false,true);this.editor=i;this.layoutDirection=g;i=function(k,m,p){p=p||this.domNode;p.addEventListener(k,function(y){m.call(this,y);u.stopEvent(y)}.bind(this),false)}.bind(this);i("mouseover",this.mouseEntered);
i("mouseout",this.mouseExited);i("mousedown",this.mouseDown);i("mouseup",this.mouseUp,window);i("mousemove",this.mouseMove,window);this.valueChanged=new q};s.ScrollerCanvasView.prototype=new d;u.mixin(s.ScrollerCanvasView.prototype,{lineHeight:20,proportion:0,layoutDirection:j,_isVisible:false,_maximum:0,_value:0,valueChanged:null,padding:{left:0,bottom:0,top:0,right:0},_mouseDownScreenPoint:null,_mouseDownValue:null,_isMouseOver:false,_scrollTimer:null,_mouseEventPosition:null,_mouseOverHandle:false,
_drawNib:function(i){var g=this.editor.themeData.scroller,k,m;k=g.nibStyle;m=g.nibArrowStyle;g=g.nibStrokeStyle;var p=Math.floor(7.5);i.fillStyle=k;i.beginPath();i.arc(0,0,Math.floor(7.5),0,Math.PI*2,true);i.closePath();i.fill();i.strokeStyle=g;i.stroke();i.fillStyle=m;i.beginPath();i.moveTo(0,-p+3);i.lineTo(-p+3,p-5);i.lineTo(p-3,p-5);i.closePath();i.fill()},_drawNibs:function(i,g){var k=this._getClientThickness(),m=this._value,p=this._maximum,y=this._isHighlighted();if(y||m!==0){i.save();i.translate(8,
k/2);i.rotate(Math.PI*1.5);i.moveTo(0,0);this._drawNib(i,g);i.restore()}if(y||m!==p){i.save();i.translate(this._getClientLength()-8,k/2);i.rotate(Math.PI*0.5);i.moveTo(0,0);this._drawNib(i,g);i.restore()}},_getClientFrame:function(){var i=this.frame,g=this.padding;return{x:g.left,y:g.top,width:i.width-(g.left+g.right),height:i.height-(g.top+g.bottom)}},_getClientLength:function(){var i=this._getClientFrame();switch(this.layoutDirection){case b:return i.width;case j:return i.height;default:f.error("unknown layout direction");
return null}},_getClientThickness:function(){var i=this.padding,g=this.editor.themeData.scroller.thickness;switch(this.layoutDirection){case j:return g-(i.left+i.right);case b:return g-(i.top+i.bottom);default:f.error("unknown layout direction");return null}},_getFrameLength:function(){switch(this.layoutDirection){case b:return this.frame.width;case j:return this.frame.height;default:f.error("unknown layout direction");return null}},_getGutterFrame:function(){var i=this._getClientFrame(),g=this._getClientThickness();
switch(this.layoutDirection){case j:return{x:i.x,y:i.y+15,width:g,height:Math.max(0,i.height-30)};case b:return{x:i.x+15,y:i.y,width:Math.max(0,i.width-30),height:g};default:f.error("unknown layout direction");return null}},_getGutterLength:function(){var i=this._getGutterFrame(),g;switch(this.layoutDirection){case b:g=i.width;break;case j:g=i.height;break;default:f.error("unknown layout direction");break}return g},_getHandleFrame:function(){var i=this._getGutterFrame(),g=this._getHandleOffset(),
k=this._getHandleLength();switch(this.layoutDirection){case j:return{x:i.x,y:i.y+g,width:i.width,height:k};case b:return{x:i.x+g,y:i.y,width:k,height:i.height}}},_getHandleLength:function(){var i=this._getGutterLength();return Math.max(i*this.proportion,20)},_getHandleOffset:function(){var i=this._maximum;if(i===0)return 0;var g=this._getGutterLength(),k=this._getHandleLength();return(g-k)*this._value/i},_isHighlighted:function(){return this._isMouseOver===true||this._mouseDownScreenPoint!==null},
_segmentForMouseEvent:function(i){i={x:i.layerX,y:i.layerY};var g=this._getClientFrame(),k=this.padding;if(!e.pointInRect(i,g))return null;var m=this.layoutDirection;switch(m){case b:if(i.x-k.left<15)return"nib-start";else if(i.x>=g.width-15)return"nib-end";break;case j:if(i.y-k.top<15)return"nib-start";else if(i.y>=g.height-15)return"nib-end";break;default:f.error("unknown layout direction");break}k=this._getHandleFrame();if(e.pointInRect(i,k))return"handle";switch(m){case b:if(i.x<k.x)return"gutter-before";
else if(i.x>=k.x+k.width)return"gutter-after";break;case j:if(i.y<k.y)return"gutter-before";else if(i.y>=k.y+k.height)return"gutter-after";break;default:f.error("unknown layout direction");break}f.error("_segmentForMouseEvent: point ",i," outside view with handle frame ",k," and client frame ",g);return null},adjustFrame:function(){var i=this.frame;this.set("layout",{left:0,top:0,width:i.width,height:i.height})},drawRect:function(i,g){if(this._isVisible){var k=this._isHighlighted();i=this.editor.themeData.scroller;
var m=k?i.fullAlpha:i.particalAlpha,p=this.frame;g.clearRect(0,0,p.width,p.height);g.save();p=this.padding;g.translate(p.left,p.top);this._getHandleFrame();p=this._getGutterLength();var y=this._getClientThickness(),v=y/2,h=this.layoutDirection,A=this._getHandleOffset()+15,F=this._getHandleLength();if(h===j){g.translate(y+1,0);g.rotate(Math.PI*0.5)}if(!(p<=F)){g.globalAlpha=m;if(k){k=this._getClientLength();g.fillStyle=i.trackFillStyle;g.fillRect(8.5,0.5,k-16,y-1);g.strokeStyle=i.trackStrokeStyle;
g.strokeRect(8.5,0.5,k-16,y-1)}k=function(){g.beginPath();g.arc(A+v+0.5,v,v-0.5,Math.PI/2,3*Math.PI/2,false);g.arc(A+F-v-0.5,v,v-0.5,3*Math.PI/2,Math.PI/2,false);g.lineTo(A+v+0.5,y-0.5);g.closePath()};k();p=g.createLinearGradient(A,0,A,y);p.addColorStop(0,i.barFillGradientTopStart);p.addColorStop(0.4,i.barFillGradientTopStop);p.addColorStop(0.41,i.barFillStyle);p.addColorStop(0.8,i.barFillGradientBottomStart);p.addColorStop(1,i.barFillGradientBottomStop);g.fillStyle=p;g.fill();g.save();g.clip();g.fillStyle=
i.barFillStyle;g.beginPath();g.moveTo(A+v*0.4,v*0.6);g.lineTo(A+v*0.9,y*0.4);g.lineTo(A,y*0.4);g.closePath();g.fill();g.beginPath();g.moveTo(A+F-v*0.4,0+v*0.6);g.lineTo(A+F-v*0.9,0+y*0.4);g.lineTo(A+F,0+y*0.4);g.closePath();g.fill();g.restore();g.save();k();g.strokeStyle=i.trackStrokeStyle;g.stroke();g.restore();this._drawNibs(g,m);g.restore()}}},_repeatAction:function(i,g){if(i()!==false){var k=function(){this._repeatAction(i,100)}.bind(this);this._scrollTimer=setTimeout(k,g)}},_scrollByDelta:function(i){this.value=
this._value+i},_scrollUpOneLine:function(){this._scrollByDelta(-this.lineHeight);return true},_scrollDownOneLine:function(){this._scrollByDelta(this.lineHeight);return true},_scrollPage:function(){switch(this._segmentForMouseEvent(this._mouseEventPosition)){case "gutter-before":this._scrollByDelta(this._getGutterLength()*-1);break;case "gutter-after":this._scrollByDelta(this._getGutterLength());break;case null:break;default:return false}return true},mouseDown:function(i){this._mouseEventPosition=
i;this._mouseOverHandle=false;this._getGutterLength();switch(this._segmentForMouseEvent(i)){case "nib-start":this._repeatAction(this._scrollUpOneLine.bind(this),500);break;case "nib-end":this._repeatAction(this._scrollDownOneLine.bind(this),500);break;case "gutter-before":this._repeatAction(this._scrollPage.bind(this),500);break;case "gutter-after":this._repeatAction(this._scrollPage.bind(this),500);break;case "handle":break;default:f.error("_segmentForMouseEvent returned an unknown value");break}switch(this.layoutDirection){case b:this._mouseDownScreenPoint=
i.pageX;break;case j:this._mouseDownScreenPoint=i.pageY;break;default:f.error("unknown layout direction");break}},mouseMove:function(i){if(this._mouseDownScreenPoint!==null){if(this._segmentForMouseEvent(i)=="handle"||this._mouseOverHandle===true){this._mouseOverHandle=true;if(this._scrollTimer!==null){clearTimeout(this._scrollTimer);this._scrollTimer=null}var g;switch(this.layoutDirection){case b:g=i.pageX;break;case j:g=i.pageY;break;default:f.error("unknown layout direction");break}var k=g-this._mouseDownScreenPoint,
m=this._maximum,p=this._value,y=this._getGutterLength(),v=this._getHandleLength();this.value=p+m*k/(y-v);this._mouseDownScreenPoint=g}this._mouseEventPosition=i}},mouseEntered:function(){this._isMouseOver=true;this.invalidate()},mouseExited:function(){this._isMouseOver=false;this.invalidate()},mouseUp:function(){this._mouseDownValue=this._mouseDownScreenPoint=null;if(this._scrollTimer){clearTimeout(this._scrollTimer);this._scrollTimer=null}this.invalidate()}});Object.defineProperties(s.ScrollerCanvasView.prototype,
{isVisible:{set:function(i){if(this._isVisible!==i){this._isVisible=i;this.domNode.style.display=i?"block":"none";i&&this.invalidate()}}},maximum:{set:function(i){if(this._value>this._maximum)this._value=this._maximum;if(i!==this._maximum){this._maximum=i;this.invalidate()}}},value:{set:function(i){if(i<0)i=0;else if(i>this._maximum)i=this._maximum;if(i!==this._value){this._value=i;this.valueChanged(i);this.invalidate()}}}})});
bespin.tiki.module("text_editor:views/text",function(x,s){var u=x("bespin:plugins").catalog,q=x("bespin:util/util"),f=x("events").Event,e=x("views/canvas").CanvasView;x("controllers/layoutmanager");var d=x("rangeutils:utils/range"),b=x("utils/rect"),j=x("views/textinput").TextInput,i=x("bespin:console").console,g=x("settings").settings;s.TextView=function(k,m){e.call(this,k,true);this.editor=m;this.textInput=new j(k,this);this.padding={top:0,bottom:30,left:0,right:30};this.clippingChanged.add(this.clippingFrameChanged.bind(this));
k=this.domNode;k.style.cursor="text";k.addEventListener("mousedown",this.mouseDown.bind(this),false);k.addEventListener("mousemove",this.mouseMove.bind(this),false);window.addEventListener("mouseup",this.mouseUp.bind(this),false);m.willChangeBuffer.add(this.editorWillChangeBuffer.bind(this));this.selectionChanged=new f;this.beganChangeGroup=new f;this.endedChangeGroup=new f;this.willReplaceRange=new f;this.replacedCharacters=new f};s.TextView.prototype=new e;q.mixin(s.TextView.prototype,{_dragPoint:null,
_dragTimer:null,_enclosingScrollView:null,_inChangeGroup:false,_insertionPointBlinkTimer:null,_insertionPointVisible:true,_keyBuffer:"",_keyMetaBuffer:"",_keyState:"start",_hasFocus:false,_mouseIsDown:false,selectionChanged:null,beganChangeGroup:null,endedChangeGroup:null,willReplaceRange:null,replacedCharacters:null,editorWillChangeBuffer:function(k){if(this.editor.layoutManager){var m=this.editor.layoutManager;m.invalidatedRects.remove(this);m.changedTextAtRow.remove(this)}m=k.layoutManager;m.invalidatedRects.add(this,
this.layoutManagerInvalidatedRects.bind(this));m.changedTextAtRow.add(this,this.layoutManagerChangedTextAtRow.bind(this))},didFocus:function(){this._setFocus(true,true)},didBlur:function(){this._setFocus(false,true)},_drag:function(){var k=this._dragPoint,m=b.offsetFromRect(this.clippingFrame,k);this.moveCursorTo(this._selectionPositionForPoint({x:k.x-m.x,y:k.y-m.y}),true)},_drawInsertionPoint:function(k,m){if(this._insertionPointVisible){var p=this.editor.layoutManager.characterRectForPosition(this.editor.buffer._selectedRange.start);
k=Math.floor(p.x);var y=p.y,v=Math.ceil(p.width);p=p.height;m.save();var h=this.editor.themeData.editor;if(this._hasFocus){m.strokeStyle=h.cursorColor;m.beginPath();m.moveTo(k+0.5,y);m.lineTo(k+0.5,y+p);m.closePath();m.stroke()}else{m.fillStyle=h.unfocusedCursorBackgroundColor;m.fillRect(k+0.5,y,v-0.5,p);m.strokeStyle=h.unfocusedCursorColor;m.strokeRect(k+0.5,y+0.5,v-1,p-1)}m.restore()}},_drawLines:function(k,m){var p=this.editor.layoutManager,y=p.textLines,v=p.fontDimension.lineAscent,h=this.editor.themeData.highlighter;
m.save();m.font=this.editor.font;var A=p.characterRangeForBoundingRect(k),F=A.start;A=A.end;for(var o=A.row,z=F.row;z<=o;z++){var C=y[z];if(!q.none(C)){var G=C.characters,M=G.length,Z=Math.min(A.col,M),T=F.col;if(!(T>=M)){C=C.colors;if(C==null)C=[];for(M=0;M<C.length&&T<C[M].start;)M++;for(var ca=M<C.length?C[M].start:T;ca<Z;){k=C[M];T=k!=null?k.end:Z;k=k!=null?k.tag:"plain";k=h.hasOwnProperty(k)?h[k]:"red";m.fillStyle=k;k=p.characterRectForPosition({row:z,col:ca});ca=G.substring(ca,T);m.fillText(ca,
k.x,k.y+v);ca=T;M++}}}}m.restore()},_drawSelectionHighlight:function(k,m){k=this.editor.themeData.editor;k=this._hasFocus?k.selectedTextBackgroundColor:k.unfocusedCursorBackgroundColor;var p=this.editor.layoutManager;m.save();var y=d.normalizeRange(this.editor.buffer._selectedRange);m.fillStyle=k;p.rectsForRange(y).forEach(function(v){m.fillRect(v.x,v.y,v.width,v.height)});m.restore()},_drawSelection:function(k,m){this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?this._drawInsertionPoint(k,
m):this._drawSelectionHighlight(k,m)},_getVirtualSelection:function(k){var m=this.editor.buffer._selectedRange,p=this.editor.buffer._selectedRangeEndVirtual;return{start:k&&p?p:m.start,end:p||m.end}},_invalidateSelection:function(){var k=function(y){return{x:y.x-1,y:y.y,width:y.width+2,height:y.height}},m=this.editor.layoutManager,p=d.normalizeRange(this.editor.buffer._selectedRange);if(this._rangeIsInsertionPoint(p)){m=m.characterRectForPosition(p.start);this.invalidateRect(k(m))}else m.rectsForRange(p).forEach(function(y){this.invalidateRect(k(y))},
this)},_isReadOnly:function(){return this.editor.layoutManager.textStorage.readOnly},_keymappingChanged:function(){this._keyBuffer="";this._keyState="start"},_performVerticalKeyboardSelection:function(k){var m=this.editor.buffer._selectedRangeEndVirtual;this.moveCursorTo(d.addPositions(m!==null?m:this.editor.buffer._selectedRange.end,{row:k,col:0}),true,true)},_rangeIsInsertionPoint:function(k){return d.isZeroLength(k)},_rearmInsertionPointBlinkTimer:function(){this._insertionPointVisible||this.blinkInsertionPoint();
this._insertionPointBlinkTimer!==null&&clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=setInterval(this.blinkInsertionPoint.bind(this),750)},_repositionSelection:function(){var k=this.editor.layoutManager.textLines,m=k.length,p=this.editor.buffer._selectedRange,y=Math.min(p.start.row,m-1);m=Math.min(p.end.row,m-1);var v=k[m];this.setSelection({start:{row:y,col:Math.min(p.start.col,k[y].characters.length)},end:{row:m,col:Math.min(p.end.col,v.characters.length)}})},_scrollPage:function(k){this.editor.scrollBy(0,
(this.clippingFrame.height+this.editor.layoutManager.fontDimension.lineAscent)*(k?-1:1))},_scrollWhileDragging:function(){var k=this._dragPoint;k=this.computeWithClippingFrame(k.layerX,k.layerY);q.mixin(this._dragPoint,k);this._drag()},_selectionPositionForPoint:function(k){k=this.editor.layoutManager.characterAtPoint(k);return k.partialFraction<0.5?k:d.addPositions(k,{row:0,col:1})},_syntaxManagerUpdatedSyntaxForRows:function(k,m){if(k!==m){var p=this.editor.layoutManager;p.updateTextRows(k,m);p.rectsForRange({start:{row:k,
col:0},end:{row:m,col:0}}).forEach(this.invalidateRect,this)}},blinkInsertionPoint:function(){this._insertionPointVisible=!this._insertionPointVisible;this._invalidateSelection()},copy:function(){return this.getSelectedCharacters()},cut:function(){var k=this.getSelectedCharacters();k!=""&&this.performBackspaceOrDelete(false);return k},drawRect:function(k,m){m.fillStyle=this.editor.themeData.editor.backgroundColor;m.fillRect(k.x,k.y,k.width,k.height);this._drawSelection(k,m);this._drawLines(k,m)},
focus:function(){this.textInput.focus()},getInsertionPointPosition:function(){var k=this.editor;k=k.layoutManager.characterRectForPosition(k.buffer._selectedRange.start);return{x:k.x,y:k.y}},getSelectedCharacters:function(){return this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?"":this.editor.layoutManager.textStorage.getCharacters(d.normalizeRange(this.editor.buffer._selectedRange))},getSelectedRange:function(k){return k?this.editor.buffer._selectedRange:d.normalizeRange(this.editor.buffer._selectedRange)},
groupChanges:function(k){if(this._isReadOnly())return false;if(this._inChangeGroup){k();return true}this._inChangeGroup=true;this.beganChangeGroup(this,this.editor.buffer._selectedRange);try{k()}catch(m){i.error("Error in groupChanges(): "+m);this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return false}finally{this._inChangeGroup=false;this.endedChangeGroup(this,this.editor.buffer._selectedRange);return true}},insertText:function(k){if(this._isReadOnly())return false;
this.groupChanges(function(){var m=d.normalizeRange(this.editor.buffer._selectedRange);this.replaceCharacters(m,k);var p=k.split("\n");this.moveCursorTo(p.length>1?{row:m.start.row+p.length-1,col:p[p.length-1].length}:d.addPositions(m.start,{row:0,col:k.length}))}.bind(this));return true},isDelimiter:function(k){return"\"',;.!~@#$%^&*?[]<>():/\\-+ \t".indexOf(k)!==-1},keyDown:function(k){if(k.charCode===0||k._charCode===0)return this.editor.processKeyEvent(k,this,{isTextView:true});else if(k.keyCode===
9)k.preventDefault();else return false},layoutManagerChangedTextAtRow:function(){this._repositionSelection()},layoutManagerInvalidatedRects:function(k,m){m.forEach(this.invalidateRect,this)},mouseDown:function(k){q.stopEvent(k);this._mouseIsDown=this.hasFocus=true;var m=this.computeWithClippingFrame(k.layerX,k.layerY);q.mixin(m,{layerX:k.layerX,layerY:k.layerY});switch(k.detail){case 1:var p=this._selectionPositionForPoint(m);this.moveCursorTo(p,k.shiftKey);break;case 2:p=this._selectionPositionForPoint(m);
var y=this.editor.layoutManager.textStorage.lines[p.row];if(y.length===0)return true;p.col-=p.col==y.length?1:0;var v=!this.isDelimiter(y[p.col]),h=this,A=function(F,o){for(;F>-1&&F<y.length;F+=o)if(h.isDelimiter(y[F])===v)break;return F+(o==1?0:1)};k=A(p.col,-1);A=A(p.col,1);this.moveCursorTo({row:p.row,col:k});this.moveCursorTo({row:p.row,col:A},true);break;case 3:k=this.editor.layoutManager.textStorage.lines;p=this._selectionPositionForPoint(m);this.setSelection({start:{row:p.row,col:0},end:{row:p.row,
col:k[p.row].length}});break}this._dragPoint=m;this._dragTimer=setInterval(this._scrollWhileDragging.bind(this),100)},mouseMove:function(k){if(this._mouseIsDown){this._dragPoint=this.computeWithClippingFrame(k.layerX,k.layerY);q.mixin(this._dragPoint,{layerX:k.layerX,layerY:k.layerY});this._drag()}},mouseUp:function(){this._mouseIsDown=false;if(this._dragTimer!==null){clearInterval(this._dragTimer);this._dragTimer=null}},moveCursorTo:function(k,m,p){var y=this.editor.layoutManager.textStorage,v=y.clampPosition(k);
this.setSelection({start:m?this.editor.buffer._selectedRange.start:v,end:v});if(p){m=y.lines.length;p=k.row;y=k.col;this.editor.buffer._selectedRangeEndVirtual=p>0&&p<m?k:{row:p<1?0:m-1,col:y}}else this.editor.buffer._selectedRangeEndVirtual=null;this.scrollToPosition(this.editor.buffer._selectedRange.end)},moveDown:function(){var k=this._getVirtualSelection();k=d.normalizeRange(k);k=this._rangeIsInsertionPoint(this.editor.buffer._selectedRange)?k.end:{row:k.end.row,col:k.start.col};k=d.addPositions(k,
{row:1,col:0});this.moveCursorTo(k,false,true)},moveLeft:function(){var k=d.normalizeRange(this.editor.buffer._selectedRange);this._rangeIsInsertionPoint(k)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(k.start,-1)):this.moveCursorTo(k.start)},moveRight:function(){var k=d.normalizeRange(this.editor.buffer._selectedRange);this._rangeIsInsertionPoint(k)?this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(k.end,1)):this.moveCursorTo(k.end)},moveUp:function(){var k=
d.normalizeRange(this._getVirtualSelection(true));position=d.addPositions({row:k.start.row,col:this._getVirtualSelection().end.col},{row:-1,col:0});this.moveCursorTo(position,false,true)},parentViewFrameChanged:function(){arguments.callee.base.apply(this,arguments);this._resize()},replaceCharacters:function(k,m){if(this._isReadOnly())return false;this.groupChanges(function(){k=d.normalizeRange(k);this.willReplaceRange(this,k);this.editor.layoutManager.textStorage.replaceCharacters(k,m);this.replacedCharacters(this,
k,m)}.bind(this));return true},performBackspaceOrDelete:function(k){if(this._isReadOnly())return false;var m=this.editor.layoutManager.textStorage,p=m.lines,y="";y=0;var v=g.get("tabstop"),h=this.getSelectedRange();if(d.isZeroLength(h))if(k){k=h.start;y=p[k.row];y=y.substring(0,k.col).match(/\s*$/)[0].length<v||(k.col-v)%v!=0?1:v;h={start:m.displacePosition(k,y*-1),end:h.end}}else{k=h.end;y=p[k.row];y=y.substring(k.col).match(/^\s*/)[0].length<v?1:v;h={start:h.start,end:m.displacePosition(h.end,y)}}this.groupChanges(function(){this.replaceCharacters(h,
"");this.moveCursorTo(h.start)}.bind(this));return true},resetKeyBuffers:function(){this._keyMetaBuffer=this._keyBuffer=""},scrollPageDown:function(){this._scrollPage(false)},scrollPageUp:function(){this._scrollPage(true)},scrollToPosition:function(k){var m=this.editor.layoutManager.characterRectForPosition(k);k=m.x;var p=m.y,y=m.width;m=m.height;var v=this.clippingFrame,h=v.x,A=v.y,F=this.padding,o=v.width-F.right;v=v.height-F.bottom;this.editor.scrollTo({x:k>=h+30&&k+y<h+o?h:k-o/2+y/2,y:p>=A&&p+
m<A+v?A:p-v/2+m/2})},selectAll:function(){var k=this.editor.layoutManager.textStorage.lines,m=k.length-1;this.setSelection({start:{row:0,col:0},end:{row:m,col:k[m].length}})},selectDown:function(){this._performVerticalKeyboardSelection(1)},selectLeft:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,-1),true)},selectRight:function(){this.moveCursorTo(this.editor.layoutManager.textStorage.displacePosition(this.editor.buffer._selectedRange.end,
1),true)},selectUp:function(){this._performVerticalKeyboardSelection(-1)},setSelection:function(k,m){var p=this.editor.layoutManager.textStorage;k=p.clampRange(k);if(!d.equal(k,this.editor.buffer._selectedRange)){this._invalidateSelection();this.editor.buffer._selectedRange=k=p.clampRange(k);this._invalidateSelection();this._hasFocus&&this._rearmInsertionPointBlinkTimer();m&&this.scrollToPosition(k.end);this.selectionChanged(k);u.publish(this.editor,"editorChange","selection",k)}},textInserted:function(k){if(k!==
"\n")if(!this.editor.processKeyEvent(k,this,{isTextView:true,isCommandKey:false})){this.insertText(k);this.resetKeyBuffers()}},_setFocus:function(k,m){if(k!=this._hasFocus)if(this._hasFocus=k){this._rearmInsertionPointBlinkTimer();this._invalidateSelection();m||this.textInput.focus()}else{if(this._insertionPointBlinkTimer){clearInterval(this._insertionPointBlinkTimer);this._insertionPointBlinkTimer=null}this._insertionPointVisible=true;this._invalidateSelection();m||this.textInput.blur()}}});Object.defineProperties(s.TextView.prototype,
{hasFocus:{get:function(){return this._hasFocus},set:function(k){this._setFocus(k,false)}}})});
bespin.tiki.module("text_editor:views/textinput",function(x,s){var u=x("bespin:util/util");x("events");var q=x("keyboard:keyutil");s.TextInput=function(f,e){var d=this.domNode=document.createElement("textarea");d.setAttribute("style","position: absolute; z-index: -99999; width: 0px; height: 0px; margin: 0px; outline: none; border: 0;");f.appendChild(d);this.delegate=e;this._attachEvents()};s.TextInput.prototype={_composing:false,domNode:null,delegate:null,_textFieldChanged:function(){if(!(this._composing||
this._ignore)){var f=this.domNode,e=f.value;if(e!=""){f.value="";this._textInserted(e)}}},_copy:function(){var f=false,e=this.delegate;if(e&&e.copy)f=e.copy();return f},_cut:function(){var f=false,e=this.delegate;if(e&&e.cut)f=e.cut();return f},_textInserted:function(f){var e=this.delegate;e&&e.textInserted&&e.textInserted(f)},_setValueAndSelect:function(f){var e=this.domNode;e.value=f;e.select()},focus:function(){this.domNode.focus()},blur:function(){this.domNode.blur()},_attachEvents:function(){var f=
this.domNode,e=this;f.addEventListener("focus",function(){e.delegate&&e.delegate.didFocus&&e.delegate.didFocus()},false);f.addEventListener("blur",function(){e.delegate&&e.delegate.didBlur&&e.delegate.didBlur()},false);q.addKeyDownListener(f,function(g){return e.delegate&&e.delegate.keyDown?e.delegate.keyDown(g):false});if(u.isWebKit){u.isChrome||f.addEventListener("compositionend",function(g){e._textInserted(g.data)},false);f.addEventListener("textInput",function(g){e._textInserted(g.data)},false);
f.addEventListener("paste",function(g){e._textInserted(g.clipboardData.getData("text/plain"));g.preventDefault()},false)}else{var d=e._textFieldChanged.bind(e);f.addEventListener("keydown",function(){window.setTimeout(d,0)},false);f.addEventListener("keypress",d,false);f.addEventListener("keyup",d,false);f.addEventListener("compositionstart",function(){e._composing=true},false);f.addEventListener("compositionend",function(){e._composing=false;e._textFieldChanged()},false);f.addEventListener("paste",
function(){e._setValueAndSelect("");window.setTimeout(function(){e._textFieldChanged()},0)},false)}var b=function(g){g=g.type.indexOf("copy")!=-1?e._copy():e._cut();e._setValueAndSelect(g)};if(u.isWebKit&&!u.isChrome&&u.isMac){var j=(new Date).getTime(),i=function(g){var k=g.type.indexOf("cut")!=-1;if(!(k&&(new Date).getTime()-j<10)){b(g);if(k)j=(new Date).getTime()}};f.addEventListener("beforecopy",i,false);f.addEventListener("beforecut",i,false)}else{i=false;if(u.isMozilla)i=function(g){b(g);e._ignore=
true;window.setTimeout(function(){e._setValueAndSelect("");e._ignore=false},0)};f.addEventListener("copy",i||b,false);f.addEventListener("cut",i||b,false)}}}});bespin.tiki.module("text_editor:index",function(){});bespin.tiki.register("::less",{name:"less",dependencies:{}});
bespin.tiki.module("less:index",function(x,s){function u(d){if(d instanceof e.Dimension)return parseFloat(d.unit=="%"?d.value/100:d.value);else if(typeof d==="number")return d;else throw{error:"RuntimeError",message:"color functions take numbers as parameters"};}function q(d){return Math.min(1,Math.max(0,d))}if(!Array.isArray)Array.isArray=function(d){return Object.prototype.toString.call(d)==="[object Array]"||d instanceof Array};if(!Array.prototype.forEach)Array.prototype.forEach=function(d,b){for(var j=
this.length>>>0,i=0;i<j;i++)i in this&&d.call(b,this[i],i,this)};if(!Array.prototype.map)Array.prototype.map=function(d,b){for(var j=this.length>>>0,i=new Array(j),g=0;g<j;g++)if(g in this)i[g]=d.call(b,this[g],g,this);return i};if(!Array.prototype.filter)Array.prototype.filter=function(d,b){for(var j=[],i=0;i<this.length;i++)d.call(b,this[i])&&j.push(this[i]);return j};if(!Array.prototype.reduce)Array.prototype.reduce=function(d){var b=this.length>>>0,j=0;if(b===0&&arguments.length===1)throw new TypeError;
if(arguments.length>=2)var i=arguments[1];else{do{if(j in this){i=this[j++];break}if(++j>=b)throw new TypeError;}while(1)}for(;j<b;j++)if(j in this)i=d.call(null,i,this[j],j,this);return i};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(d,b){var j=this.length;b=b||0;if(!j)return-1;if(b>=j)return-1;if(b<0)b+=j;for(;b<j;b++)if(Object.prototype.hasOwnProperty.call(this,b))if(d===this[b])return b;return-1};if(!Object.keys)Object.keys=function(d){var b=[];for(var j in d)Object.prototype.hasOwnProperty.call(d,
j)&&b.push(j);return b};if(!String.prototype.trim)String.prototype.trim=function(){return String(this).replace(/^\s\s*/,"").replace(/\s\s*$/,"")};if(typeof x!=="undefined")var f=s,e={};else f=e={};f.Parser=function(d){function b(o){var z,C,G;if(o instanceof Function)return o.call(v.parsers);else if(typeof o==="string"){z=i.charAt(g)===o?o:null;C=1}else{if(g>=y+p[k].length&&k<p.length-1)y+=p[k++].length;o.lastIndex=G=g-y;if(z=o.exec(p[k])){C=z[0].length;if(o.lastIndex-C!==G)return}}if(z){g+=C;for(C=
y+p[k].length;g<=C;){o=i.charCodeAt(g);if(!(o===32||o===10||o===9))break;g++}return typeof z==="string"?z:z.length===1?z[0]:z}}function j(o){var z;if(typeof o==="string")return i.charAt(g)===o;else{o.lastIndex=g;if((z=o.exec(i))&&o.lastIndex-z[0].length===g)return z}}var i,g,k,m,p,y,v,h=this,A=function(){},F=this.imports={paths:d&&d.paths||[],queue:[],files:{},push:function(o,z){var C=this;this.queue.push(o);f.Parser.importer(o,this.paths,function(G){C.queue.splice(C.queue.indexOf(o),1);C.files[o]=
G;z(G);C.queue.length===0&&A()})}};this.env=d||{};this.optimization="optimization"in this.env?this.env.optimization:1;return v={imports:F,parse:function(o,z){var C,G,M=null;g=k=y=m=0;p=[];i=o.replace(/\r\n/g,"\n");if(h.optimization>0){i=i.replace(/\/\*(?:[^*]|\*+[^\/*])*\*+\//g,function(ca){return h.optimization>1?"":ca.replace(/\n(\s*\n)+/g,"\n")});p=i.split(/^(?=\n)/mg)}else p=[i];C=new e.Ruleset([],b(this.parsers.primary));C.root=true;C.toCSS=function(ca){var ha,ga;return function(){try{return ca.call(this)}catch(la){ga=
i.split("\n");ha=(i.slice(0,la.index).match(/\n/g)||"").length+1;for(var ma=la.index,na=-1;ma>=0&&i.charAt(ma)!=="\n";ma--)na++;throw{name:"NameError",message:la.message,line:ha,column:na,extract:[ga[ha-2],ga[ha-1],ga[ha]]};}}}(C.toCSS);if(g<i.length-1){g=m;G=i.split("\n");o=(i.slice(0,g).match(/\n/g)||"").length+1;for(var Z=g,T=-1;Z>=0&&i.charAt(Z)!=="\n";Z--)T++;M={name:"ParseError",message:"Syntax Error on line "+o,filename:d.filename,line:o,column:T,extract:[G[o-2],G[o-1],G[o]]}}if(this.imports.queue.length>
0)A=function(){z(M,C)};else z(M,C)},parsers:{primary:function(){for(var o,z=[];o=b(this.mixin.definition)||b(this.rule)||b(this.ruleset)||b(this.mixin.call)||b(this.comment)||b(/[\n\s]+/g)||b(this.directive);)z.push(o);return z},comment:function(){var o;if(i.charAt(g)==="/")return(o=b(/\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/g))?new e.Comment(o):b(/\/\/.*/g)},entities:{quoted:function(){var o;if(!(i.charAt(g)!=='"'&&i.charAt(g)!=="'"))if(o=b(/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/g))return new e.Quoted(o[0],
o[1]||o[2])},keyword:function(){var o;if(o=b(/[A-Za-z-]+/g))return new e.Keyword(o)},call:function(){var o,z;if(o=b(/([a-zA-Z0-9_-]+|%)\(/g)){if(o[1].toLowerCase()==="alpha")return b(this.alpha);z=b(this.entities.arguments);if(b(")"))if(o)return new e.Call(o[1],z)}},arguments:function(){for(var o=[],z;z=b(this.expression);){o.push(z);if(!b(","))break}return o},literal:function(){return b(this.entities.dimension)||b(this.entities.color)||b(this.entities.quoted)},url:function(){var o;if(!(i.charAt(g)!==
"u"||!b(/url\(/g))){o=b(this.entities.quoted)||b(/[-a-zA-Z0-9_%@$\/.&=:;#+?]+/g);if(!b(")"))throw new Error("missing closing ) for url()");return new e.URL(o.value?o:new e.Anonymous(o))}},variable:function(){var o,z=g;if(i.charAt(g)==="@"&&(o=b(/@[a-zA-Z0-9_-]+/g)))return new e.Variable(o,z)},color:function(){var o;if(i.charAt(g)==="#"&&(o=b(/#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})/g)))return new e.Color(o[1])},dimension:function(){var o;o=i.charCodeAt(g);if(!(o>57||o<45||o===47))if(o=b(/(-?[0-9]*\.?[0-9]+)(px|%|em|pc|ex|in|deg|s|ms|pt|cm|mm)?/g))return new e.Dimension(o[1],
o[2])}},variable:function(){var o;if(i.charAt(g)==="@"&&(o=b(/(@[a-zA-Z0-9_-]+)\s*:/g)))return o[1]},shorthand:function(){var o,z;if(j(/[@\w.-]+\/[@\w.-]+/g))if((o=b(this.entity))&&b("/")&&(z=b(this.entity)))return new e.Shorthand(o,z)},mixin:{call:function(){for(var o=[],z,C,G,M=g;z=b(/[#.][a-zA-Z0-9_-]+/g);){o.push(new e.Element(C,z));C=b(">")}b("(")&&(G=b(this.entities.arguments))&&b(")");if(o.length>0&&(b(";")||j("}")))return new e.mixin.Call(o,G,M)},definition:function(){var o,z=[],C,G;if(!(i.charAt(g)!==
"."||j(/[^{]*(;|})/g)))if(o=b(/([#.][a-zA-Z0-9_-]+)\s*\(/g)){for(o=o[1];C=b(/@[\w-]+/g)||b(this.entities.literal)||b(this.entities.keyword);){if(C[0]==="@")if(b(":"))if(G=b(this.expression))z.push({name:C,value:G});else throw new Error("Expected value");else z.push({name:C});else z.push({value:C});if(!b(","))break}if(!b(")"))throw new Error("Expected )");if(C=b(this.block))return new e.mixin.Definition(o,z,C)}}},entity:function(){return b(this.entities.literal)||b(this.entities.variable)||b(this.entities.url)||
b(this.entities.call)||b(this.entities.keyword)},end:function(){return b(";")||j("}")},alpha:function(){var o;if(b(/opacity=/gi))if(o=b(/[0-9]+/g)||b(this.entities.variable)){if(!b(")"))throw new Error("missing closing ) for alpha()");return new e.Alpha(o)}},element:function(){var o;c=b(this.combinator);if(o=b(/[.#:]?[a-zA-Z0-9_-]+/g)||b("*")||b(this.attribute)||b(/\([^)@]+\)/g))return new e.Element(c,o)},combinator:function(){var o;return(o=b(/[+>~]/g)||b("&")||b(/::/g))?new e.Combinator(o):new e.Combinator(i.charAt(g-
1)===" "?" ":null)},selector:function(){for(var o,z=[];o=b(this.element);)z.push(o);if(z.length>0)return new e.Selector(z)},tag:function(){return b(/[a-zA-Z][a-zA-Z-]*[0-9]?/g)||b("*")},attribute:function(){var o="",z,C,G;if(b("[")){if(z=b(/[a-z-]+/g)||b(this.entities.quoted))o=(G=b(/[|~*$^]?=/g))&&(C=b(this.entities.quoted)||b(/[\w-]+/g))?[z,G,C.toCSS?C.toCSS():C].join(""):z;if(b("]"))if(o)return"["+o+"]"}},block:function(){var o;if(b("{")&&(o=b(this.primary))&&b("}"))return o},ruleset:function(){var o=
[],z,C,G=g;if(z=j(/([a-z.#: _-]+)[\s\n]*\{/g)){g+=z[0].length-1;o=[new e.Selector([new e.Element(null,z[1])])]}else{for(;z=b(this.selector);){o.push(z);if(!b(","))break}z&&b(this.comment)}if(o.length>0&&(C=b(this.block)))return new e.Ruleset(o,C);else{m=g;g=G}},rule:function(){var o,z=g;if(name=b(this.property)||b(this.variable)){if(name.charAt(0)!="@"&&(match=j(/([^@+\/*(;{}-]*);/g))){g+=match[0].length-1;o=new e.Anonymous(match[1])}else o=name==="font"?b(this.font):b(this.value);if(b(this.end))return new e.Rule(name,
o,z);else{m=g;g=z}}},"import":function(){var o;if(b(/@import\s+/g)&&(o=b(this.entities.quoted)||b(this.entities.url))&&b(";"))return new e.Import(o,F)},directive:function(){var o,z,C;if(i.charAt(g)==="@")if(z=b(this["import"]))return z;else if(o=b(/@media|@page/g)){C=b(/[^{]+/g).trim();if(z=b(this.block))return new e.Directive(o+" "+C,z)}else if(o=b(/@[-a-z]+/g))if(o==="@font-face"){if(z=b(this.block))return new e.Directive(o,z)}else if((z=b(this.entity))&&b(";"))return new e.Directive(o,z)},font:function(){for(var o=
[],z=[],C;C=b(this.shorthand)||b(this.entity);)z.push(C);o.push(new e.Expression(z));if(b(","))for(;C=b(this.expression);){o.push(C);if(!b(","))break}return new e.Value(o,b(this.important))},value:function(){for(var o,z=[];o=b(this.expression);){z.push(o);if(!b(","))break}o=b(this.important);if(z.length>0)return new e.Value(z,o)},important:function(){return b(/!\s*important/g)},sub:function(){var o;if(b("(")&&(o=b(this.expression))&&b(")"))return o},multiplication:function(){var o,z,C,G;if(o=b(this.operand)){for(;(C=
b(/[\/*]/g))&&(z=b(this.operand));)G=new e.Operation(C,[G||o,z]);return G||o}},addition:function(){var o,z,C,G;if(o=b(this.multiplication)){for(;(C=b(/[-+]\s+/g)||i.charAt(g-1)!=" "&&b(/[-+]/g))&&(z=b(this.multiplication));)G=new e.Operation(C,[G||o,z]);return G||o}},operand:function(){return b(this.sub)||b(this.entities.dimension)||b(this.entities.color)||b(this.entities.variable)},expression:function(){for(var o,z=[];o=b(this.addition)||b(this.entity);)z.push(o);if(z.length>0)return new e.Expression(z)},
property:function(){var o;if(o=b(/(\*?-?[-a-z_0-9]+)\s*:/g))return o[1]}}}};f.Parser.importer=null;e.functions={rgb:function(d,b,j){return this.rgba(d,b,j,1)},rgba:function(d,b,j,i){d=[d,b,j].map(function(g){return u(g)});i=u(i);return new e.Color(d,i)},hsl:function(d,b,j){return this.hsla(d,b,j,1)},hsla:function(d,b,j,i){function g(p){p=p<0?p+1:p>1?p-1:p;return p*6<1?m+(k-m)*p*6:p*2<1?k:p*3<2?m+(k-m)*(2/3-p)*6:m}d=(u(d)%360+360)%360/360;b=u(b);j=u(j);i=u(i);var k=j<=0.5?j*(b+1):j+b-j*b,m=j*2-k;return this.rgba(g(d+
1/3)*255,g(d)*255,g(d-1/3)*255,i)},opacity:function(d,b){u(b);return new e.Color(d.rgb,u(b))},saturate:function(d,b){d=d.toHSL();d.s+=b.value/100;d.s=q(d.s);return this.hsl(d.h,d.s,d.l)},desaturate:function(d,b){d=d.toHSL();d.s-=b.value/100;d.s=q(d.s);return this.hsl(d.h,d.s,d.l)},lighten:function(d,b){d=d.toHSL();d.l*=1+b.value/100;d.l=q(d.l);return this.hsl(d.h,d.s,d.l)},darken:function(d,b){d=d.toHSL();d.l*=1-b.value/100;d.l=q(d.l);return this.hsl(d.h,d.s,d.l)},greyscale:function(d){return this.desaturate(d,
new e.Dimension(100))},e:function(d){return new e.Anonymous(d)},"%":function(d){for(var b=Array.prototype.slice.call(arguments,1),j=d.content,i=0;i<b.length;i++)j=j.replace(/%s/,b[i].content).replace(/%[da]/,b[i].toCSS());j=j.replace(/%%/g,"%");return new e.Quoted('"'+j+'"',j)}};e.Alpha=function(d){this.value=d};e.Alpha.prototype={toCSS:function(){return"alpha(opacity="+this.value.toCSS()+")"},eval:function(){return this}};e.Anonymous=function(d){this.value=d.content||d};e.Anonymous.prototype={toCSS:function(){return this.value},
eval:function(){return this}};e.Call=function(d,b){this.name=d;this.args=b};e.Call.prototype={eval:function(d){var b=this.args.map(function(j){return j.eval(d)});return this.name in e.functions?e.functions[this.name].apply(e.functions,b):new e.Anonymous(this.name+"("+b.map(function(j){return j.toCSS()}).join(", ")+")")},toCSS:function(d){return this.eval(d).toCSS()}};e.Color=function(d,b){if(Array.isArray(d)){this.rgb=d;this.alpha=b}else this.rgb=d.length==6?d.match(/.{2}/g).map(function(j){return parseInt(j,
16)}):d.split("").map(function(j){return parseInt(j+j,16)})};e.Color.prototype={eval:function(){return this},toCSS:function(){return this.alpha&&this.alpha<1?"rgba("+this.rgb.concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(d){d=Math.round(d);d=(d>255?255:d<0?0:d).toString(16);return d.length===1?"0"+d:d}).join("")},operate:function(d,b){var j=[];b instanceof e.Color||(b=b.toColor());for(var i=0;i<3;i++)j[i]=e.operate(d,this.rgb[i],b.rgb[i]);return new e.Color(j)},toHSL:function(){var d=
this.rgb[0]/255,b=this.rgb[1]/255,j=this.rgb[2]/255,i=Math.max(d,b,j),g=Math.min(d,b,j),k,m=(i+g)/2,p=i-g;if(i===g)k=g=0;else{g=m>0.5?p/(2-i-g):p/(i+g);switch(i){case d:k=(b-j)/p+(b<j?6:0);break;case b:k=(j-d)/p+2;break;case j:k=(d-b)/p+4;break}k/=6}return{h:k*360,s:g,l:m}}};e.Comment=function(d){this.value=d};e.Comment.prototype={toCSS:function(){return this.value}};e.Dimension=function(d,b){this.value=parseFloat(d);this.unit=b||null};e.Dimension.prototype={eval:function(){return this},toColor:function(){return new e.Color([this.value,
this.value,this.value])},toCSS:function(){return this.value+this.unit},operate:function(d,b){return new e.Dimension(e.operate(d,this.value,b.value),this.unit||b.unit)}};e.Directive=function(d,b){this.name=d;if(Array.isArray(b))this.ruleset=new e.Ruleset([],b);else this.value=b};e.Directive.prototype={toCSS:function(d,b){if(this.ruleset){this.ruleset.root=true;return this.name+" {\n  "+this.ruleset.toCSS(d,b).trim().replace(/\n/g,"\n  ")+"\n}\n"}else return this.name+" "+this.value.toCSS()+";\n"},
eval:function(d){d.frames.unshift(this);this.ruleset&&this.ruleset.evalRules(d);d.frames.shift();return this},variable:function(d){return e.Ruleset.prototype.variable.call(this.ruleset,d)},find:function(){return e.Ruleset.prototype.find.apply(this.ruleset,arguments)},rulesets:function(){return e.Ruleset.prototype.rulesets.apply(this.ruleset)}};e.Element=function(d,b){this.combinator=d instanceof e.Combinator?d:new e.Combinator(d);this.value=b.trim()};e.Element.prototype.toCSS=function(){return this.combinator.toCSS()+
this.value};e.Combinator=function(d){this.value=d===" "?" ":d?d.trim():""};e.Combinator.prototype.toCSS=function(){switch(this.value){case "":return"";case " ":return" ";case "&":return"";case ":":return" :";case "::":return"::";case "+":return" + ";case "~":return" ~ ";case ">":return" > "}};e.Expression=function(d){this.value=d};e.Expression.prototype={eval:function(d){return this.value.length>1?new e.Expression(this.value.map(function(b){return b.eval(d)})):this.value[0].eval(d)},toCSS:function(){return this.value.map(function(d){return d.toCSS()}).join(" ")}};
e.Import=function(d,b){var j=this;this._path=d;this.path=d instanceof e.Quoted?/\.(le?|c)ss$/.test(d.content)?d.content:d.content+".less":d.value.content||d.value;(this.css=/css$/.test(this.path))||b.push(this.path,function(i){j.root=i})};e.Import.prototype={toCSS:function(){return this.css?"@import "+this._path.toCSS()+";\n":""},eval:function(){if(this.css)return this;else{for(var d=0;d<this.root.rules.length;d++)this.root.rules[d]instanceof e.Import&&Array.prototype.splice.apply(this.root.rules,
[d,1].concat(this.root.rules[d].eval()));return this.root.rules}}};e.Keyword=function(d){this.value=d};e.Keyword.prototype={eval:function(){return this},toCSS:function(){return this.value}};e.mixin={};e.mixin.Call=function(d,b,j){this.selector=new e.Selector(d);this.arguments=b;this.index=j};e.mixin.Call.prototype={eval:function(d){for(var b,j=[],i=false,g=0;g<d.frames.length;g++)if((b=d.frames[g].find(this.selector)).length>0){for(g=0;g<b.length;g++)if(b[g].match(this.arguments,d))try{Array.prototype.push.apply(j,
b[g].eval(this.arguments,d).rules);i=true}catch(k){throw{message:k.message,index:this.index};}if(i)return j;else throw{message:"No matching definition was found for `"+this.selector.toCSS().trim()+"("+this.arguments.map(function(m){return m.toCSS()}).join(", ")+")`",index:this.index};}throw{message:this.selector.toCSS().trim()+" is undefined",index:this.index};}};e.mixin.Definition=function(d,b,j){this.name=d;this.selectors=[new e.Selector([new e.Element(null,d)])];this.params=b;this.arity=b.length;
this.rules=j;this._lookups={};this.required=b.reduce(function(i,g){return g.name&&!g.value?i+1:i},0)};e.mixin.Definition.prototype={toCSS:function(){return""},variable:function(d){return e.Ruleset.prototype.variable.call(this,d)},find:function(){return e.Ruleset.prototype.find.apply(this,arguments)},rulesets:function(){return e.Ruleset.prototype.rulesets.apply(this)},eval:function(d,b){for(var j=new e.Ruleset(null,[]),i=0,g;i<this.params.length;i++)if(this.params[i].name)if(g=d&&d[i]||this.params[i].value)j.rules.unshift(new e.Rule(this.params[i].name,
g.eval(b)));else throw{message:"wrong number of arguments for "+this.name+" ("+d.length+" for "+this.arity+")"};return(new e.Ruleset(null,this.rules)).evalRules({frames:[this,j].concat(b.frames)})},match:function(d,b){var j=d&&d.length||0;if(j<this.required)return false;for(var i=0;i<Math.min(j,this.arity);i++)if(!this.params[i].name)if(!d[i].wildcard)if(d[i].eval(b).toCSS()!=this.params[i].value.eval(b).toCSS())return false;return true}};e.Operation=function(d,b){this.op=d.trim();this.operands=b};
e.Operation.prototype.eval=function(d){var b=this.operands[0].eval(d);d=this.operands[1].eval(d);var j;if(b instanceof e.Dimension&&d instanceof e.Color)if(this.op==="*"||this.op==="+"){j=d;d=b;b=j}else throw{name:"OperationError",message:"Can't substract or divide a color from a number"};return b.operate(this.op,d)};e.operate=function(d,b,j){switch(d){case "+":return b+j;case "-":return b-j;case "*":return b*j;case "/":return b/j}};e.Quoted=function(d,b){this.value=d;this.content=b};e.Quoted.prototype=
{toCSS:function(){return this.value},eval:function(){return this}};e.Rule=function(d,b,j){this.name=d;this.value=b instanceof e.Value?b:new e.Value([b]);this.index=j;this.variable=d.charAt(0)==="@"?true:false};e.Rule.prototype.toCSS=function(){return this.variable?"":this.name+": "+this.value.toCSS()+";"};e.Rule.prototype.eval=function(d){return new e.Rule(this.name,this.value.eval(d))};e.Value=function(d){this.value=d;this.is="value"};e.Value.prototype={eval:function(d){return this.value.length===
1?this.value[0].eval(d):new e.Value(this.value.map(function(b){return b.eval(d)}))},toCSS:function(){return this.value.map(function(d){return d.toCSS()}).join(", ")}};e.Shorthand=function(d,b){this.a=d;this.b=b};e.Shorthand.prototype={toCSS:function(d){return this.a.toCSS(d)+"/"+this.b.toCSS(d)},eval:function(){return this}};e.Ruleset=function(d,b){this.selectors=d;this.rules=b;this._lookups={}};e.Ruleset.prototype={eval:function(){return this},evalRules:function(d){var b=[];this.rules.forEach(function(j){if(j.evalRules)b.push(j.evalRules(d));
else j instanceof e.mixin.Call?Array.prototype.push.apply(b,j.eval(d)):b.push(j.eval(d))});this.rules=b;return this},match:function(d){return!d||d.length===0},variable:function(d){return this._variables?this._variables[d]:(this._variables=this.rules.reduce(function(b,j){if(j instanceof e.Rule&&j.variable===true)b[j.name]=j;return b},{}))[d]},rulesets:function(){return this._rulesets?this._rulesets:(this._rulesets=this.rules.filter(function(d){if(d instanceof e.Ruleset||d instanceof e.mixin.Definition)return d}))},
find:function(d,b){b=b||this;var j=[],i=d.toCSS();if(i in this._lookups)return this._lookups[i];this.rulesets().forEach(function(g){if(g!==b)for(var k=0;k<g.selectors.length;k++)if(d.match(g.selectors[k])){d.elements.length>1?Array.prototype.push.apply(j,g.find(new e.Selector(d.elements.slice(1)),b)):j.push(g);break}});return this._lookups[i]=j},toCSS:function(d,b){var j=[],i=[],g=[],k=[];if(this.root){d=[];b={frames:[]};for(var m=0;m<this.rules.length;m++)this.rules[m]instanceof e.Import&&Array.prototype.splice.apply(this.rules,
[m,1].concat(this.rules[m].eval(b)))}else if(d.length===0)k=this.selectors.map(function(y){return[y]});else for(m=0;m<this.selectors.length;m++)for(var p=0;p<d.length;p++)k.push(d[p].concat([this.selectors[m]]));b.frames.unshift(this);for(m=0;m<this.rules.length;m++)this.rules[m]instanceof e.mixin.Call&&Array.prototype.splice.apply(this.rules,[m,1].concat(this.rules[m].eval(b)));for(m=0;m<this.rules.length;m++){d=this.rules[m];if(d instanceof e.Directive)g.push(d.eval(b).toCSS(k,b));else if(d.rules)g.push(d.toCSS(k,
b));else if(d instanceof e.Comment)this.root?g.push(d.toCSS()):i.push(d.toCSS());else if(d.toCSS&&!d.variable)i.push(d.eval(b).toCSS());else d.value&&!d.variable&&i.push(d.value.toString())}g=g.join("");if(this.root)j.push(i.join("\n"));else if(i.length>0){k=k.map(function(y){return y.map(function(v){return v.toCSS()}).join("").trim()}).join(k.length>3?",\n":", ");j.push(k," {\n  "+i.join("\n  ")+"\n}\n")}j.push(g);b.frames.shift();return j.join("")}};e.Selector=function(d){this.elements=d;if(this.elements[0].combinator.value===
"")this.elements[0].combinator.value=" "};e.Selector.prototype.match=function(d){return this.elements[0].value===d.elements[0].value?true:false};e.Selector.prototype.toCSS=function(){if(this._css)return this._css;return this._css=this.elements.map(function(d){return typeof d==="string"?" "+d.trim():d.toCSS()}).join("")};e.URL=function(d){this.value=d};e.URL.prototype={toCSS:function(){return"url("+this.value.toCSS()+")"},eval:function(){return this}};e.Variable=function(d,b){this.name=d;this.index=
b};e.Variable.prototype={eval:function(d){var b,j,i=this.name;if(b=e.find(d.frames,function(g){if(j=g.variable(i))return j.value.eval(d)}))return b;else throw{message:"variable "+this.name+" is undefined",index:this.index};}};e.find=function(d,b){for(var j=0,i;j<d.length;j++)if(i=b.call(d,d[j]))return i;return null};(function(){function d(v){for(var h=0;h<p.length;h++)b(p[h],v)}function b(v,h){var A=typeof localStorage!=="undefined"&&localStorage.getItem(v.href),F=A&&JSON.parse(A);i(v.href,function(o,
z){if(F&&(new Date(z)).valueOf()===(new Date(F.timestamp)).valueOf()){j(F.css,v);h(null,v,{local:true})}else(new f.Parser({optimization:3})).parse(o,function(C,G){if(C)return m(C,v.href);try{h(G,v,{local:false,lastModified:z})}catch(M){m(M,v.href)}})},function(o){throw new Error("Couldn't load "+v.href+" ("+o+")");})}function j(v,h,A){var F=document.createElement("style");F.type="text/css";F.media="screen";F.title="less-sheet";if(h){F.title=h.title||h.href.match(/(?:^|\/)([-\w]+)\.[a-z]+$/i)[1];A&&
typeof localStorage!=="undefined"&&localStorage.setItem(h.href,JSON.stringify({timestamp:A,css:v}))}if(F.styleSheet)F.styleSheet.cssText=v;else F.appendChild(document.createTextNode(v));document.getElementsByTagName("head")[0].appendChild(F)}function i(v,h,A){var F=g();if(window.location.protocol==="file:"){F.open("GET",v,false);F.send(null);F.status===0?h(F.responseText):A(F.status)}else{F.open("GET",v,true);F.onreadystatechange=function(){if(F.readyState==4)if(F.status>=200&&F.status<300)h(F.responseText,
F.getResponseHeader("Last-Modified"));else typeof A==="function"&&A(F.status)};F.send(null)}}function g(){if(window.XMLHttpRequest)return new XMLHttpRequest;else try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(v){k("less: browser doesn't support AJAX.");return null}}function k(v){f.env=="development"&&typeof console!=="undefined"&&console.log(v)}function m(v,h){var A=document.createElement("div"),F;A.id="less-error-message";A.innerHTML="<h3>"+(v.message||"There is an error in your .less file")+
'</h3><p><a href="'+h+'">'+h+"</a> on line "+v.line+", column "+(v.column+1)+":</p>"+'<div>\n<pre class="ctx"><span>[-1]</span>{0}</pre>\n<pre><span>[0]</span>{current}</pre>\n<pre class="ctx"><span>[1]</span>{2}</pre>\n</div>'.replace(/\[(-?\d)\]/g,function(o,z){return v.line+parseInt(z)}).replace(/\{(\d)\}/g,function(o,z){return v.extract[parseInt(z)]}).replace(/\{current\}/,v.extract[1].slice(0,v.column)+'<span class="error">'+v.extract[1].slice(v.column)+"</span>");j("#less-error-message span {margin-right: 15px;}#less-error-message pre {color: #ee4444;padding: 4px 0;margin: 0;}#less-error-message pre.ctx {color: #dd7777;}#less-error-message h3 {padding: 15px 0 5px 0;margin: 0;}#less-error-message a {color: #10a}#less-error-message .error {color: red;font-weight: bold;padding-bottom: 2px;border-bottom: 1px dashed red;}");
A.style.cssText="font-family: Arial, sans-serif;border: 1px solid #e00;background-color: #eee;border-radius: 5px;color: #e00;padding: 15px;margin-bottom: 15px";if(f.env=="development")F=setInterval(function(){if(document.body){document.body.insertBefore(A,document.body.childNodes[0]);clearInterval(F)}},10)}var p=[];f.env=location.hostname=="127.0.0.1"||location.hostname=="0.0.0.0"||location.hostname=="localhost"||location.protocol=="file:"?"development":"production";var y=setInterval(function(){if(document.body){if(!document.querySelectorAll&&
typeof jQuery==="undefined")k("No selector method found");else p=(document.querySelectorAll||jQuery).call(document,'link[rel="stylesheet/less"]');clearInterval(y);d(function(v,h,A){j(v.toCSS(),h,A.lastModified);A.local?k("less: loading "+h.href+" from local storage."):k("less: parsed "+h.href+" successfully.")})}},10);if(f.env==="development")refreshTimer=setInterval(function(){/!refresh/.test(location.hash)&&d(function(v,h,A){j(v.toCSS(),h,A)})},1E3);f.Parser.importer=function(v,h,A){b({href:v,title:v},
function(F){A(F)})}})()});bespin.tiki.register("::theme_manager_base",{name:"theme_manager_base",dependencies:{}});bespin.tiki.module("theme_manager_base:index",function(){});bespin.tiki.register("::canon",{name:"canon",dependencies:{environment:"0.0.0",events:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("canon:history",function(x,s){var u=x("bespin:util/stacktrace").Trace,q=x("bespin:plugins").catalog;s.requests=[];s.addRequestOutput=function(f){for(s.requests.push(f);s.requests.length>100;)s.requests.shiftObject();q.publish(this,"addedRequestOutput",null,f)};s.execute=function(f,e){if(e.command)try{e.command(f,e)}catch(d){var b=new u(d,true);console.group("Error executing command '"+e.typed+"'");console.log("command=",e.commandExt);console.log("args=",f);console.error(d);b.log(3);
console.groupEnd();e.doneWithError(d)}else e.doneWithError("Command not found.")}});
bespin.tiki.module("canon:request",function(x,s){var u=x("events").Event,q=x("canon:history");s.Request=function(f){f=f||{};this.command=f.command;this.commandExt=f.commandExt;this.args=f.args;this.typed=f.typed;this._begunOutput=false;this.start=new Date;this.end=null;this.error=this.completed=false;this.changed=new u};s.Request.prototype._beginOutput=function(){this._begunOutput=true;this.outputs=[];q.addRequestOutput(this)};s.Request.prototype.doneWithError=function(f){this.error=true;this.done(f)};
s.Request.prototype.async=function(){this._begunOutput||this._beginOutput()};s.Request.prototype.output=function(f){this._begunOutput||this._beginOutput();if(typeof f!=="string"&&!(f instanceof Node))f=f.toString();this.outputs.push(f);this.changed();return this};s.Request.prototype.done=function(f){this.completed=true;this.end=new Date;this.duration=this.end.getTime()-this.start.getTime();f?this.output(f):this.changed()}});bespin.tiki.module("canon:index",function(){});
bespin.tiki.register("::traits",{name:"traits",dependencies:{}});
bespin.tiki.module("traits:index",function(x,s){s.Trait=function(){function u(P){var Q=function(){throw new Error("Conflicting property: "+P);};T(Q.prototype);return T(Q)}function q(){return T({value:undefined,enumerable:false,required:true})}function f(P){P=u(P);return o?T({get:P,set:P,enumerable:false,conflict:true}):T({value:P,enumerable:false,conflict:true})}function e(P,Q){return P===Q?P!==0||1/P===1/Q:P!==P&&Q!==Q}function d(P,Q){return P.conflict&&Q.conflict?true:P.get===Q.get&&P.set===Q.set&&
e(P.value,Q.value)&&P.enumerable===Q.enumerable&&P.required===Q.required&&P.conflict===Q.conflict}function b(P,Q){return T(C(P,Q))}function j(P){var Q={};Z(P,function(S){Q[S]=true});return T(Q)}function i(P){var Q={};Z(ca(P),function(S){var U=ha(P,S);if(U.value===na)U=q(S);else if(typeof U.value==="function"){U.method=true;"prototype"in U.value&&T(U.value.prototype)}else{U.get&&U.get.prototype&&T(U.get.prototype);U.set&&U.set.prototype&&T(U.set.prototype)}Q[S]=U});return Q}function g(){var P=M(arguments,
0),Q={};Z(P,function(S){Z(ca(S),function(U){var aa=S[U];if(G(Q,U)&&!Q[U].required)aa.required||d(Q[U],aa)||(Q[U]=f(U));else Q[U]=aa})});return T(Q)}function k(P,Q){var S=j(P),U={};Z(ca(Q),function(aa){U[aa]=!G(S,aa)||Q[aa].required?Q[aa]:q(aa)});return T(U)}function m(){var P=M(arguments,0),Q={};Z(P,function(S){Z(ca(S),function(U){var aa=S[U];if(!G(Q,U)||Q[U].required)Q[U]=aa})});return T(Q)}function p(P,Q){var S={};Z(ca(Q),function(U){if(G(P,U)&&!Q[U].required){var aa=P[U];S[aa]=G(S,aa)&&!S[aa].required?
f(aa):Q[U];G(S,U)||(S[U]=q(U))}else if(G(S,U))Q[U].required||(S[U]=f(U));else S[U]=Q[U]});return T(S)}function y(P,Q){var S={},U=[];for(var aa in P)if(G(P,aa))if(P[aa])S[aa]=P[aa];else U.push(aa);return p(S,k(U,Q))}function v(P,Q){var S=ma(P),U={};Z(ca(Q),function(aa){var fa=Q[aa];if(fa.required&&!(aa in P))throw new Error("Missing required property: "+aa);else if(fa.conflict)throw new Error("Remaining conflicting property: "+aa);else U[aa]="value"in fa?fa.method?{value:b(fa.value,S),enumerable:fa.enumerable,
configurable:fa.configurable,writable:fa.writable}:fa:{get:fa.get?b(fa.get,S):undefined,set:fa.set?b(fa.set,S):undefined,enumerable:fa.enumerable,configurable:fa.configurable,writable:fa.writable}});la(S,U);return T(S)}function h(P,Q){return v(Object.prototype,i(P),Q)}function A(P,Q){var S=ca(P),U=ca(Q);if(S.length!==U.length)return false;for(var aa=0;aa<S.length;aa++){U=S[aa];if(!Q[U]||!d(P[U],Q[U]))return false}return true}function F(P){return i(P)}var o=!!Object.defineProperty,z=Function.prototype.call,
C=Function.prototype.bind?function(P,Q){return Function.prototype.bind.call(P,Q)}:function(P,Q){function S(){return P.apply(Q,arguments)}return S},G=C(z,Object.prototype.hasOwnProperty),M=C(z,Array.prototype.slice),Z=Array.prototype.forEach?C(z,Array.prototype.forEach):function(P,Q){for(var S=0,U=P.length;S<U;S++)Q(P[S])},T=Object.freeze||function(P){return P},ca=Object.getOwnPropertyNames||function(P){var Q=[];for(var S in P)G(P,S)&&Q.push(S);return Q},ha=Object.getOwnPropertyDescriptor||function(P,
Q){return{value:P[Q],enumerable:true,writable:true,configurable:true}},ga=Object.defineProperty||function(P,Q,S){P[Q]=S.value},la=Object.defineProperties||function(P,Q){for(var S in Q)G(Q,S)&&ga(P,S,Q[S])},ma=Object.create||function(P,Q){function S(){}S.prototype=P||Object.prototype;P=new S;Q&&la(P,Q);return P};z=Object.getOwnProperties||function(P){var Q={};Z(ca(P),function(S){Q[S]=ha(P,S)});return Q};var na=T({toString:function(){return"<Trait.required>"}});if(!Object.create)Object.create=ma;if(!Object.getOwnProperties)Object.getOwnProperties=
z;F.required=T(na);F.compose=T(g);F.resolve=T(y);F.override=T(m);F.create=T(v);F.eqv=T(A);F.object=T(h);return T(F)}()});bespin.tiki.register("::keyboard",{name:"keyboard",dependencies:{canon:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("keyboard:keyboard",function(x,s){var u=x("bespin:plugins").catalog;x("bespin:console");x("bespin:util/stacktrace");var q=x("bespin:util/util"),f=x("settings").settings,e=x("keyboard:keyutil"),d=x("canon:history"),b=x("canon:request").Request,j=x("environment").env;s.buildFlags=function(i){i.context=j.contexts[0];return i};x=function(){};q.mixin(x.prototype,{_customKeymappingCache:{states:{}},processKeyEvent:function(i,g,k){i=e.commandCodes(i,true)[0];if(q.none(i))return false;
s.buildFlags(k);k.isCommandKey=true;return this._matchCommand(i,g,k)},_matchCommand:function(i,g,k){var m=this._findCommandExtension(i,g,k);if(m&&m.commandExt!=="no command"){k.isTextView&&g.resetKeyBuffers();var p=m.commandExt;p.load(function(y){y=new b({command:y,commandExt:p});d.execute(m.args,y)});return true}return m&&m.commandExt==="no command"?true:false},_buildBindingsRegex:function(i){i.forEach(function(g){if(q.none(g.key))if(Array.isArray(g.regex)){g.key=new RegExp("^"+g.regex[1]+"$");g.regex=
new RegExp(g.regex.join("")+"$")}else g.regex=new RegExp(g.regex+"$");else g.key=new RegExp("^"+g.key+"$")})},_buildKeymappingRegex:function(i){for(state in i.states)this._buildBindingsRegex(i.states[state]);i._convertedRegExp=true},_findCommandExtension:function(i,g,k){if(k.isTextView){var m=g._keyState;if(!k.isCommandKey||i.indexOf("alt_")===-1){g._keyBuffer+=i.replace(/ctrl_meta|meta/,"ctrl");g._keyMetaBuffer+=i}var p=[this._customKeymappingCache];p=p.concat(u.getExtensions("keymapping"));for(var y=
0;y<p.length;y++)if(!q.none(p[y].states[m])){q.none(p[y]._convertedRegExp)&&this._buildKeymappingRegex(p[y]);var v=this._bindingsMatch(i,k,g,p[y]);if(!q.none(v))return v}}g=u.getExtensions("command");var h=null;m={};i=i.replace(/ctrl_meta|meta/,"ctrl");g.some(function(A){if(this._commandMatches(A,i,k)){h=A;return true}return false}.bind(this));return q.none(h)?null:{commandExt:h,args:m}},_bindingsMatch:function(i,g,k,m){var p,y=null,v={},h;h=q.none(m.hasMetaKey)?k._keyMetaBuffer:k._keyBuffer;if(i.indexOf("alt_")===
0&&g.isCommandKey)h+=i;m.states[k._keyState].some(function(A){if(A.key&&!A.key.test(i))return false;if(A.regex&&!(p=A.regex.exec(h)))return false;if(A.disallowMatches)for(var F=0;F<A.disallowMatches.length;F++)if(p[A.disallowMatches[F]])return true;if(!s.flagsMatch(A.predicates,g))return false;if(A.exec){y=u.getExtensionByKey("command",A.exec);if(q.none(y))throw new Error("Can't find command "+A.exec+" in state="+k._keyState+", symbolicName="+i);if(A.params){var o;A.params.forEach(function(z){o=!q.none(z.match)&&
!q.none(p)?p[z.match]||z.defaultValue:z.defaultValue;if(z.type==="number")o=parseInt(o);v[z.name]=o})}k.resetKeyBuffers()}if(A.then){k._keyState=A.then;k.resetKeyBuffers()}if(q.none(y))y="no command";return true});if(q.none(y))return null;return{commandExt:y,args:v}},_commandMatches:function(i,g,k){var m=i.key;if(!m)return false;if(!s.flagsMatch(i.predicates,k))return false;if(typeof m==="string"){if(m!=g)return false;return true}if(!Array.isArray(m)){m=[m];i.key=m}for(i=0;i<m.length;i++){var p=m[i];
if(typeof p==="string"){if(p==g)return true}else if(p.key==g)return s.flagsMatch(p.predicates,k)}return false},_customKeymappingChanged:function(){var i=this._customKeymappingCache=JSON.parse(f.get("customKeymapping"));i.states=i.states||{};for(state in i.states)this._buildBindingsRegex(i.states[state]);i._convertedRegExp=true}});s.flagsMatch=function(i,g){if(q.none(i))return true;if(!g)return false;for(var k in i)if(g[k]!==i[k])return false;return true};s.keyboardManager=new x;u.registerExtension("settingChange",
{match:"customKeymapping",pointer:s.keyboardManager._customKeymappingChanged.bind(s.keyboardManager)})});
bespin.tiki.module("keyboard:keyutil",function(x,s){var u=x("bespin:util/util");s.KeyHelper=function(){var f={MODIFIER_KEYS:{16:"shift",17:"ctrl",18:"alt",224:"meta"},FUNCTION_KEYS:{8:"backspace",9:"tab",13:"return",19:"pause",27:"escape",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"printscreen",45:"insert",46:"delete",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock"},PRINTABLE_KEYS:{32:" ",
48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",59:";",61:"=",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",107:"+",109:"-",110:".",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:'"'},PRINTABLE_KEYS_CHARCODE:{},KEY:{}};for(var e in f.PRINTABLE_KEYS){var d=f.PRINTABLE_KEYS[e];f.PRINTABLE_KEYS_CHARCODE[d.charCodeAt(0)]=e;if(d.toUpperCase()!=
d)f.PRINTABLE_KEYS_CHARCODE[d.toUpperCase().charCodeAt(0)]=e}for(e in f.FUNCTION_KEYS){d=f.FUNCTION_KEYS[e].toUpperCase();f.KEY[d]=parseInt(e,10)}return f}();var q=function(f){return!!(f.altKey||f.ctrlKey||f.metaKey||f.charCode!==f.which&&s.KeyHelper.FUNCTION_KEYS[f.which])};s.commandCodes=function(f,e){var d=f._keyCode||f.keyCode,b=f._charCode===undefined?f.charCode:f._charCode,j=null,i=null,g="",k=true;if(d===0&&f.which===0)return false;if(b!==0)return false;if(s.KeyHelper.MODIFIER_KEYS[b])return[s.KeyHelper.MODIFIER_KEYS[b],
null];if(d){j=s.KeyHelper.FUNCTION_KEYS[d];if(!j&&(f.altKey||f.ctrlKey||f.metaKey)){j=s.KeyHelper.PRINTABLE_KEYS[d];if(d>47&&d<58)k=f.altKey}if(j){if(f.altKey)g+="alt_";if(f.ctrlKey)g+="ctrl_";if(f.metaKey)g+="meta_"}else if(f.ctrlKey||f.metaKey)return false}if(!j){d=f.which;i=j=String.fromCharCode(d);d=j.toLowerCase();if(f.metaKey){g="meta_";j=d}else j=null}if(f.shiftKey&&j&&k)g+="shift_";if(j)j=g+j;if(!e&&j)j=j.replace(/ctrl_meta|meta/,"ctrl");return[j,i]};s.addKeyDownListener=function(f,e){var d=
function(b){var j=e(b);j&&u.stopEvent(b);return j};f.addEventListener("keydown",function(b){if(u.isMozilla)if(s.KeyHelper.FUNCTION_KEYS[b.keyCode])return true;else if((b.ctrlKey||b.metaKey)&&s.KeyHelper.PRINTABLE_KEYS[b.keyCode])return true;if(q(b))return d(b);return true},false);f.addEventListener("keypress",function(b){if(u.isMozilla)if(s.KeyHelper.FUNCTION_KEYS[b.keyCode])return d(b);else if((b.ctrlKey||b.metaKey)&&s.KeyHelper.PRINTABLE_KEYS_CHARCODE[b.charCode]){b._keyCode=s.KeyHelper.PRINTABLE_KEYS_CHARCODE[b.charCode];
b._charCode=0;return d(b)}if(b.charCode!==undefined&&b.charCode===0)return true;return d(b)},false)}});bespin.tiki.module("keyboard:index",function(){});bespin.tiki.register("::worker_manager",{name:"worker_manager",dependencies:{canon:"0.0.0",events:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("worker_manager:index",function(x,s){function u(g){var k=/^([^#:]+)(?::([^#:]+))?#([^#:]+)$/.exec(g);if(k==null)throw new Error('WorkerSupervisor: invalid pointer specification: "'+g+'"');g=k[1];var m=k[3];k=g+":"+(k[2]!=null?k[2]:"index");var p=bespin!=null&&bespin.base!=null?bespin.base:"";this._packageId=g;this._moduleId=k;this._base=p;this._target=m;this._worker=null;this._currentId=0;this.started=new b}function q(){i.restartAll()}if(window==null)throw new Error('The "worker_manager" plugin can only be loaded in the browser, not a web worker. Use "worker" instead.');
var f=x("bespin:proxy");x("bespin:plugins");var e=x("bespin:console").console,d=x("underscore")._,b=x("events").Event,j=x("bespin:promise").Promise;x("environment");var i={_workers:[],add:function(g){this._workers.push(g)},remove:function(g){this._workers=d(this._workers).without(g)},restartAll:function(){var g=this._workers;d(g).invoke("kill");d(g).invoke("start")}};u.prototype={_onError:function(g){this._worker=null;i.remove(this);e.error("WorkerSupervisor: worker failed at file "+g.filename+":"+
g.lineno+"; fix the worker and use 'worker restart' to restart it")},_onMessage:function(g){g=JSON.parse(g.data);switch(g.op){case "finish":if(g.id===this._currentId){var k=this._promise;this._promise=null;k.resolve(g.result)}break;case "log":e[g.method].apply(e,g.args);break}},_promise:null,started:null,kill:function(){var g=this._promise;if(g!=null){g.reject("killed");this._promise=null}this._worker.terminate();this._worker=null;i.remove(this)},send:function(g,k){var m=this._promise;if(m!=null){m.reject("interrupted");
this._currentId++}m=this._currentId;var p=new j;this._promise=p;this._worker.postMessage(JSON.stringify({op:"invoke",id:m,method:g,args:k}));return p},start:function(){if(this._worker!=null)throw new Error("WorkerSupervisor: worker already started");var g=this._base,k=this._target,m=this._packageId,p=this._moduleId,y=new f.Worker(g+"BespinEmbedded.js");y.onmessage=this._onMessage.bind(this);y.onerror=this._onError.bind(this);y.postMessage(JSON.stringify({op:"load",base:g,pkg:m,module:p,target:k}));
this._worker=y;this._currentId=0;i.add(this);this.started()}};s.WorkerSupervisor=u;s.workerManager=i;s.workerRestartCommand=q});bespin.tiki.register("::diff",{name:"diff",dependencies:{}});
bespin.tiki.module("diff:index",function(x,s){function u(){function f(){for(var e=0,d=1,b=2;d!=b;){e++;d=b;b<<=1}return e}this.Diff_Timeout=1;this.Diff_EditCost=4;this.Diff_DualThreshold=32;this.Match_Threshold=0.5;this.Match_Distance=1E3;this.Patch_DeleteThreshold=0.5;this.Patch_Margin=4;this.Match_MaxBits=f()}function q(){this.diffs=[];this.start2=this.start1=null;this.length2=this.length1=0}u.prototype.diff_main=function(f,e,d){if(f==e)return[[0,f]];if(typeof d=="undefined")d=true;var b=d,j=this.diff_commonPrefix(f,
e);d=f.substring(0,j);f=f.substring(j);e=e.substring(j);j=this.diff_commonSuffix(f,e);var i=f.substring(f.length-j);f=f.substring(0,f.length-j);e=e.substring(0,e.length-j);f=this.diff_compute(f,e,b);d&&f.unshift([0,d]);i&&f.push([0,i]);this.diff_cleanupMerge(f);return f};u.prototype.diff_compute=function(f,e,d){var b;if(!f)return[[1,e]];if(!e)return[[-1,f]];b=f.length>e.length?f:e;var j=f.length>e.length?e:f,i=b.indexOf(j);if(i!=-1){b=[[1,b.substring(0,i)],[0,j],[1,b.substring(i+j.length)]];if(f.length>
e.length)b[0][0]=b[2][0]=-1;return b}if(b=this.diff_halfMatch(f,e)){e=b[1];var g=b[3];f=b[4];b=this.diff_main(b[0],b[2],d);d=this.diff_main(e,g,d);return b.concat([[0,f]],d)}if(d&&(f.length<100||e.length<100))d=false;if(d){g=this.diff_linesToChars(f,e);f=g[0];e=g[1];g=g[2]}(b=this.diff_map(f,e))||(b=[[-1,f],[1,e]]);if(d){this.diff_charsToLines(b,g);this.diff_cleanupSemantic(b);b.push([0,""]);e=f=d=0;for(j=g="";d<b.length;){switch(b[d][0]){case 1:e++;j+=b[d][1];break;case -1:f++;g+=b[d][1];break;case 0:if(f>=
1&&e>=1){g=this.diff_main(g,j,false);b.splice(d-f-e,f+e);d=d-f-e;for(f=g.length-1;f>=0;f--)b.splice(d,0,g[f]);d+=g.length}f=e=0;j=g="";break}d++}b.pop()}return b};u.prototype.diff_linesToChars=function(f,e){function d(i){for(var g="",k=0,m=-1,p=b.length;m<i.length-1;){m=i.indexOf("\n",k);if(m==-1)m=i.length-1;var y=i.substring(k,m+1);k=m+1;if(j.hasOwnProperty?j.hasOwnProperty(y):j[y]!==undefined)g+=String.fromCharCode(j[y]);else{g+=String.fromCharCode(p);j[y]=p;b[p++]=y}}return g}var b=[],j={};b[0]=
"";f=d(f);e=d(e);return[f,e,b]};u.prototype.diff_charsToLines=function(f,e){for(var d=0;d<f.length;d++){for(var b=f[d][1],j=[],i=0;i<b.length;i++)j[i]=e[b.charCodeAt(i)];f[d][1]=j.join("")}};u.prototype.diff_map=function(f,e){var d=(new Date).getTime()+this.Diff_Timeout*1E3,b=f.length,j=e.length,i=b+j-1,g=this.Diff_DualThreshold*2<i,k=[],m=[],p={},y={};p[1]=0;y[1]=0;for(var v,h,A,F={},o=false,z=!!F.hasOwnProperty,C=(b+j)%2,G=0;G<i;G++){if(this.Diff_Timeout>0&&(new Date).getTime()>d)return null;k[G]=
{};for(var M=-G;M<=G;M+=2){v=M==-G||M!=G&&p[M-1]<p[M+1]?p[M+1]:p[M-1]+1;h=v-M;if(g){A=v+","+h;if(C&&(z?F.hasOwnProperty(A):F[A]!==undefined))o=true;C||(F[A]=G)}for(;!o&&v<b&&h<j&&f.charAt(v)==e.charAt(h);){v++;h++;if(g){A=v+","+h;if(C&&(z?F.hasOwnProperty(A):F[A]!==undefined))o=true;C||(F[A]=G)}}p[M]=v;k[G][v+","+h]=true;if(v==b&&h==j)return this.diff_path1(k,f,e);else if(o){m=m.slice(0,F[A]+1);d=this.diff_path1(k,f.substring(0,v),e.substring(0,h));return d.concat(this.diff_path2(m,f.substring(v),
e.substring(h)))}}if(g){m[G]={};for(M=-G;M<=G;M+=2){v=M==-G||M!=G&&y[M-1]<y[M+1]?y[M+1]:y[M-1]+1;h=v-M;A=b-v+","+(j-h);if(!C&&(z?F.hasOwnProperty(A):F[A]!==undefined))o=true;if(C)F[A]=G;for(;!o&&v<b&&h<j&&f.charAt(b-v-1)==e.charAt(j-h-1);){v++;h++;A=b-v+","+(j-h);if(!C&&(z?F.hasOwnProperty(A):F[A]!==undefined))o=true;if(C)F[A]=G}y[M]=v;m[G][v+","+h]=true;if(o){k=k.slice(0,F[A]+1);d=this.diff_path1(k,f.substring(0,b-v),e.substring(0,j-h));return d.concat(this.diff_path2(m,f.substring(b-v),e.substring(j-
h)))}}}}return null};u.prototype.diff_path1=function(f,e,d){for(var b=[],j=e.length,i=d.length,g=null,k=f.length-2;k>=0;k--)for(;;)if(f[k].hasOwnProperty?f[k].hasOwnProperty(j-1+","+i):f[k][j-1+","+i]!==undefined){j--;if(g===-1)b[0][1]=e.charAt(j)+b[0][1];else b.unshift([-1,e.charAt(j)]);g=-1;break}else if(f[k].hasOwnProperty?f[k].hasOwnProperty(j+","+(i-1)):f[k][j+","+(i-1)]!==undefined){i--;if(g===1)b[0][1]=d.charAt(i)+b[0][1];else b.unshift([1,d.charAt(i)]);g=1;break}else{j--;i--;if(g===0)b[0][1]=
e.charAt(j)+b[0][1];else b.unshift([0,e.charAt(j)]);g=0}return b};u.prototype.diff_path2=function(f,e,d){for(var b=[],j=0,i=e.length,g=d.length,k=null,m=f.length-2;m>=0;m--)for(;;)if(f[m].hasOwnProperty?f[m].hasOwnProperty(i-1+","+g):f[m][i-1+","+g]!==undefined){i--;if(k===-1)b[j-1][1]+=e.charAt(e.length-i-1);else b[j++]=[-1,e.charAt(e.length-i-1)];k=-1;break}else if(f[m].hasOwnProperty?f[m].hasOwnProperty(i+","+(g-1)):f[m][i+","+(g-1)]!==undefined){g--;if(k===1)b[j-1][1]+=d.charAt(d.length-g-1);
else b[j++]=[1,d.charAt(d.length-g-1)];k=1;break}else{i--;g--;if(k===0)b[j-1][1]+=e.charAt(e.length-i-1);else b[j++]=[0,e.charAt(e.length-i-1)];k=0}return b};u.prototype.diff_commonPrefix=function(f,e){if(!f||!e||f.charCodeAt(0)!==e.charCodeAt(0))return 0;for(var d=0,b=Math.min(f.length,e.length),j=b,i=0;d<j;){if(f.substring(i,j)==e.substring(i,j))i=d=j;else b=j;j=Math.floor((b-d)/2+d)}return j};u.prototype.diff_commonSuffix=function(f,e){if(!f||!e||f.charCodeAt(f.length-1)!==e.charCodeAt(e.length-
1))return 0;for(var d=0,b=Math.min(f.length,e.length),j=b,i=0;d<j;){if(f.substring(f.length-j,f.length-i)==e.substring(e.length-j,e.length-i))i=d=j;else b=j;j=Math.floor((b-d)/2+d)}return j};u.prototype.diff_halfMatch=function(f,e){function d(k,m,p){for(var y=k.substring(p,p+Math.floor(k.length/4)),v=-1,h="",A,F,o,z;(v=m.indexOf(y,v+1))!=-1;){var C=i.diff_commonPrefix(k.substring(p),m.substring(v)),G=i.diff_commonSuffix(k.substring(0,p),m.substring(0,v));if(h.length<G+C){h=m.substring(v-G,v)+m.substring(v,
v+C);A=k.substring(0,p-G);F=k.substring(p+C);o=m.substring(0,v-G);z=m.substring(v+C)}}return h.length>=k.length/2?[A,F,o,z,h]:null}var b=f.length>e.length?f:e,j=f.length>e.length?e:f;if(b.length<10||j.length<1)return null;var i=this,g=d(b,j,Math.ceil(b.length/4));b=d(b,j,Math.ceil(b.length/2));if(!g&&!b)return null;else g=b?g?g[4].length>b[4].length?g:b:b:g;if(f.length>e.length){f=g[0];e=g[1];b=g[2];j=g[3]}else{b=g[0];j=g[1];f=g[2];e=g[3]}return[f,e,b,j,g[4]]};u.prototype.diff_cleanupSemantic=function(f){for(var e=
false,d=[],b=0,j=null,i=0,g=0,k=0;i<f.length;){if(f[i][0]==0){d[b++]=i;g=k;k=0;j=f[i][1]}else{k+=f[i][1].length;if(j!==null&&j.length<=g&&j.length<=k){f.splice(d[b-1],0,[-1,j]);f[d[b-1]+1][0]=1;b--;b--;i=b>0?d[b-1]:-1;k=g=0;j=null;e=true}}i++}e&&this.diff_cleanupMerge(f);this.diff_cleanupSemanticLossless(f)};u.prototype.diff_cleanupSemanticLossless=function(f){function e(z,C){if(!z||!C)return 5;var G=0;if(z.charAt(z.length-1).match(d)||C.charAt(0).match(d)){G++;if(z.charAt(z.length-1).match(b)||C.charAt(0).match(b)){G++;
if(z.charAt(z.length-1).match(j)||C.charAt(0).match(j)){G++;if(z.match(i)||C.match(g))G++}}}return G}for(var d=/[^a-zA-Z0-9]/,b=/\s/,j=/[\r\n]/,i=/\n\r?\n$/,g=/^\r?\n\r?\n/,k=1;k<f.length-1;){if(f[k-1][0]==0&&f[k+1][0]==0){var m=f[k-1][1],p=f[k][1],y=f[k+1][1],v=this.diff_commonSuffix(m,p);if(v){var h=p.substring(p.length-v);m=m.substring(0,m.length-v);p=h+p.substring(0,p.length-v);y=h+y}v=m;h=p;for(var A=y,F=e(m,p)+e(p,y);p.charAt(0)===y.charAt(0);){m+=p.charAt(0);p=p.substring(1)+y.charAt(0);y=
y.substring(1);var o=e(m,p)+e(p,y);if(o>=F){F=o;v=m;h=p;A=y}}if(f[k-1][1]!=v){if(v)f[k-1][1]=v;else{f.splice(k-1,1);k--}f[k][1]=h;if(A)f[k+1][1]=A;else{f.splice(k+1,1);k--}}}k++}};u.prototype.diff_cleanupEfficiency=function(f){for(var e=false,d=[],b=0,j="",i=0,g=false,k=false,m=false,p=false;i<f.length;){if(f[i][0]==0){if(f[i][1].length<this.Diff_EditCost&&(m||p)){d[b++]=i;g=m;k=p;j=f[i][1]}else{b=0;j=""}m=p=false}else{if(f[i][0]==-1)p=true;else m=true;if(j&&(g&&k&&m&&p||j.length<this.Diff_EditCost/
2&&g+k+m+p==3)){f.splice(d[b-1],0,[-1,j]);f[d[b-1]+1][0]=1;b--;j="";if(g&&k){m=p=true;b=0}else{b--;i=b>0?d[b-1]:-1;m=p=false}e=true}}i++}e&&this.diff_cleanupMerge(f)};u.prototype.diff_cleanupMerge=function(f){f.push([0,""]);for(var e=0,d=0,b=0,j="",i="",g;e<f.length;)switch(f[e][0]){case 1:b++;i+=f[e][1];e++;break;case -1:d++;j+=f[e][1];e++;break;case 0:if(d!==0||b!==0){if(d!==0&&b!==0){g=this.diff_commonPrefix(i,j);if(g!==0){if(e-d-b>0&&f[e-d-b-1][0]==0)f[e-d-b-1][1]+=i.substring(0,g);else{f.splice(0,
0,[0,i.substring(0,g)]);e++}i=i.substring(g);j=j.substring(g)}g=this.diff_commonSuffix(i,j);if(g!==0){f[e][1]=i.substring(i.length-g)+f[e][1];i=i.substring(0,i.length-g);j=j.substring(0,j.length-g)}}if(d===0)f.splice(e-d-b,d+b,[1,i]);else b===0?f.splice(e-d-b,d+b,[-1,j]):f.splice(e-d-b,d+b,[-1,j],[1,i]);e=e-d-b+(d?1:0)+(b?1:0)+1}else if(e!==0&&f[e-1][0]==0){f[e-1][1]+=f[e][1];f.splice(e,1)}else e++;d=b=0;i=j="";break}f[f.length-1][1]===""&&f.pop();d=false;for(e=1;e<f.length-1;){if(f[e-1][0]==0&&f[e+
1][0]==0)if(f[e][1].substring(f[e][1].length-f[e-1][1].length)==f[e-1][1]){f[e][1]=f[e-1][1]+f[e][1].substring(0,f[e][1].length-f[e-1][1].length);f[e+1][1]=f[e-1][1]+f[e+1][1];f.splice(e-1,1);d=true}else if(f[e][1].substring(0,f[e+1][1].length)==f[e+1][1]){f[e-1][1]+=f[e+1][1];f[e][1]=f[e][1].substring(f[e+1][1].length)+f[e+1][1];f.splice(e+1,1);d=true}e++}d&&this.diff_cleanupMerge(f)};u.prototype.diff_xIndex=function(f,e){var d=0,b=0,j=0,i=0,g;for(g=0;g<f.length;g++){if(f[g][0]!==1)d+=f[g][1].length;
if(f[g][0]!==-1)b+=f[g][1].length;if(d>e)break;j=d;i=b}if(f.length!=g&&f[g][0]===-1)return i;return i+(e-j)};u.prototype.diff_prettyHtml=function(f){for(var e=[],d=0,b=0;b<f.length;b++){var j=f[b][0],i=f[b][1],g=i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"&para;<BR>");switch(j){case 1:e[b]='<INS STYLE="background:#E6FFE6;" TITLE="i='+d+'">'+g+"</INS>";break;case -1:e[b]='<DEL STYLE="background:#FFE6E6;" TITLE="i='+d+'">'+g+"</DEL>";break;case 0:e[b]='<SPAN TITLE="i='+
d+'">'+g+"</SPAN>";break}if(j!==-1)d+=i.length}return e.join("")};u.prototype.diff_text1=function(f){for(var e=[],d=0;d<f.length;d++)if(f[d][0]!==1)e[d]=f[d][1];return e.join("")};u.prototype.diff_text2=function(f){for(var e=[],d=0;d<f.length;d++)if(f[d][0]!==-1)e[d]=f[d][1];return e.join("")};u.prototype.diff_levenshtein=function(f){for(var e=0,d=0,b=0,j=0;j<f.length;j++){var i=f[j][1];switch(f[j][0]){case 1:d+=i.length;break;case -1:b+=i.length;break;case 0:e+=Math.max(d,b);b=d=0;break}}e+=Math.max(d,
b);return e};u.prototype.diff_toDelta=function(f){for(var e=[],d=0;d<f.length;d++)switch(f[d][0]){case 1:e[d]="+"+encodeURI(f[d][1]);break;case -1:e[d]="-"+f[d][1].length;break;case 0:e[d]="="+f[d][1].length;break}return e.join("\t").replace(/\x00/g,"%00").replace(/%20/g," ")};u.prototype.diff_fromDelta=function(f,e){var d=[],b=0,j=0;e=e.replace(/%00/g,"\u0000");e=e.split(/\t/g);for(var i=0;i<e.length;i++){var g=e[i].substring(1);switch(e[i].charAt(0)){case "+":try{d[b++]=[1,decodeURI(g)]}catch(k){throw new Error("Illegal escape in diff_fromDelta: "+
g);}break;case "-":case "=":var m=parseInt(g,10);if(isNaN(m)||m<0)throw new Error("Invalid number in diff_fromDelta: "+g);g=f.substring(j,j+=m);if(e[i].charAt(0)=="=")d[b++]=[0,g];else d[b++]=[-1,g];break;default:if(e[i])throw new Error("Invalid diff operation in diff_fromDelta: "+e[i]);}}if(j!=f.length)throw new Error("Delta length ("+j+") does not equal source text length ("+f.length+").");return d};u.prototype.match_main=function(f,e,d){d=Math.max(0,Math.min(d,f.length));return f==e?0:f.length?
f.substring(d,d+e.length)==e?d:this.match_bitap(f,e,d):-1};u.prototype.match_bitap=function(f,e,d){function b(z,C){z=z/e.length;C=Math.abs(d-C);if(!i.Match_Distance)return C?1:z;return z+C/i.Match_Distance}if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var j=this.match_alphabet(e),i=this,g=this.Match_Threshold,k=f.indexOf(e,d);if(k!=-1)g=Math.min(b(0,k),g);k=f.lastIndexOf(e,d+e.length);if(k!=-1)g=Math.min(b(0,k),g);var m=1<<e.length-1;k=-1;for(var p,y,v=e.length+
f.length,h,A=0;A<e.length;A++){p=0;for(y=v;p<y;){if(b(A,d+y)<=g)p=y;else v=y;y=Math.floor((v-p)/2+p)}v=y;p=Math.max(1,d-y+1);var F=Math.min(d+y,f.length)+e.length;y=Array(F+2);y[F+1]=(1<<A)-1;for(F=F;F>=p;F--){var o=j[f.charAt(F-1)];y[F]=A===0?(y[F+1]<<1|1)&o:(y[F+1]<<1|1)&o|(h[F+1]|h[F])<<1|1|h[F+1];if(y[F]&m){o=b(A,F-1);if(o<=g){g=o;k=F-1;if(k>d)p=Math.max(1,2*d-k);else break}}}if(b(A+1,d)>g)break;h=y}return k};u.prototype.match_alphabet=function(f){for(var e={},d=0;d<f.length;d++)e[f.charAt(d)]=
0;for(d=0;d<f.length;d++)e[f.charAt(d)]|=1<<f.length-d-1;return e};u.prototype.patch_addContext=function(f,e){for(var d=e.substring(f.start2,f.start2+f.length1),b=0;e.indexOf(d)!=e.lastIndexOf(d)&&d.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;){b+=this.Patch_Margin;d=e.substring(f.start2-b,f.start2+f.length1+b)}b+=this.Patch_Margin;(d=e.substring(f.start2-b,f.start2))&&f.diffs.unshift([0,d]);(e=e.substring(f.start2+f.length1,f.start2+f.length1+b))&&f.diffs.push([0,e]);f.start1-=
d.length;f.start2-=d.length;f.length1+=d.length+e.length;f.length2+=d.length+e.length};u.prototype.patch_make=function(f,e,d){var b;if(typeof f=="string"&&typeof e=="string"&&typeof d=="undefined"){b=f;e=this.diff_main(b,e,true);if(e.length>2){this.diff_cleanupSemantic(e);this.diff_cleanupEfficiency(e)}}else if(typeof f=="object"&&typeof e=="undefined"&&typeof d=="undefined"){e=f;b=this.diff_text1(e)}else if(typeof f=="string"&&typeof e=="object"&&typeof d=="undefined"){b=f;e=e}else if(typeof f==
"string"&&typeof e=="string"&&typeof d=="object"){b=f;e=d}else throw new Error("Unknown call format to patch_make.");if(e.length===0)return[];d=[];f=new q;var j=0,i=0,g=0,k=b;b=b;for(var m=0;m<e.length;m++){var p=e[m][0],y=e[m][1];if(!j&&p!==0){f.start1=i;f.start2=g}switch(p){case 1:f.diffs[j++]=e[m];f.length2+=y.length;b=b.substring(0,g)+y+b.substring(g);break;case -1:f.length1+=y.length;f.diffs[j++]=e[m];b=b.substring(0,g)+b.substring(g+y.length);break;case 0:if(y.length<=2*this.Patch_Margin&&j&&
e.length!=m+1){f.diffs[j++]=e[m];f.length1+=y.length;f.length2+=y.length}else if(y.length>=2*this.Patch_Margin)if(j){this.patch_addContext(f,k);d.push(f);f=new q;j=0;k=b;i=g}break}if(p!==1)i+=y.length;if(p!==-1)g+=y.length}if(j){this.patch_addContext(f,k);d.push(f)}return d};u.prototype.patch_deepCopy=function(f){for(var e=[],d=0;d<f.length;d++){var b=f[d],j=new q;j.diffs=[];for(var i=0;i<b.diffs.length;i++)j.diffs[i]=b.diffs[i].slice();j.start1=b.start1;j.start2=b.start2;j.length1=b.length1;j.length2=
b.length2;e[d]=j}return e};u.prototype.patch_apply=function(f,e){if(f.length==0)return[e,[]];f=this.patch_deepCopy(f);var d=this.patch_addPadding(f);e=d+e+d;this.patch_splitMax(f);for(var b=0,j=[],i=0;i<f.length;i++){var g=f[i].start2+b,k=this.diff_text1(f[i].diffs),m,p=-1;if(k.length>this.Match_MaxBits){m=this.match_main(e,k.substring(0,this.Match_MaxBits),g);if(m!=-1){p=this.match_main(e,k.substring(k.length-this.Match_MaxBits),g+k.length-this.Match_MaxBits);if(p==-1||m>=p)m=-1}}else m=this.match_main(e,
k,g);if(m==-1)j[i]=false;else{j[i]=true;b=m-g;g=p==-1?e.substring(m,m+k.length):e.substring(m,p+this.Match_MaxBits);if(k==g)e=e.substring(0,m)+this.diff_text2(f[i].diffs)+e.substring(m+k.length);else{g=this.diff_main(k,g,false);if(k.length>this.Match_MaxBits&&this.diff_levenshtein(g)/k.length>this.Patch_DeleteThreshold)j[i]=false;else{this.diff_cleanupSemanticLossless(g);k=0;var y;for(p=0;p<f[i].diffs.length;p++){var v=f[i].diffs[p];if(v[0]!==0)y=this.diff_xIndex(g,k);if(v[0]===1)e=e.substring(0,
m+y)+v[1]+e.substring(m+y);else if(v[0]===-1)e=e.substring(0,m+y)+e.substring(m+this.diff_xIndex(g,k+v[1].length));if(v[0]!==-1)k+=v[1].length}}}}}e=e.substring(d.length,e.length-d.length);return[e,j]};u.prototype.patch_addPadding=function(f){for(var e="",d=1;d<=this.Patch_Margin;d++)e+=String.fromCharCode(d);for(d=0;d<f.length;d++){f[d].start1+=e.length;f[d].start2+=e.length}d=f[0];var b=d.diffs;if(b.length==0||b[0][0]!=0){b.unshift([0,e]);d.start1-=e.length;d.start2-=e.length;d.length1+=e.length;
d.length2+=e.length}else if(e.length>b[0][1].length){var j=e.length-b[0][1].length;b[0][1]=e.substring(b[0][1].length)+b[0][1];d.start1-=j;d.start2-=j;d.length1+=j;d.length2+=j}d=f[f.length-1];b=d.diffs;if(b.length==0||b[b.length-1][0]!=0){b.push([0,e]);d.length1+=e.length;d.length2+=e.length}else if(e.length>b[b.length-1][1].length){j=e.length-b[b.length-1][1].length;b[b.length-1][1]+=e.substring(0,j);d.length1+=j;d.length2+=j}return e};u.prototype.patch_splitMax=function(f){for(var e=0;e<f.length;e++)if(f[e].length1>
this.Match_MaxBits){var d=f[e];f.splice(e--,1);for(var b=this.Match_MaxBits,j=d.start1,i=d.start2,g="";d.diffs.length!==0;){var k=new q,m=true;k.start1=j-g.length;k.start2=i-g.length;if(g!==""){k.length1=k.length2=g.length;k.diffs.push([0,g])}for(;d.diffs.length!==0&&k.length1<b-this.Patch_Margin;){g=d.diffs[0][0];var p=d.diffs[0][1];if(g===1){k.length2+=p.length;i+=p.length;k.diffs.push(d.diffs.shift());m=false}else if(g===-1&&k.diffs.length==1&&k.diffs[0][0]==0&&p.length>2*b){k.length1+=p.length;
j+=p.length;m=false;k.diffs.push([g,p]);d.diffs.shift()}else{p=p.substring(0,b-k.length1-this.Patch_Margin);k.length1+=p.length;j+=p.length;if(g===0){k.length2+=p.length;i+=p.length}else m=false;k.diffs.push([g,p]);if(p==d.diffs[0][1])d.diffs.shift();else d.diffs[0][1]=d.diffs[0][1].substring(p.length)}}g=this.diff_text2(k.diffs);g=g.substring(g.length-this.Patch_Margin);p=this.diff_text1(d.diffs).substring(0,this.Patch_Margin);if(p!==""){k.length1+=p.length;k.length2+=p.length;if(k.diffs.length!==
0&&k.diffs[k.diffs.length-1][0]===0)k.diffs[k.diffs.length-1][1]+=p;else k.diffs.push([0,p])}m||f.splice(++e,0,k)}}};u.prototype.patch_toText=function(f){for(var e=[],d=0;d<f.length;d++)e[d]=f[d];return e.join("")};u.prototype.patch_fromText=function(f){var e=[];if(!f)return e;f=f.replace(/%00/g,"\u0000");f=f.split("\n");for(var d=0;d<f.length;){var b=f[d].match(/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/);if(!b)throw new Error("Invalid patch string: "+f[d]);var j=new q;e.push(j);j.start1=parseInt(b[1],
10);if(b[2]===""){j.start1--;j.length1=1}else if(b[2]=="0")j.length1=0;else{j.start1--;j.length1=parseInt(b[2],10)}j.start2=parseInt(b[3],10);if(b[4]===""){j.start2--;j.length2=1}else if(b[4]=="0")j.length2=0;else{j.start2--;j.length2=parseInt(b[4],10)}for(d++;d<f.length;){b=f[d].charAt(0);try{var i=decodeURI(f[d].substring(1))}catch(g){throw new Error("Illegal escape in patch_fromText: "+i);}if(b=="-")j.diffs.push([-1,i]);else if(b=="+")j.diffs.push([1,i]);else if(b==" ")j.diffs.push([0,i]);else if(b==
"@")break;else if(b!=="")throw new Error('Invalid patch mode "'+b+'" in: '+i);d++}}return e};q.prototype.toString=function(){for(var f=["@@ -"+(this.length1===0?this.start1+",0":this.length1==1?this.start1+1:this.start1+1+","+this.length1)+" +"+(this.length2===0?this.start2+",0":this.length2==1?this.start2+1:this.start2+1+","+this.length2)+" @@\n"],e,d=0;d<this.diffs.length;d++){switch(this.diffs[d][0]){case 1:e="+";break;case -1:e="-";break;case 0:e=" ";break}f[d+1]=e+encodeURI(this.diffs[d][1])+
"\n"}return f.join("").replace(/\x00/g,"%00").replace(/%20/g," ")};s.diff_match_patch=u;s.DIFF_DELETE=-1;s.DIFF_INSERT=1;s.DIFF_EQUAL=0});bespin.tiki.register("::edit_session",{name:"edit_session",dependencies:{events:"0.0.0"}});
bespin.tiki.module("edit_session:index",function(x,s){x("bespin:promise");x("bespin:plugins");x("bespin:util/util");x("events");s.EditSession=function(){};s.EditSession.prototype={_currentView:null,currentUser:null,history:null,getCompletePath:function(u){if(u==null)u="";if(u==null||u.substring(0,1)!="/"){var q;if(this._currentView&&this._currentView.buffer)q=this._currentView.buffer;var f;if(q)f=q.file;u=f?f.parentdir()+u:"/"+u}return u}};Object.defineProperties(s.EditSession.prototype,{currentView:{set:function(u){if(u!==
this._currentView)this._currentView=u},get:function(){return this._currentView}}});s.createSession=function(u,q){var f=new s.EditSession;if(u)f.currentView=u.textView;if(q)f.currentUser=q;return f}});bespin.tiki.register("::syntax_manager",{name:"syntax_manager",dependencies:{worker_manager:"0.0.0",events:"0.0.0",underscore:"0.0.0",syntax_directory:"0.0.0"}});
bespin.tiki.module("syntax_manager:index",function(x,s){function u(g,k,m,p){for(;g.length<k;)g.push(d(p).clone());k=[k,m.length].concat(m);Array.prototype.splice.apply(g,k);return g}function q(){this._lines=[];this._syms={}}function f(g,k){this._syntaxInfo=g;this._syntaxManager=k;this._invalidRow=0;this._states=[];this._active=false;this.symbols=new q}function e(g){this.layoutManager=g;this.attrsChanged=new b;this.syntaxChanged=new b;this._contextRanges=this._invalidRows=this._context=null;this._attrs=
[];this._symbols=new q;this._syntax="plain";this._reset()}var d=x("underscore")._,b=x("events").Event,j=x("worker_manager").WorkerSupervisor;x("bespin:console");x("rangeutils:utils/range");var i=x("syntax_directory").syntaxDirectory;q.prototype={get:function(g){return this._syms["-"+g]},replaceLine:function(g,k){function m(v){return v.substring(1)}var p=this._lines,y=this._syms;g<p.length&&d(p[g]).isArray()&&d(p[g]).each(function(v){delete y["-"+v]});p[g]=d(k).keys().map(m);d(y).extend(k)}};f.prototype=
{_annotate:function(){if(this._invalidRow==null)throw new Error("syntax_manager.Context: attempt to annotate without any invalid row");if(!this._active)throw new Error("syntax_manager.Context: attempt to annotate while inactive");if(this._worker==null)this._createWorker();else{var g=this._syntaxManager.getTextLines(),k=this._invalidRow,m=k===0?this.getName()+":start":this._states[k],p=Math.min(g.length,k+100);g=g.slice(k,p);var y={start:{row:k,col:0},end:{row:p-1,col:d(g).last().length}};this._worker.send("annotate",
[m,g,y]).then(d(this._annotationFinished).bind(this,k,p))}},_annotationFinished:function(g,k,m){if(this._active){var p=this._syntaxManager;p.mergeAttrs(g,m.attrs);p.mergeSymbols(g,m.symbols);u(this._states,g,m.states);if(k>=this._getRowCount()){this._invalidRow=null;this._active=false}else{this._invalidRow=k;this._annotate()}}},_createWorker:function(){if(this._syntaxInfo==null)return false;var g=new j("syntax_worker#syntaxWorker");this._worker=g;g.started.add(this._workerStarted.bind(this));g.start();
return true},_getRowCount:function(){return this._syntaxManager.getTextLines().length},_workerStarted:function(){this._worker.send("loadSyntax",[this._syntaxInfo.name]);this._active&&this._annotate()},activateAndAnnotate:function(){this._active=true;this._annotate()},contextsAtPosition:function(){var g=this._syntaxInfo;if(g==null)return["plain"];return[g.name]},cut:function(g){var k=this._getRowCount();if(g<0||g>=k)throw new Error("Attempt to cut the context at an invalid row");if(!(this._invalidRow!=
null&&this._invalidRow<g)){this._invalidRow=g;this._active=false}},getName:function(){return this._syntaxInfo.name},kill:function(){var g=this._worker;if(g!=null){g.kill();this._worker=null}}};e.prototype={_getTextStorage:function(){return this.layoutManager.textStorage},_reset:function(){var g=this._context;if(g!=null){g.kill();this._context=null}g=this._syntax;g=g==="plain"?null:i.get(g);this._context=g=new f(g,this);g.activateAndAnnotate()},attrsChanged:null,syntaxChanged:null,contextsAtPosition:function(g){return this._context.contextsAtPosition(g)},
getAttrsForRows:function(g,k){return this._attrs.slice(g,k)},getSymbol:function(g){return this._symbols.get(g)},getSyntax:function(){return this._syntax},getTextLines:function(){return this._getTextStorage().lines},invalidateRow:function(g){var k=this._context;k.cut(g);k.activateAndAnnotate()},mergeAttrs:function(g,k){u(this._attrs,g,k,[]);this.attrsChanged(g,g+k.length)},mergeSymbols:function(g,k){var m=this._symbols;d(k).each(function(p,y){m.replaceLine(g+y,p)})},setSyntax:function(g){this._syntax=
i.hasSyntax(g)?g:"plain";this.syntaxChanged(g);this._reset()},setSyntaxFromFileExt:function(g){return this.setSyntax(i.syntaxForFileExt(g))}};s.SyntaxManager=e});bespin.tiki.register("::completion",{name:"completion",dependencies:{jquery:"0.0.0",ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("completion:controller",function(x,s){function u(i){this._editorView=i;i.selectionChanged.add(this._selectionChanged.bind(this));i.willChangeBuffer.add(this._willChangeBuffer.bind(this));this._syntaxChanged=this._syntaxChanged.bind(this);this.tags=new f.Tags;this.ui=new d(i.element)}function q(i){return function(){return j.editor.completionController[i](j)}}var f=x("ctags"),e=x("rangeutils:utils/range"),d=x("completion:ui").CompletionUI,b=x("bespin:plugins").catalog,j=x("environment").env;
u.prototype={_buffer:null,_completionEngine:null,_completions:null,_stem:null,_hideCompletions:function(){this.ui.hide()},_selectionChanged:function(i){var g=this._completionEngine;if(!(g==null||!e.isZeroLength(i))){var k=this._buffer.layoutManager,m=k.syntaxManager,p=i.start;i=p.col;p=k.textStorage.lines[p.row];k=p.substring(0,i);i=p.substring(i);g=g.getCompletions(k,i,m);if(g==null)this._hideCompletions();else{m=g.tags;this._stem=g.stem;this._showCompletions(m)}}},_showCompletions:function(i){var g=
this._editorView,k=g.textView.getInsertionPointPosition();k=g.convertTextViewPoint(k);this.ui.show(i,k,g.layoutManager.fontDimension.lineHeight)},_syntaxChanged:function(i){i=b.getExtensionByKey("completion",i);if(i==null)this._completionEngine=null;else i.load().then(function(g){this._completionEngine=new g(this.tags)}.bind(this))},_willChangeBuffer:function(i){var g=this._buffer;g!=null&&g.layoutManager.syntaxManager.syntaxChanged.remove(this._syntaxChanged);i.layoutManager.syntaxManager.syntaxChanged.add(this._syntaxChanged);
this._buffer=i},cancel:function(){this.ui.hide()},complete:function(i){var g=this.ui,k=g.getCompletion().name;i.view.insertText(k.substring(this._stem.length));g.hide()},isCompleting:function(){return this.ui.visible},moveDown:function(){this.ui.move("down")},moveUp:function(){this.ui.move("up")},tags:null};s.CompletionController=u;s.completeCommand=q("complete");s.completeCancelCommand=q("cancel");s.completeDownCommand=q("moveDown");s.completeUpCommand=q("moveUp")});
bespin.tiki.module("completion:ui",function(x,s){function u(j){var i=f.uniqueId("bespin-completion-panel"),g=document.createElement("div");g.id=i;g.className="bespin-completion-panel";g.style.display="none";g.innerHTML='<div class="bespin-completion-pointer"></div><div class="bespin-completion-bubble-outer"><div class="bespin-completion-bubble-inner"><div class="bespin-completion-highlight"></div><ul></ul></div></div>';q(j).append(g);this.panel=q(g);this.parent=q(j)}var q=x("jquery").$,f=x("underscore")._,
e=f.template('<span class="bespin-completion-container"> &mdash; <%= container %></span>'),d=f.template('<div class="bespin-completion-second-row"><%= type %></div>'),b=f.template('<li><div class="bespin-completion-top-row"><span class="bespin-completion-kind bespin-completion-kind-<%= kind %>"><%= kind %></span><span class="bespin-completion-ident"><%= ident %></span><%= container %></div><%= second_row %></li>');u.prototype={_fromBottom:false,_index:0,_tags:null,_getHighlightDimensions:function(j){var i=
j.position(),g=j.outerHeight()-2;j=j.outerWidth()-2;return{left:i.left,top:i.top,height:g,width:j}},_listItemForIndex:function(j){return this.panel.find("li:eq("+j+")")},_populate:function(){var j=f(this._tags).map(function(i){var g=i["class"],k=i.module,m=i.namespace;g=g!=null?g:m!=null?m:"";if(k!=null)g=k+(g!=""?"#"+g:"");k=g==""?"":e({container:g});g=i.type;g=g==null?"":d({type:g});return b({kind:i.kind,ident:i.name,container:k,second_row:g})});this.panel.find("ul").html(j.join("\n"))},panel:null,
visible:false,getCompletion:function(){return this.visible?this._tags[this._index]:null},hide:function(){if(this.visible){this.panel.fadeOut(100);this.visible=false}},move:function(j){var i=this._index,g=this._listItemForIndex(i),k=j==="up"?g.prev():g.next();if(k.length!==0){this._index=i=j==="up"?i-1:i+1;i=q(g).find(".bespin-completion-top-row");var m=q(g).find(".bespin-completion-second-row");g=q(k).find(".bespin-completion-top-row");var p=q(k).find(".bespin-completion-second-row");m.hide();p.show();
var y=this.panel.find(".bespin-completion-highlight");y.stop(true,true);k=this._getHighlightDimensions(k);y.animate(k,100);p.hide();if(j==="down"){j=m.height();g.css("top",j);g.animate({top:0},100)}else{j=p.height();i.css("top",-j);i.animate({top:0},100)}p.fadeIn()}},show:function(j,i,g){this._tags=j=f(j).clone();this._populate();var k=this.visible,m=this.panel;m.stop(true,true);k||m.show();var p=this.parent.offset(),y=p.left,v=y+i.x,h=p.top+i.y;p=m.outerWidth();var A=m.outerHeight(),F=q(window).width(),
o=q(window).height();this._fromBottom=h=h+A+g>o;if(this._index>=j.length)this._index=j.length-1;if(h){h=m.find(".bespin-completion-pointer");h.removeClass("bespin-completion-pointer-up");h.addClass("bespin-completion-pointer-down");m.css({bottom:-i.y,top:""});this._tags.reverse();this._populate();if(!k)this._index=j.length-1}else{h=m.find(".bespin-completion-pointer");h.removeClass("bespin-completion-pointer-down");h.addClass("bespin-completion-pointer-up");m.css({top:i.y+g,bottom:""});if(!k)this._index=
0}if(!k){if(v+i.x+p>F){h.css({left:"",right:32});m.css("left",Math.min(F-p-y,i.x-p+43))}else{h.css({left:32,right:""});m.css("left",Math.max(y,i.x-43))}m.hide().animate({opacity:"show"},100)}j=m.find(".bespin-completion-highlight");j.stop(true,true);i=this._listItemForIndex(this._index);i.find(".bespin-completion-second-row").show();i=this._getHighlightDimensions(i);j.css(i);this.visible=true}};s.CompletionUI=u});bespin.tiki.module("completion:index",function(){});
bespin.tiki.register("::rangeutils",{name:"rangeutils",dependencies:{}});
bespin.tiki.module("rangeutils:utils/range",function(x,s){var u=x("bespin:util/util");s.addPositions=function(q,f){return{row:q.row+f.row,col:q.col+f.col}};s.cloneRange=function(q){var f=q.start;q=q.end;return{start:{row:f.row,col:f.col},end:{row:q.row,col:q.col}}};s.comparePositions=function(q,f){var e=q.row-f.row;return e===0?q.col-f.col:e};s.equal=function(q,f){return s.comparePositions(q.start,f.start)===0&&s.comparePositions(q.end,f.end)===0};s.extendRange=function(q,f){var e=q.end;return{start:q.start,
end:{row:e.row+f.row,col:e.col+f.col}}};s.intersectRangeSets=function(q,f){q=u.clone(q);f=u.clone(f);for(var e=[];q.length>0&&f.length>0;){var d=q.shift(),b=f.shift(),j=s.comparePositions(d.start,b.start),i=s.comparePositions(d.end,b.end);if(s.comparePositions(d.end,b.start)<0){e.push(d);f.unshift(b)}else if(s.comparePositions(b.end,d.start)<0){e.push(b);q.unshift(d)}else if(j<0){e.push({start:d.start,end:b.start});q.unshift({start:b.start,end:d.end});f.unshift(b)}else if(j===0)if(i<0)f.unshift({start:d.end,
end:b.end});else i>0&&q.unshift({start:b.end,end:d.end});else if(j>0){e.push({start:b.start,end:d.start});q.unshift(d);f.unshift({start:d.start,end:b.end})}}return e.concat(q,f)};s.isZeroLength=function(q){return q.start.row===q.end.row&&q.start.col===q.end.col};s.maxPosition=function(q,f){return s.comparePositions(q,f)>0?q:f};s.normalizeRange=function(q){return this.comparePositions(q.start,q.end)<0?q:{start:q.end,end:q.start}};s.rangeSetBoundaries=function(q){return{start:q[0].start,end:q[q.length-
1].end}};s.toString=function(q){var f=q.start;q=q.end;return"[ "+f.row+", "+f.col+" "+q.row+","+ +q.col+" ]"};s.unionRanges=function(q,f){return{start:q.start.row<f.start.row||q.start.row===f.start.row&&q.start.col<f.start.col?q.start:f.start,end:q.end.row>f.end.row||q.end.row===f.end.row&&q.end.col>f.end.col?q.end:f.end}};s.isPosition=function(q){return!u.none(q)&&!u.none(q.row)&&!u.none(q.col)};s.isRange=function(q){return!u.none(q)&&s.isPosition(q.start)&&s.isPosition(q.end)}});
bespin.tiki.module("rangeutils:index",function(){});bespin.tiki.register("::undomanager",{name:"undomanager",dependencies:{}});
bespin.tiki.module("undomanager:index",function(x,s){var u=x("bespin:util/util");x("environment");s.UndoManager=function(){};u.mixin(s.UndoManager.prototype,{_redoStack:[],_undoStack:[],_undoOrRedo:function(q,f,e){if(f.length===0)return false;f=f.pop();if(!f.target[q](f.context)){this._redoStack=[];this._undoStack=[];return false}e.push(f);return true},redo:function(){return this._undoOrRedo("redo",this._redoStack,this._undoStack)},registerUndo:function(q,f){this._redoStack=[];this._undoStack.push({target:q,
context:f})},undo:function(){return this._undoOrRedo("undo",this._undoStack,this._redoStack)}});s.global=new s.UndoManager;s.undoManagerCommand=function(q,f){s.global[f.commandExt.name]()}});bespin.tiki.register("::command_line",{name:"command_line",dependencies:{templater:"0.0.0",settings:"0.0.0",matcher:"0.0.0",theme_manager_base:"0.0.0",canon:"0.0.0",keyboard:"0.0.0",diff:"0.0.0",types:"0.0.0"}});
bespin.tiki.module("command_line:commands/basic",function(x,s){var u=x("bespin:index"),q=x("bespin:util/util");x("environment");s.evalCommand=function(e,d){var b;e=e.javascript;try{b=eval(e)}catch(j){b="<b>Error: "+j.message+"</b>"}var i="",g="",k;if(q.isFunction(b)){i=(b+"").replace(/\n/g,"<br>").replace(/ /g,"&#160");g="function"}else if(q.isObject(b)){g=Array.isArray(b)?"array":"object";var m=[],p;for(k in b)if(b.hasOwnProperty(k)){p=q.isFunction(b[k])?"[function]":q.isObject(b[k])?"[object]":
b[k];m.push({name:k,value:p})}m.sort(function(y,v){return y.name.toLowerCase()<v.name.toLowerCase()?-1:1});for(k=0;k<m.length;k++)i+="<b>"+m[k].name+"</b>: "+m[k].value+"<br>"}else{i=b;g=typeof b}d.done('Result for eval <b>"'+e+'"</b> (type: '+g+"): <br><br>"+i)};s.versionCommand=function(e,d){d.done("Bespin "+u.versionNumber+" ("+u.versionCodename+")")};var f=["really wants you to trick it out in some way.","is your Web editor.","would love to be like Emacs on the Web.","is written on the Web platform, so you can tweak it."];
s.bespinCommand=function(e,d){e=Math.floor(Math.random()*f.length);d.done("Bespin "+f[e])}});
bespin.tiki.module("command_line:commands/history",function(x,s){x("bespin:plugins");var u=x("canon:history"),q=x("environment").env,f=0;s.historyPreviousCommand=function(){f>0&&f--;q.commandLine.setInput(u.requests[f].typed)};s.historyNextCommand=function(){f<u.requests.length&&f++;q.commandLine.setInput(f===u.requests.length?"":u.requests[f].typed)};s.historyCommand=function(e,d){var b=[];b.push("<table>");var j=1;u.requests.forEach(function(i){b.push("<tr>");b.push("<th>"+j+"</th>");b.push("<td>"+
i.typed+"</td>");b.push("</tr>");j++});b.push("</table>");d.done(b.join(""))};s.addedRequestOutput=function(){f=u.requests.length}});
bespin.tiki.module("command_line:commands/simple",function(x,s){var u=x("bespin:plugins").catalog,q=x("bespin:console").console,f=x("environment").env;s.completeCommand=function(){f.commandLine.complete()};var e=function(b,j){var i=[],g=u.getExtensionByKey("command",b);if(g&&g.pointer)i.push(g.description);else{var k=false;!b&&j&&j.prefix&&i.push(j.prefix);if(g){i.push("<h2>Sub-Commands of "+g.name+"</h2>");i.push("<p>"+g.description+"</p>")}else if(b){if(b=="hidden"){b="";k=true}i.push("<h2>Commands starting with '"+
b+"':</h2>")}else i.push("<h2>Available Commands:</h2>");var m=[];u.getExtensions("command").forEach(function(v){m.push(v.name)});var p=m.sort();i.push("<table>");for(var y=0;y<p.length;y++)if(g=u.getExtensionByKey("command",p[y])){if(!(!k&&g.hidden))if(g.description!==undefined)if(!(b&&g.name.indexOf(b)!==0))if(!(!b&&g.name.indexOf(" ")!=-1))if(!(g&&g.name==b)){i.push("<tr>");i.push('<th class="right">'+g.name+"</th>");i.push("<td>"+g.description+"</td>");i.push("</tr>")}}else q.error("Huh? command ",
g.name," cannot be looked up by name");i.push("</table>");!b&&j&&j.suffix&&i.push(j.suffix)}return i.join("")};s.helpCommand=function(b,j){b=e(b.search,{prefix:"<h2>Welcome to Bespin - Code in the Cloud</h2><ul><li><a href='http://labs.mozilla.com/projects/bespin' target='_blank'>Home Page</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin' target='_blank'>Wiki</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/UserGuide' target='_blank'>User Guide</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/Tips' target='_blank'>Tips and Tricks</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/FAQ' target='_blank'>FAQ</a></li><li><a href='https://wiki.mozilla.org/Labs/Bespin/DeveloperGuide' target='_blank'>Developers Guide</a></li></ul>",
suffix:"For more information, see the <a href='https://wiki.mozilla.org/Labs/Bespin'>Bespin Wiki</a>."});j.done(b)};var d={aliases:[],commands:[]};s.aliasCommand=function(b,j){var i=d.aliases;if(b.alias)if(b.command===undefined)i[b.alias]?j.done(b.alias+" &#x2192; "+i[b.alias]):j.done("No alias set for '"+b.alias+"'");else{var g=b.alias;b=b.command;var k=b.split(" ")[0];if(d.commands[g])j.done("There is already a command with the name: "+g);else if(d.commands[k]){i[g]=b;j.done("Saving alias: "+g+
" &#x2192; "+b)}else if(i[k]){i[g]=b;j.done("Saving alias: "+g+" &#x2192; "+i[b]+" ("+b+" was an alias itself)")}else j.done("No command or alias with that name.")}else{b="<table>";for(g in i)if(i.hasOwnProperty(g))b+='<tr><td style="text-align:right;">'+g+"</td><td>&#x2192;</td><td>"+i[g]+"</td></tr>";b+="</table>";j.done(b)}}});bespin.tiki.module("command_line:hint",function(x,s){s.Level={Error:3,Incomplete:2,Warning:1,Info:0};s.Hint=function(u,q,f){this.level=u;this.element=q;this.completion=f}});
bespin.tiki.module("command_line:input",function(x,s){var u=x("bespin:plugins").catalog,q=x("bespin:console").console,f=x("bespin:promise").Promise,e=x("bespin:promise").group,d=x("bespin:util/stacktrace").Trace,b=x("bespin:util/util"),j=x("types:types"),i=x("canon:request").Request,g=x("canon:history"),k=x("keyboard:keyboard"),m=x("command_line:hint").Hint,p=x("command_line:hint").Level,y=x("command_line:typehint");s.Input=function(v,h){if(b.none(v))throw new Error("Input requires something 'typed' to work on");
this.typed=v;this.hints=[];this.argsPromise=new f;h=h||{};h.flags=h.flags||k.buildFlags({});this.flags=h.flags;this._parts=[];this._assignments=this._commandExt=this._unparsedArgs=undefined;try{this._tokenize()}catch(A){v=new d(A,true);q.group("Error calling command: "+this.typed);q.error(A);v.log(3);q.groupEnd();this.argsPromise.isComplete()||this.argsPromise.reject(A)}};s.Input.prototype={_tokenize:function(){if(!this.typed||this.typed===""){this.hints.push(new m(p.Incomplete));this.argsPromise.resolve({})}else{for(var v=
this.typed.replace(/^\s\s*/,"").split(/\s+/),h;;){h=v.shift();if(b.none(h))break;if(h[0]=='"'||h[0]=="'"){h=[h.substring(1,h.length)];for(var A;;){A=v.shift();if(!A)break;if(A[A.length-1]=='"'||A[A.length-1]=="'"){h.push(A.substring(0,A.length-1));break}else h.push(A)}this._parts.push(h.join(" "))}else this._parts.push(h)}this._split()}},_split:function(){this._unparsedArgs=this._parts.slice();for(var v=this._unparsedArgs.shift(),h;;){h=u.getExtensionByKey("command",v);if(!h)break;if(!k.flagsMatch(h.predicates,
this.flags)){h=null;break}if(h.pointer)break;v+=" "+this._unparsedArgs.shift()}this._commandExt=h;v=null;var A;if(this._commandExt){var F=new f;h.load().then(function(C){if(C)F.resolve(null);else{A="Failed to load command "+h.name+": Pointer "+h.pluginName+":"+h.pointer+" is null.";F.resolve(new m(p.Error,A))}},function(C){A="Failed to load command "+h.name+": Pointer "+h.pluginName+":"+h.pointer+" failed to load."+C;F.resolve(new m(p.Error,A))});this.hints.push(F);if(this._parts.length===1){var o=
this._commandExt;if(this.typed==o.name||!o.params||o.params.length===0)v=s.documentCommand(o,this.typed)}}else{var z=[];u.getExtensions("command").forEach(function(C){k.flagsMatch(C.predicates,this.flags)&&C.description&&z.push(C)}.bind(this));v={param:{type:{name:"selection",data:z},description:"Commands"},value:this.typed}}v&&this.hints.push(y.getHint(this,v));b.none(this._commandExt)?this.argsPromise.resolve({}):this._assign()},_assign:function(){this._assignments=[];var v=this._commandExt.params,
h=this._unparsedArgs,A;if(!v||v.length===0){var F=0;h.forEach(function(G){G.trim()!==""&&F++});if(F!==0){A=this._commandExt.name+" does not take any parameters";this.hints.push(new m(p.Error,A))}this.argsPromise.resolve({})}else{if(v.length==1&&v[0].type=="text")this._assignments[0]={value:h.length===0?null:h.join(" "),param:v[0]};else{var o=0,z=[];v.forEach(function(G){this._assignParam(G,o++,z)}.bind(this));var C=false;h.forEach(function(G){if(z.indexOf(G)==-1){A="Parameter '"+G+"' makes no sense.";
this.hints.push(new m(p.Error,A));C=true}}.bind(this));if(C){this.argsPromise.resolve({});return}}if(this._parts.length>1){v=this._getAssignmentForLastArg();v.param.type.assignments=this._assignments;v&&this.hints.push(y.getHint(this,v))}this._convertTypes()}},_assignParam:function(v,h,A){for(var F=0;F<this._unparsedArgs.length;F++){var o=this._unparsedArgs[F];if("--"+v.name==o){A.push(o);if(j.equals(v.type,"boolean"))this._assignments[h]={value:true,param:v};else if(F+1<this._unparsedArgs.length){v=
"Missing parameter: "+v.name;this.hints.push(new m(p.Incomplete,v))}else A.push(this._unparsedArgs[F+1]);return}}F=null;if(this._unparsedArgs.length>h){F=this._unparsedArgs[h];A.push(this._unparsedArgs[h])}if(F!==undefined)this._assignments[h]={value:F,param:v};else{this._assignments[h]={param:v};if(v.defaultValue===undefined){v="Missing parameter: "+v.name;this.hints.push(new m(p.Incomplete,v))}}},_getAssignmentForLastArg:function(){var v=null;this._assignments.forEach(function(h){if(!v||!b.none(h.value))v=
h});return v},_convertTypes:function(){if(this._commandExt.params){var v={},h=[];this._assignments.forEach(function(A){A.param.type.assignments=this._assignments;var F=this._convertType(A,v);F.then(function(o){A.converted=o;v[A.param.name]=o},function(o){this.hints.push(new m(p.Error,"Can't convert '"+A.value+"' to a "+param.type+": "+o))}.bind(this));h.push(F)}.bind(this));e(h).then(function(){this.argsPromise.resolve(v)}.bind(this))}else this.argsPromise.resolve({})},_convertType:function(v){return v.value!==
null?j.fromString(v.value,v.param.type):(new f).resolve(v.param.defaultValue)},execute:function(){var v=function(h){var A=new d(h,true);q.group("Error executing: "+this.typed);q.error(h);A.log(3);q.groupEnd()}.bind(this);this.argsPromise.then(function(h){this._commandExt.load().then(function(A){A=new i({command:A,commandExt:this._commandExt,typed:this.typed,args:h});g.execute(h,A)}.bind(this),v)}.bind(this),v)}};s.documentCommand=function(v,h){var A=[];A.push("<h1>"+v.name+"</h1>");A.push("<h2>Summary</h2>");
A.push("<p>"+v.description+"</p>");if(v.manual){A.push("<h2>Description</h2>");A.push("<p>"+v.description+"</p>")}if(v.params&&v.params.length>0){A.push("<h2>Synopsis</h2>");A.push("<pre>");A.push(v.name);var F=0;v.params.forEach(function(o){if(o.defaultValue===undefined){A.push(" <i>");A.push(o.name);A.push("</i>")}else if(o.defaultValue===null){A.push(" <i>[");A.push(o.name);A.push("]</i>")}else F++});if(F>3)A.push(" [options]");else F>0&&v.params.forEach(function(o){if(o.defaultValue){A.push(" [--<i>");
A.push(o.name);j.equals(o.type,"boolean")?A.push("</i>"):A.push("</i> "+j.getSimpleName(o.type));A.push("]")}});A.push("</pre>");A.push("<h2>Parameters</h2>");v.params.forEach(function(o){A.push('<h3 class="cmd_body"><i>'+o.name+"</i></h3>");A.push("<p>"+o.description+"</p>");j.defaultValue&&A.push("<p>Default: "+j.defaultValue+"</p>")})}return{param:{type:"text",description:A.join("")},value:h}}});
bespin.tiki.module("command_line:typehint",function(x,s){function u(m){var p=document.createElement("article");p.innerHTML=m;return new g(k.Info,p)}function q(m,p,y,v,h){var A;try{if(v&&typeof h.getHint==="function")A=h.getHint(p,y,v)}catch(F){b.error("Failed to get hint for ",v," reason: ",F)}A||(A=u(y.param.description));m.resolve(A);return m}function f(m){var p=new j,y=d.getExtensionByKey("typehint",m.name);p.resolve({ext:y,typeSpec:m});return p}function e(m){if(typeof m==="string")return f({name:m});
if(typeof m==="object")if(m.name==="deferred"){var p=new j;i.undeferTypeSpec(m).then(function(y){e(y).then(function(v){p.resolve(v)},function(v){p.reject(v)})});return p}else return f(m);throw new Error("Unknown typeSpec type: "+typeof m);}var d=x("bespin:plugins").catalog,b=x("bespin:console").console,j=x("bespin:promise").Promise,i=x("types:types"),g=x("command_line:hint").Hint,k=x("command_line:hint").Level;s.getHint=function(m,p){var y=new j;e(p.param.type).then(function(v){if(!v.ext)return q(y,
m,p);v.ext.load().then(function(h){typeof h.resolveTypeSpec==="function"?h.resolveTypeSpec(v.ext,v.typeSpec).then(function(){q(y,m,p,v.ext,h)},function(A){y.reject(A)}):q(y,m,p,v.ext,h)},function(){hint=u(p.param.description);y.resolve(hint)})});return y}});
bespin.tiki.module("command_line:views/basic",function(x,s){var u=x("bespin:console").console;x("bespin:promise");var q=x("types:basic"),f=x("matcher:prefix").PrefixMatcher,e=x("command_line:views/menu").Menu,d=x("command_line:views/menu").MatcherMenu;s.selection={getHint:function(b,j,i){if(!i.data){u.error("Missing data for selection type");i.data=[]}var g=new f(j.value||"");i=i.data.map(function(k){if(typeof k==="string")return{name:k};return k});g.addItems(i);return(new d(b,j,g)).hint},resolveTypeSpec:q.selection.resolveTypeSpec};
s.bool={getHint:function(b,j){b=new e(b,j);b.addItems([{name:"true"},{name:"false"}]);return b.hint}}});
bespin.tiki.module("command_line:views/cli",function(x,s){var u=x("diff").diff_match_patch,q=x("bespin:util/util"),f=x("bespin:plugins").catalog;x("bespin:console");var e=x("keyboard:keyutil"),d=x("keyboard:keyboard").keyboardManager;x("canon:history");var b=x("environment").env,j=x("settings").settings,i=x("command_line:hint").Level,g=x("command_line:input").Input,k=x("command_line:templates"),m=x("command_line:views/requestOutput"),p=f.getResourceURL("command_line")+"images",y=new u;s.CliInputView=
function(){this._pinned=this._hasFocus=false;this._completion="";this._input=new g("");this._inputer=this._completer=this._table=this._hints=this._tog=this.element=this._lastOrientation=null;k.cli({cliInputView:this,imagePath:p});e.addKeyDownListener(this._inputer,function(h){b.commandLine=this;var A=d.processKeyEvent(h,this,{isCommandLine:true,isKeyUp:false});if(h.keyCode===e.KeyHelper.KEY.TAB)return true;return A}.bind(this));this._inputer.addEventListener("keyup",function(h){var A=d.processKeyEvent(h,
this,{isCommandLine:true,isKeyUp:true});if(h.keyCode===e.KeyHelper.KEY.RETURN){this._input.execute();this.setInput("")}else{h=this._inputer.value;if(this._input.typed!==h){this._input=new g(h);this.hintUpdated()}}return A}.bind(this),true);f.registerExtension("settingChange",{match:"[min|max]ConsoleHeight",pointer:this.checkSize.bind(this)});var v=m.createHandler(this);f.registerExtension("addedRequestOutput",v)};s.CliInputView.prototype={elementAppended:function(){this.checkSize()},getOrientation:function(){var v=
this.element.className,h=/\bnorth\b/.test(v),A=/\bsouth\b/.test(v),F=/\beast\b/.test(v);v=/\bwest\b/.test(v);if(h&&!A&&!F&&!v)return"north";if(!h&&A&&!F&&!v)return"south";if(!h&&!A&&F&&!v)return"east";if(!h&&!A&&!F&&v)return"west";throw new Error("Ambiguous orientation: north="+h+", south="+A+", east="+F+", west="+v);},checkSize:function(){var v=this.getOrientation();if(v==="north"||v==="south"){v=j.get("minConsoleHeight");if(this._pinned||this._hasFocus)v=j.get("maxConsoleHeight");this._table.style.height=
v+"px";this._tog.style.height=v+"px";this.element.style.height=v+26+"px";f.publish(this,"dimensionsChanged")}},complete:function(){if(this._completion)this._inputer.value=this._completion},setInput:function(v){v=v||"";this._inputer.value=v;this._input=new g(v);this.hintUpdated();this.focus()},focus:function(){this._inputer.focus()},execute:function(v){b.commandLine=this;(new g(v)).execute()},prompt:function(v){this._inputer.value=v},hintUpdated:function(){for(var v=this._input.hints;this._hints.firstChild;)this._hints.removeChild(this._hints.firstChild);
var h=i.Info;this.setCompletion("");var A=function(F,o){if(o)if(o.isPromise)o.then(function(G){A(F,G)}.bind(this));else{if(o.element)if(o.element.addEventListener)F.appendChild(o.element);else{var z=document.createElement("article"),C=o.element.toString();z.appendChild(document.createTextNode(C));F.appendChild(z)}this.setCompletion(o.completion);if(o.level>h)h=o.level;q.setClass(this._inputer,"cmd_error",h==i.Error)}}.bind(this);v.forEach(function(F){A(this._hints,F)}.bind(this));q.setClass(this._inputer,
"cmd_error",h==i.Error)},scrollToBottom:function(){this._table.scrollTop=Math.max(this._table.scrollHeight,this._table.clientHeight)-this._table.clientHeight},_focusCheck:function(v){this._hasFocus=v.type=="focus";this._delayedCheckSize()},_delayedCheckSize:function(){if(this._checkSizeTimeout){window.clearTimeout(this._checkSizeTimeout);this._checkSizeTimeout=null}this._checkSizeTimeout=window.setTimeout(function(){this.checkSize()}.bind(this),100)},_togglePin:function(v){if(/\bchecked\b/.test(v.target.className)){q.removeClass(v.target,
"checked");this._pinned=false}else{q.addClass(v.target,"checked");this._pinned=true}this._delayedCheckSize()},setCompletion:function(v){this._completion=v||"";var h=this._inputer.value;if(v)if(v.indexOf(h)===0)h='<span class="cmd_existing">'+h+"</span>"+v.substring(h.length);else{var A=y.diff_commonPrefix(h,v);v=v.substring(A);h='<span class="cmd_existing">'+h+'</span><span class="cmd_extension">'+v+"</span>"}else h="";this._completer.innerHTML=h}}});
bespin.tiki.module("command_line:views/menu",function(x,s){var u=x("command_line:hint").Hint,q=x("command_line:hint").Level,f=x("environment").env,e;s.activateItemAction=function(b,j){b=parseInt(j.commandExt.key.replace(/[A-Za-z_]/g,""),10);e&&e._itemActions[b]()};var d=function(b,j){for(var i=0;;){if(b.charAt(i).toLocaleLowerCase()!==j.charAt(i).toLocaleLowerCase())return i;if(i>=b.length||i>=j.length)return i;i++}};s.Menu=function(b,j){if(b!=="subclassPrototype"){this.input=b;this.assignment=j;
this._parent=document.createElement("div");this._parent.setAttribute("class","cmd_menu");this._notFound=document.createElement("div");this._notFound.setAttribute("class","cmd_error");this._notFound.innerHTML="No matches for '"+this.input.typed+"'";this._parent.appendChild(this._notFound);this._list=document.createElement("ul");this._parent.appendChild(this._list);this._items=[];this._commonPrefix=null;this._itemActions=[];this._prefix=this.input.typed.substring(0,this.input.typed.length-(this.assignment.value?
this.assignment.value.length:0));this.hint=new u(q.Incomplete,this._parent);e=this}};s.Menu.prototype.addItems=function(b){var j=1,i;b.forEach(function(g){if(this._items.length<10){var k=document.createElement("li");k.appendChild(document.createTextNode(g.name));if(g.description||g.path){var m=document.createElement("dfn");m.appendChild(document.createTextNode(g.description||g.path));k.appendChild(m)}this._itemActions[j]=function(){var p=this._prefix+this._getFullName(g);f.commandLine.setInput(p)}.bind(this);
if(j<11){m=document.createElement("abbr");m.innerHTML="ALT-"+"-1234567890"[j];if(j===1)i=m;k.appendChild(m);j++}this._list.appendChild(k);k.addEventListener("mousedown",function(p){var y=this._prefix+this._getFullName(g);f.commandLine.setInput(y);p.preventDefault()}.bind(this),false)}this._items.length===0&&this._parent.removeChild(this._notFound);this._items.push(g)}.bind(this));b=this._getBestCompletion();this.hint.completion=b.completion;if(b.isFirst&&i)i.innerHTML="TAB"};s.Menu.prototype._getBestCompletion=
function(){if(this._items.length===0)return{completion:undefined,isFirst:false};var b=this._items.length===1,j=this._getFullName(this._items[0]);this._items.length>1&&this._items.forEach(function(k){if(j.length>0){k=this._getFullName(k);k=d(j,k);if(k<j.length)j=j.substring(0,k)}}.bind(this));if(!j||j.length===0){j=this._getFullName(this._items[0]);b=true}var i=this.input.typed.substring(0,this.input.typed.length-(this.assignment.value?this.assignment.value.length:0)),g=i+j;if(g.indexOf(this.input.typed)!=
0||g===this.input.typed){g=i+this._getFullName(this._items[0]);b=true}return{completion:g,isFirst:b}};s.Menu.prototype._getFullName=function(b){return(b.path||"")+b.name};s.MatcherMenu=function(b,j,i,g){s.Menu.call(this,b,j);this.matcher=i;this.loaded=g;this.matcher.addListener({itemsAdded:function(k){this.addItems(k)}.bind(this),itemsCleared:function(){this.clearItems()}.bind(this)});if(this.loaded){this.loaded.then(function(){this._isLoaded=true}.bind(this));this._isLoaded=false}else this._isLoaded=
true};s.MatcherMenu.prototype=new s.Menu("subclassPrototype")});
bespin.tiki.module("command_line:views/requestOutput",function(x,s){var u=x("bespin:util/util"),q=x("bespin:plugins").catalog;x("bespin:console");var f=x("environment").env,e=x("command_line:templates"),d=q.getResourceURL("command_line")+"images";s.RequestOutput=function(b,j){this.request=b;this.cliInputView=j;this.throb=this.typed=this.duration=this.show=this.hide=this.output=this.rowout=this.rowin=null;e.requestOutput({actions:this,imagePath:d});this.cliInputView._table.appendChild(this.rowin);
this.cliInputView._table.appendChild(this.rowout);this.request.changed.add(this.onRequestChange.bind(this))};s.RequestOutput.prototype={copyToInput:function(){this.cliInputView.setInput(this.request.typed)},executeRequest:function(){f.commandLine=this.cliInputView;this.cliInputView._input=new Input(this.request.typed);this.cliInputView._input.execute()},hideOutput:function(b){this.output.style.display="none";u.addClass(this.hide,"cmd_hidden");u.removeClass(this.show,"cmd_hidden");b.stopPropagation()},
showOutput:function(b){this.output.style.display="block";u.removeClass(this.hide,"cmd_hidden");u.addClass(this.show,"cmd_hidden");b.stopPropagation()},remove:function(b){this.cliInputView._table.removeChild(this.rowin);this.cliInputView._table.removeChild(this.rowout);b.stopPropagation()},onRequestChange:function(){this.duration.innerHTML=this.request.duration?"completed in "+this.request.duration/1E3+" sec ":"";this.typed.innerHTML=this.request.typed;this.output.innerHTML="";this.request.outputs.forEach(function(b){var j;
if(typeof b=="string"){j=document.createElement("p");j.innerHTML=b}else j=b;this.output.appendChild(j)},this);this.cliInputView.scrollToBottom();u.setClass(this.output,"cmd_error",this.request.error);this.throb.style.display=this.request.completed?"none":"block"}};s.createHandler=function(b){return{pointer:function(j,i,g){new s.RequestOutput(g,b)}}}});bespin.tiki.module("command_line:index",function(){});
bespin.tiki.module("command_line:templates",function(x,s){x("templater").compileAll({"requestOutput.htmlt":'\n<!-- The div for the input (i.e. what was typed) --\>\n<div class="cmd_rowin" save="${actions.rowin}"\n    onclick="${actions.copyToInput}"\n    ondblclick="${actions.executeRequest}">\n\n  <!-- What the user actually typed --\>\n  <div class="cmd_gt">&gt; </div>\n  <div class="cmd_typed" save="${actions.typed}"></div>\n\n  <!-- The extra details that appear on hover --\>\n  <div class="cmd_duration cmd_hover" save="${actions.duration}"></div>\n  <img class="cmd_hover" onclick="${actions.hideOutput}" save="${actions.hide}"\n      alt="Hide command output" src="${imagePath}/minus.png"/>\n  <img class="cmd_hover cmd_hidden" onclick="${actions.showOutput}" save="${actions.show}"\n      alt="Show command output" src="${imagePath}/plus.png"/>\n  <img class="cmd_hover" onclick="${actions.remove}"\n      alt="Remove this command from the history" src="${imagePath}/closer.png"/>\n\n</div>\n\n<!-- The div for the command output --\>\n<div class="cmd_rowout" save="${actions.rowout}">\n  <div class="cmd_output" save="${actions.output}"></div>\n  <img src="${imagePath}/throbber.gif" save="${actions.throb}"/>\n</div>\n',"cli.htmlt":'\n<div class="cmd_line" save="${cliInputView.element}"\n    onfocus="${cliInputView._focusCheck [useCapture:true]}"\n    onblur="${cliInputView._focusCheck [useCapture:true]}"\n    onclick="${cliInputView.focus [useCapture:true]}">\n\n  <!-- The output area that changes height --\>\n  <div class="cmd_tog stack_children" save="${cliInputView._tog}">\n\n    <div class="cmd_top">\n      <!-- Side toolbar --\>\n      <div class="cmd_toolbar">\n        <img src="${imagePath}/dot_clear.gif" class="cmd_pin check"\n            alt="Pin/Unpin the console output"\n            onclick="${cliInputView._togglePin}"/>\n      </div>\n  \n      <!-- CLI output table --\>\n      <div class="cmd_table" save="${cliInputView._table}"></div>\n    </div>\n\n    <!-- A div to hang hints on --\>\n    <div class="cmd_hints" save="${cliInputView._hints}"></div>\n\n  </div>\n\n  <!-- The input area, with fixed height --\>\n  <div class="cmd_cli">\n\n    <!-- The prompt --\>\n    <div class="cmd_prompt cmd_gt">\n      <span class="cmd_brackets">{ }</span> &gt;\n    </div>\n\n    <!-- Where you type commands --\>\n    <div class="cmd_kbd stack_children">\n      <div class="cmd_completion" save="${cliInputView._completer}"></div>\n      <div>\n        <input class="cmd_input" type="text" save="${cliInputView._inputer}"/>\n      </div>\n    </div>\n\n  </div>\n\n</div>\n'},
s)});bespin.tiki.register("::environment",{name:"environment",dependencies:{settings:"0.0.0"}});
bespin.tiki.module("environment:index",function(x,s){var u=x("bespin:util/util"),q=x("bespin:console").console,f=x("bespin:plugins").catalog,e=x("settings").settings;s.Environment=function(){this.commandLine=null;window.addEventListener("resize",this.dimensionsChanged.bind(this),false)};Object.defineProperties(s.Environment.prototype,{settings:{value:{set:function(d,b){if(u.none(d))throw new Error("setSetting(): key must be supplied");if(u.none(b))throw new Error("setSetting(): value must be supplied");
e.set(d,b)},get:function(d){if(u.none(d))throw new Error("getSetting(): key must be supplied");return e.get(d)}}},dimensionsChanged:{value:function(){f.publish(this,"dimensionsChanged")}},session:{get:function(){return f.getObject("session")}},view:{get:function(){if(!this.session)return null;return this.session.currentView}},editor:{get:function(){if(!this.session)return null;return this.session.currentView.editor}},contexts:{get:function(){if(!this.view)return[];var d=this.view.editor.layoutManager.syntaxManager,
b=this.view.getSelectedRange().start;return d.contextsAtPosition(b)}},buffer:{get:function(){if(this.session)return this.view.editor.buffer;else q.error("command attempted to get buffer but there's no session")}},model:{get:function(){if(this.buffer)return this.view.editor.layoutManager.textStorage;else q.error("Session has no current buffer")}},file:{get:function(){if(this.buffer)return this.buffer.file;else q.error("Session has no current buffer")}},files:{get:function(){return f.getObject("files")}}});
s.env=new s.Environment});bespin.tiki.register("::ctags",{name:"ctags",dependencies:{traits:"0.0.0",underscore:"0.0.0"}});
bespin.tiki.module("ctags:index",function(x,s){var u=x("underscore")._,q=x("./reader").TagReader;x=x("traits").Trait;s.Tags=function(){this.tags=[]};s.Tags.prototype=Object.create(Object.prototype,x.compose(x({_search:function(f,e){var d={name:f};f=this.tags;var b=u(f).sortedIndex(d,function(j){return j.name});for(b=d=b;d>=0&&d<f.length&&e(f[d]);)d--;for(;b>=0&&b<f.length&&e(f[b]);)b++;return f.slice(d+1,b)},add:function(f){var e=this.tags;Array.prototype.push.apply(e,f);e.sort(function(d,b){d=d.name;
b=b.name;if(d<b)return-1;if(d===b)return 0;return 1})},get:function(f){return this._search(f,function(e){return e.name===f})},scan:function(f,e,d){if(d===null||d===undefined)d={};var b=f.split("\n");f=parse(f,e,1);e=new Interpreter(f,e,b,d);e.interpret();this.add(e.tags)},stem:function(f){var e=f.length;return this._search(f,function(d){return d.name.substring(0,e)===f})}}),q))});
bespin.tiki.module("ctags:reader",function(x,s){var u=x("underscore")._;x=x("traits").Trait;s.TagReader=x({readLines:function(q){var f=[];u(q).each(function(e){e=e.split("\t");if(!(e.length<3)){var d=e[0];if(!/^!_TAG_/.test(d)){d={name:d,tagfile:e[1],addr:e[2]};var b;if(e.length>3&&e[3].indexOf(":")===-1){d.kind=e[3];b=4}else b=3;var j={};u(e.slice(b)).each(function(i){i=/^([^:]+):(.*)/.exec(i);j[i[1]]=i[2]});d.fields=j;f.push(d)}}});this.add(f)},readString:function(q){this.readLines(q.split("\n"))}})});
bespin.tiki.register("::templater",{name:"templater",dependencies:{}});
bespin.tiki.module("templater:index",function(x,s){function u(j,i){j=Array.prototype.slice.call(j.childNodes);for(var g=0;g<j.length;g++)e(j[g],i)}function q(j,i,g){if(typeof j==="string")j=j.split(".");var k=i[j[0]];if(j.length===1){if(g!==undefined)i[j[0]]=g;if(typeof k==="function")return k.bind(i);return k}if(!k){console.error("Can't find path=",j," in data=",i);return null}return q(j.slice(1),k,g)}function f(j,i){with(i)return eval(j)}s.processTemplate=function(j,i){i=i||{};var g=document.createElement("div");
g.innerHTML=j;e(g,i);return g};var e=function(j,i){if(j.attributes&&j.attributes.length)for(var g=Array.prototype.slice.call(j.attributes),k=0;k<g.length;k++){var m=g[k].value,p=g[k].name;if(p==="save"){m=d(m);q(m,i,j);j.removeAttribute(p)}else if(p.substring(0,2)==="on"){m=d(m);var y=false;m=m.replace(/\s*\[useCapture:true\]$/,function(){y=true;return""});var v=q(m,i);typeof v!=="function"&&console.error("Expected "+m+" to resolve to a function, but got ",typeof v);j.removeAttribute(p);j.addEventListener(p.substring(2),
v,y)}else{p=m.replace(/\$\{[^}]*\}/,function(h){return f(h.slice(2,-1),i)});if(m!==p)g[k].value=p}}u(j,i);if(j.nodeType===3){m=j.textContent;p=m.replace(/\$\{[^}]*\}/,function(h){return f(h.slice(2,-1),i)});if(m!==p)j.textContent=p}},d=function(j){if(!j.match(/\$\{.*\}/)){console.error("Expected "+j+" to match ${...}");return j}return j.slice(2,-1)},b=function(j){var i=j.lastIndexOf(".");return j.substring(0,i)};s.compile=function(j){return function(i){return s.processTemplate(j,i)}};s.compileAll=
function(j,i){if("undefined"===typeof i)i={};Object.keys(j).forEach(function(g){i[b(g)]=s.compile(j[g])});return i}});bespin.tiki.register("::matcher",{name:"matcher",dependencies:{}});
bespin.tiki.module("matcher:index",function(x,s){s.Matcher=function(u){if(u!=="subclassPrototype"){this._query=u;this._scoredItems=[];this._listeners=[];this._maxScore=null}};s.Matcher.prototype.addItem=function(u){this.addItems([u])};s.Matcher.prototype.addItems=function(u){var q=[],f=false;u.forEach(function(b){b={score:this.score(this._query,b),item:b};b.score>0&&q.push(b);if(b.score>this._maxScore){this._maxScore=b.score;f=true}this._scoredItems.push(b)},this);var e=false;f&&this._scoredItems.forEach(function(b){if(b.score+
500<this._maxScore)e=true});u=function(b,j){return j.score-b.score};this._scoredItems.sort(u);q.sort(u);if(e){this._callListeners("itemsCleared");u=this._scoredItems}else u=q;var d=[];u.forEach(function(b){b.score+500>this._maxScore&&d.push(b.item)}.bind(this));this._callListeners("itemsAdded",d)};s.Matcher.prototype.addListener=function(u){this._listeners.push(u);var q=[];this._scoredItems.forEach(function(f){f.score>0&&q.push(f.item)},this);typeof u.itemsAdded==="function"&&u.itemsAdded(q)};s.Matcher.prototype.__defineSetter__("query",
function(u){this._query=u;var q=[];this._scoredItems.forEach(function(f){f.score=this.score(this._query,f.item);f.score>0&&q.push(f.item)},this);this._callListeners("itemsCleared");this._callListeners("itemsAdded",q)});s.Matcher.prototype._callListeners=function(){var u=Array.prototype.slice.call(arguments),q=u.shift();this._listeners.forEach(function(f){typeof f[q]==="function"&&f[q].apply(null,u)})}});
bespin.tiki.module("matcher:prefix",function(x,s){var u=x("matcher").Matcher;s.PrefixMatcher=function(q){u.call(this,q)};s.PrefixMatcher.prototype=new u("subclassPrototype");s.PrefixMatcher.prototype.score=function(q,f){var e=q.length;if(e>f.name.length)return 0;if(f.name.substring(0,e).toLowerCase()===q.toLowerCase())return 1E3-f.name.length;return 0}});
bespin.tiki.module("matcher:quick",function(x,s){var u=x("matcher").Matcher;s.QuickMatcher=function(q){u.call(this,q)};s.QuickMatcher.prototype=new u("subclassPrototype");s.QuickMatcher.prototype.score=function(q,f){q=q.toLowerCase();var e=f.name.toLowerCase();f=f.path?f.path.toLowerCase():null;if(e.substring(0,q.length)===q)return 5E3-e.length;if(f&&f.substring(0,q.length)===q)return 4E3-f.length;if(e.substring(e.length-q.length,e.length)===q)return 3E3-e.length;if(f)e=f+e;f=q.substring(0,1);for(var d=
0,b=2E3,j=0;j<e.length;j++)if(e.substring(j,j+1)===f){d++;if(d===q.length)return b;f=q.substring(d,d+1)}else d!==0&&b--;return 0}});bespin.tiki.register("::theme_manager",{name:"theme_manager",dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"}});
bespin.tiki.module("theme_manager:index",function(x,s){x("bespin:promise");var u=x("bespin:plugins").catalog;x("events");var q=x("themestyles"),f=x("settings").settings,e=null,d=null;s.themestyles=q;s.themeSettingChanged=function(b,j,i){var g=u.getExtensionByKey("theme",i);if(i==="standard"||!i||!g){g=null;if(d!==null)g=u.getExtensionByKey("theme",d)}if(g)g.load().then(function(k){e&&q.unregisterThemeStyles(e);q.currentThemeVariables=k();e=g;q.parseGlobalVariables();q.reparse();g.url&&q.registerThemeStyles(g);
u.publish(s,"themeChange")});else if(e){q.unregisterThemeStyles(e);e=null;q.currentThemeVariables=null;q.parseGlobalVariables();q.reparse();u.publish(this,"themeChange")}};u.registerExtension("settingChange",{match:"theme",pointer:s.themeSettingChanged.bind(s)});s.setStandardTheme=function(b){d=b;b!==f.get("theme")&&s.themeSettingChanged(this)};s.setBasePlugin=function(b){q.basePluginName=b};s.startParsing=function(){q.preventParsing=false;return q.reparse()};s.registerTheme=function(b){var j=f.get("theme");
b.name===j&&s.themeSettingChanged(this,"theme",b.name)};s.unregisterTheme=function(b){b.name===f.get("theme")&&s.themeSettingChanged(this)};s.appLaunched=function(){u.publish(s,"themeChange")}});
bespin.tiki.module("theme_manager:themestyles",function(x,s){var u=x("bespin:util/util"),q=x("bespin:plugins").catalog,f=x("bespin:console").console,e=x("bespin:promise").Promise,d=x("bespin:promise").group,b=x("bespin:proxy"),j=new (x("less").Parser)({optimization:3}),i=1;s.currentThemeVariables=null;s.basePluginName=null;s.preventParsing=true;var g="";s.globalThemeVariables={};var k={},m={},p=function(z){var C={},G=[],M=function(Z,T){G.push(Z);if(typeof T!="object")C[G.join("_")]=T;else for(prop in T)M(prop,
T[prop]);G.pop()};M("global",z);return C},y={},v={font:"arial, lucida, helvetica, sans-serif",font_size:"14px",line_height:"1.8em",color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",error_color:"#F99",header_color:"white",link_color:"#ACF",control:{color:"#E1B41F",border:"1px solid rgba(0, 0, 0, 0.2)",border_radius:"0.25em",background:"rgba(0, 0, 0, 0.2)",active:{color:"#FF9600",border:"1px solid #E1B41F",inset_color:"#ff9600",background:"rgba(0, 0, 0, 0.2)"}},pane:{h1:{font:"'MuseoSans', Helvetica",
font_size:"2.8em",color:"white"},color:"#DAD4BA",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",link_color:"white",background:"#45443C",border_radius:".5em"},form:{color:"white",text_shadow:"1px 1px rgba(0, 0, 0, 0.4)",font:"'Lucida Sans','Lucida Grande',Verdana,Arial,sans-serif",font_size:"@global_font_size",line_height:"@global_line_height"},button:{color:"white",background:"#3E6CB9"},container:{background:"#1E1916",border:"1px solid black"},selectable:{color:"white",border:"0px solid transparent",background:"transparent",
active:{color:"black",border:"0px solid transparent",background:"#FF8E00"},hover:{color:"black",border:"0px solid transparent",background:"#FF8E00"}},hint:{color:"#AAA",active:{color:"black"},hover:{color:"black"}},accelerator:{color:"#996633",active:{color:"black"},hover:{color:"black"}},menu:{border_color:"black",inset_color_right:"#1E1916",inset_color_top_left:"#3E3936",background:"transparent"}};v=p(v);s.getPluginThemeVariables=function(z){var C=q.plugins[z];if(!C)return null;var G={};if(s.currentThemeVariables&&
s.currentThemeVariables[z])G=s.currentThemeVariables[z];C.provides.forEach(function(M){if(M.ep==="themevariable"){var Z=M.name;G[Z]=G[Z]||M.defaultValue}});return G};s.parseGlobalVariables=function(){var z={},C="",G=s.currentThemeVariables;u.mixin(z,v);G&&G.global&&u.mixin(z,p(G.global));s.globalThemeVariables=z;for(prop in z)C+="@"+prop+":"+z[prop]+";";g=C};s.parseGlobalVariables();var h=function(z,C,G){if(k[C])styleElem=document.getElementById("_bespin_theme_style_"+k[C]);else{styleElem=document.createElement("style");
styleElem.setAttribute("id","_bespin_theme_style_"+i);k[C]=i;i++;document.body.appendChild(styleElem)}j.parse(g+G+m[C],function(M,Z){if(M){M="Error less parsing "+C+" "+M.message;f.error(M);z.reject(M)}else{try{var T=Z.toCSS()}catch(ca){M="Error less parsing "+C+" "+ca;f.error(M);z.reject(M);return}if(styleElem&&styleElem.firstChild)styleElem.firstChild.textContent=T;else{M=document.createTextNode(T);styleElem.appendChild(M)}z.resolve()}})},A={};s.parsePlugin=function(z){if(s.preventParsing)return(new e).resolve();
var C=q.plugins[z];if(!C)throw"reparsePlugin: plugin "+z+" is not defined!";if(!A[z]){A[z]=new e;setTimeout(function(){var G=s.getPluginThemeVariables(z),M="";for(prop in G)M+="@"+prop+":"+G[prop]+";";G=new e;G.then(function(Z){A[this.name].resolve(Z);A[this.name]=null}.bind(this),function(){A[this.name].reject(data);A[this.name]=null}.bind(this));h(G,z,M)}.bind(C),0)}return A[z]};var F=function(z,C,G,M){G=G.replace(/url\(['"]*([^'")]*)(['"]*)\)/g,"url("+z+"$1)");m[C]+=G;M&&M.resolve()},o=null;s.registerThemeStyles=
function(z){var C=z.getPluginName(),G=q.getResourceURL(C);if(!(z.url instanceof Array))z.url=[z.url];m[C]="";var M=[],Z=s.preventParsing;z.url.forEach(function(T){if(y[C]&&y[C][T])F(G,C,y[C][T]);else{var ca=new e;M.push(ca);var ha=G+T+"?"+(new Date).getTime();b.xhr("GET",ha,true,function(ga){ga.overrideMimeType("text/plain")}).then(function(ga){F(G,C,ga,ca)},function(){f.error("registerLessFile: Could not load "+G+T);ca.resolve()})}});if(M.length===0)s.parsePlugin(C);else{Z||d(M).then(function(){s.parsePlugin(C)});
if(o!==null)M=M.concat(o);o=d(M)}};s.reparse=function(){var z=new e;if(s.preventParsing)return z.resolve();o?o.then(function(){var C=[],G=s.basePluginName;G!==null&&m[G]&&C.push(s.parsePlugin(G));for(var M in m)M!==G&&C.push(s.parsePlugin(M));d(C).then(z.resolve.bind(z),z.reject.bind(z))},function(C){z.reject(C)}):z.resolve();return z};s.unregisterThemeStyles=function(z){z=z.getPluginName();if(k[z]){var C=document.getElementById("_bespin_theme_style_"+k[z]);C.parentNode.removeChild(C);delete k[z];
delete m[z]}}});bespin.tiki.register("::whitetheme",{name:"whitetheme",dependencies:{theme_manager:"0.0.0"}});
bespin.tiki.module("whitetheme:index",function(x,s){s.whiteTheme=function(){return{global:{font:"arial, lucida, helvetica, sans-serif",font_size:"14px",line_height:"1.8em",color:"#2E2E3D",text_shadow:"1px 1px white",error_color:"#C03A38",header_color:"#222222",link_color:"#597BAC",pane:{h1:{font:"'MuseoSans', Helvetica",font_size:"2.8em",color:"#2C3480"},link_color:"@global_link_color",background:"#DFDFDF",border_radius:".5em",color:"#2E2E3D",text_shadow:"1px 1px #DDD"},form:{font:"@global_font",
font_size:"@global_font_size",line_height:"@global_line_height",color:"black",text_shadow:"0px 0px transparent"},control:{color:"#222",border:"1px solid rgba(0, 0, 0, 0.2)",border_radius:"0.25em",background:"rgba(0, 0, 0, 0.1)",active:{color:"#000",border:"1px solid #597BAC",inset_color:"#597BAC",background:"rgba(0, 0, 0, 0.1)"}},button:{color:"white",background:"#3E6CB9"},container:{background:"#F8F8F8",border:"1px solid black"},menu:{border_color:"black",inset_color:"#999",background:"transparent"},
selectable:{color:"black",border:"0px solid transparent",background:"transparent",active:{color:"white",border:"0px solid transparent",background:"#6780E4"},hover:{color:"white",border:"0px solid transparent",background:"#6780E4"}},hint:{color:"#78788D",active:{color:"white"},hover:{color:"white"}},accelerator:{color:"#344DB1",active:{color:"white"},hover:{color:"white"}}},text_editor:{gutter:{color:"#888888",backgroundColor:"#d2d2d2"},editor:{color:"#3D3D3D",backgroundColor:"#ffffff",cursorColor:"#000000",
selectedTextBackgroundColor:"#BDD9FC",unfocusedCursorColor:"#57A1FF",unfocusedCursorBackgroundColor:"#D9E9FC"},highlighter:{plain:"#030303",comment:"#919191",directive:"#999999",error:"#ff0000",identifier:"#A7379F",keyword:"#1414EF",operator:"#477ABE",string:"#017F19"},scroller:{padding:5,thickness:17,backgroundStyle:"#2A211C",fullAlpha:1,particalAlpha:0.3,nibStyle:"rgb(150, 150, 150)",nibArrowStyle:"rgb(255, 255, 255)",nibStrokeStyle:"white",trackFillStyle:"rgba(50, 50, 50, 0.2)",trackStrokeStyle:"rgb(150, 150, 150)",
barFillStyle:"rgb(60, 60, 60)",barFillGradientTopStart:"rgb(150, 150, 150)",barFillGradientTopStop:"rgb(100, 100, 100)",barFillGradientBottomStart:"rgb(82, 82, 82)",barFillGradientBottomStop:"rgb(104, 104, 104)"}}}}});bespin.tiki.register("::types",{name:"types",dependencies:{}});
bespin.tiki.module("types:basic",function(x,s){var u=x("bespin:plugins").catalog,q=x("bespin:console").console,f=x("bespin:promise").Promise;s.text={isValid:function(e){return typeof e=="string"},toString:function(e){return e},fromString:function(e){return e}};s.number={isValid:function(e){if(isNaN(e))return false;if(e===null)return false;if(e===undefined)return false;if(e===Infinity)return false;return typeof e=="number"},toString:function(e){if(!e)return null;return""+e},fromString:function(e){if(!e)return null;
var d=parseInt(e,10);if(isNaN(d))throw new Error("Can't convert \""+e+'" to a number.');return d}};s.bool={isValid:function(e){return typeof e=="boolean"},toString:function(e){return""+e},fromString:function(e){if(e===null)return null;if(!e.toLowerCase)return!!e;var d=e.toLowerCase();if(d=="true")return true;else if(d=="false")return false;return!!e}};s.object={isValid:function(e){return typeof e=="object"},toString:function(e){return JSON.stringify(e)},fromString:function(e){return JSON.parse(e)}};
s.selection={isValid:function(e,d){if(typeof e!="string")return false;if(!d.data){q.error("Missing data on selection type extension. Skipping");return true}var b=false;d.data.forEach(function(j){if(e==j)b=true});return b},toString:function(e){return e},fromString:function(e){return e},resolveTypeSpec:function(e,d){var b=new f;if(d.data){e.data=d.data;b.resolve()}else if(d.pointer)u.loadObjectForPropertyPath(d.pointer).then(function(j){j=j(d);if(typeof j.then==="function")j.then(function(i){e.data=
i;b.resolve()});else{e.data=j;b.resolve()}},function(j){b.reject(j)});else{q.warn("Missing data/pointer for selection",d);b.resolve()}return b}}});
bespin.tiki.module("types:types",function(x,s){function u(d){var b=new e,j=f.getExtensionByKey("type",d.name);j?b.resolve({ext:j,typeSpec:d}):b.reject(new Error("Unknown type: "+d.name));return b}function q(d){if(typeof d==="string")return u({name:d});if(typeof d==="object")if(d.name==="deferred"){var b=new e;s.undeferTypeSpec(d).then(function(j){q(j).then(function(i){b.resolve(i)},function(i){b.reject(i)})});return b}else return u(d);throw new Error("Unknown typeSpec type: "+typeof d);}var f=x("bespin:plugins").catalog;
x("bespin:console");var e=x("bespin:promise").Promise;s.getSimpleName=function(d){if(!d)throw new Error("null|undefined is not a valid typeSpec");if(typeof d=="string")return d;if(typeof d=="object"){if(!d.name)throw new Error("Missing name member to typeSpec");return d.name}throw new Error("Not a typeSpec: "+d);};s.equals=function(d,b){return s.getSimpleName(d)==s.getSimpleName(b)};s.undeferTypeSpec=function(d){var b=new e;if(!d.pointer){b.reject(new Error("Missing deferred pointer"));return b}f.loadObjectForPropertyPath(d.pointer).then(function(j){j=
j(d);typeof j.then==="function"?j.then(function(i){b.resolve(i)},function(i){b.reject(i)}):b.resolve(j)},function(j){b.reject(j)});return b};s.resolveType=function(d){var b=new e;q(d).then(function(j){j.ext.load(function(i){typeof i.resolveTypeSpec==="function"?i.resolveTypeSpec(j.ext,j.typeSpec).then(function(){b.resolve({type:i,ext:j.ext})},function(g){b.reject(g)}):b.resolve({type:i,ext:j.ext})})},function(j){b.reject(j)});return b};s.fromString=function(d,b){var j=new e;s.resolveType(b).then(function(i){j.resolve(i.type.fromString(d,
i.ext))});return j};s.toString=function(d,b){var j=new e;s.resolveType(b).then(function(i){j.resolve(i.type.toString(d,i.ext))});return j};s.isValid=function(d,b){var j=new e;s.resolveType(b).then(function(i){j.resolve(i.type.isValid(d,i.ext))});return j}});bespin.tiki.module("types:index",function(){});bespin.tiki.register("::jquery",{name:"jquery",dependencies:{}});
bespin.tiki.module("jquery:index",function(x,s){function u(){if(!h.isReady){try{o.documentElement.doScroll("left")}catch(a){setTimeout(u,1);return}h.ready()}}function q(a,l){l.src?h.ajax({url:l.src,async:false,dataType:"script"}):h.globalEval(l.text||l.textContent||l.innerHTML||"");l.parentNode&&l.parentNode.removeChild(l)}function f(a,l,n,t,r,D){var E=a.length;if(typeof l==="object"){for(var L in l)f(a,L,l[L],t,r,n);return a}if(n!==undefined){t=!D&&t&&h.isFunction(n);for(L=0;L<E;L++)r(a[L],l,t?n.call(a[L],
L,r(a[L],l)):n,D);return a}return E?r(a[0],l):undefined}function e(){return(new Date).getTime()}function d(){return false}function b(){return true}function j(a,l,n){n[0].type=a;return h.event.handle.apply(l,n)}function i(a){var l,n=[],t=[],r=arguments,D,E,L,H,K,R;E=h.data(this,"events");if(!(a.liveFired===this||!E||!E.live||a.button&&a.type==="click")){a.liveFired=this;var W=E.live.slice(0);for(H=0;H<W.length;H++){E=W[H];E.origType.replace(sa,"")===a.type?t.push(E.selector):W.splice(H--,1)}D=h(a.target).closest(t,
a.currentTarget);K=0;for(R=D.length;K<R;K++)for(H=0;H<W.length;H++){E=W[H];if(D[K].selector===E.selector){L=D[K].elem;t=null;if(E.preType==="mouseenter"||E.preType==="mouseleave")t=h(a.relatedTarget).closest(E.selector)[0];if(!t||t!==L)n.push({elem:L,handleObj:E})}}K=0;for(R=n.length;K<R;K++){D=n[K];a.currentTarget=D.elem;a.data=D.handleObj.data;a.handleObj=D.handleObj;if(D.handleObj.origHandler.apply(D.elem,r)===false){l=false;break}}return l}}function g(a,l){return"live."+(a&&a!=="*"?a+".":"")+
l.replace(/\./g,"`").replace(/ /g,"&")}function k(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function m(a,l){var n=0;l.each(function(){if(this.nodeName===(a[n]&&a[n].nodeName)){var t=h.data(a[n++]),r=h.data(this,t);if(t=t&&t.events){delete r.handle;r.events={};for(var D in t)for(var E in t[D])h.event.add(this,D,t[D][E],t[D][E].data)}}})}function p(a,l,n){var t,r,D;l=l&&l[0]?l[0].ownerDocument||l[0]:o;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&l===o&&!Ha.test(a[0])&&(h.support.checkClone||
!Ia.test(a[0]))){r=true;if(D=h.fragments[a[0]])if(D!==1)t=D}if(!t){t=l.createDocumentFragment();h.clean(a,l,t,n)}if(r)h.fragments[a[0]]=D?t:1;return{fragment:t,cacheable:r}}function y(a,l){var n={};h.each(Ja.concat.apply([],Ja.slice(0,l)),function(){n[this]=a});return n}function v(a){return"scrollTo"in a&&a.document?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var h=function(a,l){return new h.fn.init(a,l)},A=window.jQuery,F=window.$,o=window.document,z,C=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,
G=/^.[^:#\[\.,]*$/,M=/\S/,Z=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,T=/^<(\w+)\s*\/?>(?:<\/\1>)?$/;x=navigator.userAgent;var ca=false,ha=[],ga,la=Object.prototype.toString,ma=Object.prototype.hasOwnProperty,na=Array.prototype.push,P=Array.prototype.slice,Q=Array.prototype.indexOf;h.fn=h.prototype={init:function(a,l){var n,t;if(!a)return this;if(a.nodeType){this.context=this[0]=a;this.length=1;return this}if(a==="body"&&!l){this.context=o;this[0]=o.body;this.selector="body";this.length=1;return this}if(typeof a===
"string")if((n=C.exec(a))&&(n[1]||!l))if(n[1]){t=l?l.ownerDocument||l:o;if(a=T.exec(a))if(h.isPlainObject(l)){a=[o.createElement(a[1])];h.fn.attr.call(a,l,true)}else a=[t.createElement(a[1])];else{a=p([n[1]],[t]);a=(a.cacheable?a.fragment.cloneNode(true):a.fragment).childNodes}return h.merge(this,a)}else{if(l=o.getElementById(n[2])){if(l.id!==n[2])return z.find(a);this.length=1;this[0]=l}this.context=o;this.selector=a;return this}else if(!l&&/^\w+$/.test(a)){this.selector=a;this.context=o;a=o.getElementsByTagName(a);
return h.merge(this,a)}else return!l||l.jquery?(l||z).find(a):h(l).find(a);else if(h.isFunction(a))return z.ready(a);if(a.selector!==undefined){this.selector=a.selector;this.context=a.context}return h.makeArray(a,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return P.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},pushStack:function(a,l,n){var t=h();h.isArray(a)?na.apply(t,a):h.merge(t,a);t.prevObject=this;
t.context=this.context;if(l==="find")t.selector=this.selector+(this.selector?" ":"")+n;else if(l)t.selector=this.selector+"."+l+"("+n+")";return t},each:function(a,l){return h.each(this,a,l)},ready:function(a){h.bindReady();if(h.isReady)a.call(o,h);else ha&&ha.push(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(P.apply(this,arguments),"slice",P.call(arguments).join(","))},
map:function(a){return this.pushStack(h.map(this,function(l,n){return a.call(l,n,l)}))},end:function(){return this.prevObject||h(null)},push:na,sort:[].sort,splice:[].splice};h.fn.init.prototype=h.fn;h.extend=h.fn.extend=function(){var a=arguments[0]||{},l=1,n=arguments.length,t=false,r,D,E,L;if(typeof a==="boolean"){t=a;a=arguments[1]||{};l=2}if(typeof a!=="object"&&!h.isFunction(a))a={};if(n===l){a=this;--l}for(;l<n;l++)if((r=arguments[l])!=null)for(D in r){E=a[D];L=r[D];if(a!==L)if(t&&L&&(h.isPlainObject(L)||
h.isArray(L))){E=E&&(h.isPlainObject(E)||h.isArray(E))?E:h.isArray(L)?[]:{};a[D]=h.extend(t,E,L)}else if(L!==undefined)a[D]=L}return a};h.extend({noConflict:function(a){window.$=F;if(a)window.jQuery=A;return h},isReady:false,ready:function(){if(!h.isReady){if(!o.body)return setTimeout(h.ready,13);h.isReady=true;if(ha){for(var a,l=0;a=ha[l++];)a.call(o,h);ha=null}h.fn.triggerHandler&&h(o).triggerHandler("ready")}},bindReady:function(){if(!ca){ca=true;if(o.readyState==="complete")return h.ready();if(o.addEventListener){o.addEventListener("DOMContentLoaded",
ga,false);window.addEventListener("load",h.ready,false)}else if(o.attachEvent){o.attachEvent("onreadystatechange",ga);window.attachEvent("onload",h.ready);var a=false;try{a=window.frameElement==null}catch(l){}o.documentElement.doScroll&&a&&u()}}},isFunction:function(a){return la.call(a)==="[object Function]"},isArray:function(a){return la.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||la.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!ma.call(a,
"constructor")&&!ma.call(a.constructor.prototype,"isPrototypeOf"))return false;var l;for(l in a);return l===undefined||ma.call(a,l)},isEmptyObject:function(a){for(var l in a)return false;return true},error:function(a){throw a;},parseJSON:function(a){if(typeof a!=="string"||!a)return null;a=h.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return window.JSON&&
window.JSON.parse?window.JSON.parse(a):(new Function("return "+a))();else h.error("Invalid JSON: "+a)},noop:function(){},globalEval:function(a){if(a&&M.test(a)){var l=o.getElementsByTagName("head")[0]||o.documentElement,n=o.createElement("script");n.type="text/javascript";if(h.support.scriptEval)n.appendChild(o.createTextNode(a));else n.text=a;l.insertBefore(n,l.firstChild);l.removeChild(n)}},nodeName:function(a,l){return a.nodeName&&a.nodeName.toUpperCase()===l.toUpperCase()},each:function(a,l,n){var t,
r=0,D=a.length,E=D===undefined||h.isFunction(a);if(n)if(E)for(t in a){if(l.apply(a[t],n)===false)break}else for(;r<D;){if(l.apply(a[r++],n)===false)break}else if(E)for(t in a){if(l.call(a[t],t,a[t])===false)break}else for(n=a[0];r<D&&l.call(n,r,n)!==false;n=a[++r]);return a},trim:function(a){return(a||"").replace(Z,"")},makeArray:function(a,l){l=l||[];if(a!=null)a.length==null||typeof a==="string"||h.isFunction(a)||typeof a!=="function"&&a.setInterval?na.call(l,a):h.merge(l,a);return l},inArray:function(a,
l){if(l.indexOf)return l.indexOf(a);for(var n=0,t=l.length;n<t;n++)if(l[n]===a)return n;return-1},merge:function(a,l){var n=a.length,t=0;if(typeof l.length==="number")for(var r=l.length;t<r;t++)a[n++]=l[t];else for(;l[t]!==undefined;)a[n++]=l[t++];a.length=n;return a},grep:function(a,l,n){for(var t=[],r=0,D=a.length;r<D;r++)!n!==!l(a[r],r)&&t.push(a[r]);return t},map:function(a,l,n){for(var t=[],r,D=0,E=a.length;D<E;D++){r=l(a[D],D,n);if(r!=null)t[t.length]=r}return t.concat.apply([],t)},guid:1,proxy:function(a,
l,n){if(arguments.length===2)if(typeof l==="string"){n=a;a=n[l];l=undefined}else if(l&&!h.isFunction(l)){n=l;l=undefined}if(!l&&a)l=function(){return a.apply(n||this,arguments)};if(a)l.guid=a.guid=a.guid||l.guid||h.guid++;return l},uaMatch:function(a){a=a.toLowerCase();a=/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},browser:{}});
x=h.uaMatch(x);if(x.browser){h.browser[x.browser]=true;h.browser.version=x.version}if(h.browser.webkit)h.browser.safari=true;if(Q)h.inArray=function(a,l){return Q.call(l,a)};z=h(o);if(o.addEventListener)ga=function(){o.removeEventListener("DOMContentLoaded",ga,false);h.ready()};else if(o.attachEvent)ga=function(){if(o.readyState==="complete"){o.detachEvent("onreadystatechange",ga);h.ready()}};(function(){h.support={};var a=o.documentElement,l=o.createElement("script"),n=o.createElement("div"),t="script"+
e();n.style.display="none";n.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var r=n.getElementsByTagName("*"),D=n.getElementsByTagName("a")[0];if(!(!r||!r.length||!D)){h.support={leadingWhitespace:n.firstChild.nodeType===3,tbody:!n.getElementsByTagName("tbody").length,htmlSerialize:!!n.getElementsByTagName("link").length,style:/red/.test(D.getAttribute("style")),hrefNormalized:D.getAttribute("href")==="/a",opacity:/^0.55$/.test(D.style.opacity),
cssFloat:!!D.style.cssFloat,checkOn:n.getElementsByTagName("input")[0].value==="on",optSelected:o.createElement("select").appendChild(o.createElement("option")).selected,parentNode:n.removeChild(n.appendChild(o.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};l.type="text/javascript";try{l.appendChild(o.createTextNode("window."+t+"=1;"))}catch(E){}a.insertBefore(l,a.firstChild);if(window[t]){h.support.scriptEval=true;delete window[t]}try{delete l.test}catch(L){h.support.deleteExpando=
false}a.removeChild(l);if(n.attachEvent&&n.fireEvent){n.attachEvent("onclick",function H(){h.support.noCloneEvent=false;n.detachEvent("onclick",H)});n.cloneNode(true).fireEvent("onclick")}n=o.createElement("div");n.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=o.createDocumentFragment();a.appendChild(n.firstChild);h.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;h(function(){var H=o.createElement("div");H.style.width=H.style.paddingLeft="1px";o.body.appendChild(H);
h.boxModel=h.support.boxModel=H.offsetWidth===2;o.body.removeChild(H).style.display="none"});a=function(H){var K=o.createElement("div");H="on"+H;var R=H in K;if(!R){K.setAttribute(H,"return;");R=typeof K[H]==="function"}return R};h.support.submitBubbles=a("submit");h.support.changeBubbles=a("change");a=l=n=r=D=null}})();h.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",
frameborder:"frameBorder"};var S="jQuery"+e(),U=0,aa={};h.extend({cache:{},expando:S,noData:{embed:true,object:true,applet:true},data:function(a,l,n){if(!(a.nodeName&&h.noData[a.nodeName.toLowerCase()])){a=a==window?aa:a;var t=a[S],r=h.cache;if(!t&&typeof l==="string"&&n===undefined)return null;t||(t=++U);if(typeof l==="object"){a[S]=t;r[t]=h.extend(true,{},l)}else if(!r[t]){a[S]=t;r[t]={}}a=r[t];if(n!==undefined)a[l]=n;return typeof l==="string"?a[l]:a}},removeData:function(a,l){if(!(a.nodeName&&
h.noData[a.nodeName.toLowerCase()])){a=a==window?aa:a;var n=a[S],t=h.cache,r=t[n];if(l){if(r){delete r[l];h.isEmptyObject(r)&&h.removeData(a)}}else{if(h.support.deleteExpando)delete a[h.expando];else a.removeAttribute&&a.removeAttribute(h.expando);delete t[n]}}}});h.fn.extend({data:function(a,l){if(typeof a==="undefined"&&this.length)return h.data(this[0]);else if(typeof a==="object")return this.each(function(){h.data(this,a)});var n=a.split(".");n[1]=n[1]?"."+n[1]:"";if(l===undefined){var t=this.triggerHandler("getData"+
n[1]+"!",[n[0]]);if(t===undefined&&this.length)t=h.data(this[0],a);return t===undefined&&n[1]?this.data(n[0]):t}else return this.trigger("setData"+n[1]+"!",[n[0],l]).each(function(){h.data(this,a,l)})},removeData:function(a){return this.each(function(){h.removeData(this,a)})}});h.extend({queue:function(a,l,n){if(a){l=(l||"fx")+"queue";var t=h.data(a,l);if(!n)return t||[];if(!t||h.isArray(n))t=h.data(a,l,h.makeArray(n));else t.push(n);return t}},dequeue:function(a,l){l=l||"fx";var n=h.queue(a,l),t=
n.shift();if(t==="inprogress")t=n.shift();if(t){l==="fx"&&n.unshift("inprogress");t.call(a,function(){h.dequeue(a,l)})}}});h.fn.extend({queue:function(a,l){if(typeof a!=="string"){l=a;a="fx"}if(l===undefined)return h.queue(this[0],a);return this.each(function(){var n=h.queue(this,a,l);a==="fx"&&n[0]!=="inprogress"&&h.dequeue(this,a)})},dequeue:function(a){return this.each(function(){h.dequeue(this,a)})},delay:function(a,l){a=h.fx?h.fx.speeds[a]||a:a;l=l||"fx";return this.queue(l,function(){var n=
this;setTimeout(function(){h.dequeue(n,l)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var fa=/[\n\t]/g,xa=/\s+/,Za=/\r/g,$a=/href|src|style/,ab=/(button|input)/i,bb=/(button|input|object|select|textarea)/i,cb=/^(a|area)$/i,Ka=/radio|checkbox/;h.fn.extend({attr:function(a,l){return f(this,a,l,true,h.attr)},removeAttr:function(a){return this.each(function(){h.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(h.isFunction(a))return this.each(function(K){var R=
h(this);R.addClass(a.call(this,K,R.attr("class")))});if(a&&typeof a==="string")for(var l=(a||"").split(xa),n=0,t=this.length;n<t;n++){var r=this[n];if(r.nodeType===1)if(r.className){for(var D=" "+r.className+" ",E=r.className,L=0,H=l.length;L<H;L++)if(D.indexOf(" "+l[L]+" ")<0)E+=" "+l[L];r.className=h.trim(E)}else r.className=a}return this},removeClass:function(a){if(h.isFunction(a))return this.each(function(H){var K=h(this);K.removeClass(a.call(this,H,K.attr("class")))});if(a&&typeof a==="string"||
a===undefined)for(var l=(a||"").split(xa),n=0,t=this.length;n<t;n++){var r=this[n];if(r.nodeType===1&&r.className)if(a){for(var D=(" "+r.className+" ").replace(fa," "),E=0,L=l.length;E<L;E++)D=D.replace(" "+l[E]+" "," ");r.className=h.trim(D)}else r.className=""}return this},toggleClass:function(a,l){var n=typeof a,t=typeof l==="boolean";if(h.isFunction(a))return this.each(function(r){var D=h(this);D.toggleClass(a.call(this,r,D.attr("class"),l),l)});return this.each(function(){if(n==="string")for(var r,
D=0,E=h(this),L=l,H=a.split(xa);r=H[D++];){L=t?L:!E.hasClass(r);E[L?"addClass":"removeClass"](r)}else if(n==="undefined"||n==="boolean"){this.className&&h.data(this,"__className__",this.className);this.className=this.className||a===false?"":h.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var l=0,n=this.length;l<n;l++)if((" "+this[l].className+" ").replace(fa," ").indexOf(a)>-1)return true;return false},val:function(a){if(a===undefined){var l=this[0];if(l){if(h.nodeName(l,
"option"))return(l.attributes.value||{}).specified?l.value:l.text;if(h.nodeName(l,"select")){var n=l.selectedIndex,t=[],r=l.options;l=l.type==="select-one";if(n<0)return null;var D=l?n:0;for(n=l?n+1:r.length;D<n;D++){var E=r[D];if(E.selected){a=h(E).val();if(l)return a;t.push(a)}}return t}if(Ka.test(l.type)&&!h.support.checkOn)return l.getAttribute("value")===null?"on":l.value;return(l.value||"").replace(Za,"")}}else{var L=h.isFunction(a);return this.each(function(H){var K=h(this),R=a;if(this.nodeType===
1){if(L)R=a.call(this,H,K.val());if(typeof R==="number")R+="";if(h.isArray(R)&&Ka.test(this.type))this.checked=h.inArray(K.val(),R)>=0;else if(h.nodeName(this,"select")){var W=h.makeArray(R);h("option",this).each(function(){this.selected=h.inArray(h(this).val(),W)>=0});if(!W.length)this.selectedIndex=-1}else this.value=R}})}}});h.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(a,l,n,t){if(!(!a||a.nodeType===3||a.nodeType===8)){if(t&&
l in h.attrFn)return h(a)[l](n);t=a.nodeType!==1||!h.isXMLDoc(a);var r=n!==undefined;l=t&&h.props[l]||l;if(a.nodeType===1){var D=$a.test(l);if(l in a&&t&&!D){if(r){l==="type"&&ab.test(a.nodeName)&&a.parentNode&&h.error("type property can't be changed");a[l]=n}if(h.nodeName(a,"form")&&a.getAttributeNode(l))return a.getAttributeNode(l).nodeValue;if(l==="tabIndex")return(l=a.getAttributeNode("tabIndex"))&&l.specified?l.value:bb.test(a.nodeName)||cb.test(a.nodeName)&&a.href?0:undefined;return a[l]}if(!h.support.style&&
t&&l==="style"){if(r)a.style.cssText=""+n;return a.style.cssText}r&&a.setAttribute(l,""+n);a=!h.support.hrefNormalized&&t&&D?a.getAttribute(l,2):a.getAttribute(l);return a===null?undefined:a}return h.style(a,l,n)}}});var sa=/\.(.*)$/,db=function(a){return a.replace(/[^\w\s\.\|`]/g,function(l){return"\\"+l})};h.event={add:function(a,l,n,t){if(!(a.nodeType===3||a.nodeType===8)){if(a.setInterval&&a!==window&&!a.frameElement)a=window;var r,D;if(n.handler){r=n;n=r.handler}if(!n.guid)n.guid=h.guid++;if(D=
h.data(a)){var E=D.events=D.events||{},L=D.handle;if(!L)D.handle=L=function(){return typeof h!=="undefined"&&!h.event.triggered?h.event.handle.apply(L.elem,arguments):undefined};L.elem=a;l=l.split(" ");for(var H,K=0,R;H=l[K++];){D=r?h.extend({},r):{handler:n,data:t};if(H.indexOf(".")>-1){R=H.split(".");H=R.shift();D.namespace=R.slice(0).sort().join(".")}else{R=[];D.namespace=""}D.type=H;D.guid=n.guid;var W=E[H],ba=h.event.special[H]||{};if(!W){W=E[H]=[];if(!ba.setup||ba.setup.call(a,t,R,L)===false)if(a.addEventListener)a.addEventListener(H,
L,false);else a.attachEvent&&a.attachEvent("on"+H,L)}if(ba.add){ba.add.call(a,D);if(!D.handler.guid)D.handler.guid=n.guid}W.push(D);h.event.global[H]=true}a=null}}},global:{},remove:function(a,l,n,t){if(!(a.nodeType===3||a.nodeType===8)){var r,D=0,E,L,H,K,R,W,ba=h.data(a),ea=ba&&ba.events;if(ba&&ea){if(l&&l.type){n=l.handler;l=l.type}if(!l||typeof l==="string"&&l.charAt(0)==="."){l=l||"";for(r in ea)h.event.remove(a,r+l)}else{for(l=l.split(" ");r=l[D++];){K=r;E=r.indexOf(".")<0;L=[];if(!E){L=r.split(".");
r=L.shift();H=new RegExp("(^|\\.)"+h.map(L.slice(0).sort(),db).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(R=ea[r])if(n){K=h.event.special[r]||{};for(da=t||0;da<R.length;da++){W=R[da];if(n.guid===W.guid){if(E||H.test(W.namespace)){t==null&&R.splice(da--,1);K.remove&&K.remove.call(a,W)}if(t!=null)break}}if(R.length===0||t!=null&&R.length===1){if(!K.teardown||K.teardown.call(a,L)===false)La(a,r,ba.handle);delete ea[r]}}else for(var da=0;da<R.length;da++){W=R[da];if(E||H.test(W.namespace)){h.event.remove(a,
K,W.handler,da);R.splice(da--,1)}}}if(h.isEmptyObject(ea)){if(l=ba.handle)l.elem=null;delete ba.events;delete ba.handle;h.isEmptyObject(ba)&&h.removeData(a)}}}}},trigger:function(a,l,n,t){var r=a.type||a;if(!t){a=typeof a==="object"?a[S]?a:h.extend(h.Event(r),a):h.Event(r);if(r.indexOf("!")>=0){a.type=r=r.slice(0,-1);a.exclusive=true}if(!n){a.stopPropagation();h.event.global[r]&&h.each(h.cache,function(){this.events&&this.events[r]&&h.event.trigger(a,l,this.handle.elem)})}if(!n||n.nodeType===3||n.nodeType===
8)return;a.result=undefined;a.target=n;l=h.makeArray(l);l.unshift(a)}a.currentTarget=n;(t=h.data(n,"handle"))&&t.apply(n,l);t=n.parentNode||n.ownerDocument;try{if(!(n&&n.nodeName&&h.noData[n.nodeName.toLowerCase()]))if(n["on"+r]&&n["on"+r].apply(n,l)===false)a.result=false}catch(D){}if(!a.isPropagationStopped()&&t)h.event.trigger(a,l,t,true);else if(!a.isDefaultPrevented()){t=a.target;var E,L=h.nodeName(t,"a")&&r==="click",H=h.event.special[r]||{};if((!H._default||H._default.call(n,a)===false)&&!L&&
!(t&&t.nodeName&&h.noData[t.nodeName.toLowerCase()])){try{if(t[r]){if(E=t["on"+r])t["on"+r]=null;h.event.triggered=true;t[r]()}}catch(K){}if(E)t["on"+r]=E;h.event.triggered=false}}},handle:function(a){var l,n,t,r;a=arguments[0]=h.event.fix(a||window.event);a.currentTarget=this;l=a.type.indexOf(".")<0&&!a.exclusive;if(!l){n=a.type.split(".");a.type=n.shift();t=new RegExp("(^|\\.)"+n.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}r=h.data(this,"events");n=r[a.type];if(r&&n){n=n.slice(0);r=0;for(var D=
n.length;r<D;r++){var E=n[r];if(l||t.test(E.namespace)){a.handler=E.handler;a.data=E.data;a.handleObj=E;E=E.handler.apply(this,arguments);if(E!==undefined){a.result=E;if(E===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),
fix:function(a){if(a[S])return a;var l=a;a=h.Event(l);for(var n=this.props.length,t;n;){t=this.props[--n];a[t]=l[t]}if(!a.target)a.target=a.srcElement||o;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){l=o.documentElement;n=o.body;a.pageX=a.clientX+(l&&l.scrollLeft||n&&n.scrollLeft||0)-(l&&l.clientLeft||n&&n.clientLeft||0);a.pageY=a.clientY+(l&&l.scrollTop||
n&&n.scrollTop||0)-(l&&l.clientTop||n&&n.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==undefined)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1E8,proxy:h.proxy,special:{ready:{setup:h.bindReady,teardown:h.noop},live:{add:function(a){h.event.add(this,a.origType,h.extend({},a,{handler:i}))},remove:function(a){var l=true,n=a.origType.replace(sa,"");h.each(h.data(this,
"events").live||[],function(){if(n===this.origType.replace(sa,""))return l=false});l&&h.event.remove(this,a.origType,i)}},beforeunload:{setup:function(a,l,n){if(this.setInterval)this.onbeforeunload=n;return false},teardown:function(a,l){if(this.onbeforeunload===l)this.onbeforeunload=null}}}};var La=o.removeEventListener?function(a,l,n){a.removeEventListener(l,n,false)}:function(a,l,n){a.detachEvent("on"+l,n)};h.Event=function(a){if(!this.preventDefault)return new h.Event(a);if(a&&a.type){this.originalEvent=
a;this.type=a.type}else this.type=a;this.timeStamp=e();this[S]=true};h.Event.prototype={preventDefault:function(){this.isDefaultPrevented=b;var a=this.originalEvent;if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=b;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=b;this.stopPropagation()},isDefaultPrevented:d,isPropagationStopped:d,
isImmediatePropagationStopped:d};var Ma=function(a){var l=a.relatedTarget;try{for(;l&&l!==this;)l=l.parentNode;if(l!==this){a.type=a.data;h.event.handle.apply(this,arguments)}}catch(n){}},Na=function(a){a.type=a.data;h.event.handle.apply(this,arguments)};h.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,l){h.event.special[a]={setup:function(n){h.event.add(this,l,n&&n.selector?Na:Ma,a)},teardown:function(n){h.event.remove(this,l,n&&n.selector?Na:Ma)}}});if(!h.support.submitBubbles)h.event.special.submit=
{setup:function(){if(this.nodeName.toLowerCase()!=="form"){h.event.add(this,"click.specialSubmit",function(a){var l=a.target,n=l.type;if((n==="submit"||n==="image")&&h(l).closest("form").length)return j("submit",this,arguments)});h.event.add(this,"keypress.specialSubmit",function(a){var l=a.target,n=l.type;if((n==="text"||n==="password")&&h(l).closest("form").length&&a.keyCode===13)return j("submit",this,arguments)})}else return false},teardown:function(){h.event.remove(this,".specialSubmit")}};if(!h.support.changeBubbles){var ya=
/textarea|input|select/i,za,Oa=function(a){var l=a.type,n=a.value;if(l==="radio"||l==="checkbox")n=a.checked;else if(l==="select-multiple")n=a.selectedIndex>-1?h.map(a.options,function(t){return t.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")n=a.selectedIndex;return n},Aa=function(a,l){var n=a.target,t,r;if(!(!ya.test(n.nodeName)||n.readOnly)){t=h.data(n,"_change_data");r=Oa(n);if(a.type!=="focusout"||n.type!=="radio")h.data(n,"_change_data",r);if(!(t===undefined||r===t))if(t!=
null||r){a.type="change";return h.event.trigger(a,l,n)}}};h.event.special.change={filters:{focusout:Aa,click:function(a){var l=a.target,n=l.type;if(n==="radio"||n==="checkbox"||l.nodeName.toLowerCase()==="select")return Aa.call(this,a)},keydown:function(a){var l=a.target,n=l.type;if(a.keyCode===13&&l.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(n==="checkbox"||n==="radio")||n==="select-multiple")return Aa.call(this,a)},beforeactivate:function(a){a=a.target;h.data(a,"_change_data",Oa(a))}},
setup:function(){if(this.type==="file")return false;for(var a in za)h.event.add(this,a+".specialChange",za[a]);return ya.test(this.nodeName)},teardown:function(){h.event.remove(this,".specialChange");return ya.test(this.nodeName)}};za=h.event.special.change.filters}o.addEventListener&&h.each({focus:"focusin",blur:"focusout"},function(a,l){function n(t){t=h.event.fix(t);t.type=l;return h.event.handle.call(this,t)}h.event.special[l]={setup:function(){this.addEventListener(a,n,true)},teardown:function(){this.removeEventListener(a,
n,true)}}});h.each(["bind","one"],function(a,l){h.fn[l]=function(n,t,r){if(typeof n==="object"){for(var D in n)this[l](D,t,n[D],r);return this}if(h.isFunction(t)){r=t;t=undefined}var E=l==="one"?h.proxy(r,function(H){h(this).unbind(H,E);return r.apply(this,arguments)}):r;if(n==="unload"&&l!=="one")this.one(n,t,r);else{D=0;for(var L=this.length;D<L;D++)h.event.add(this[D],n,E,t)}return this}});h.fn.extend({unbind:function(a,l){if(typeof a==="object"&&!a.preventDefault)for(var n in a)this.unbind(n,
a[n]);else{n=0;for(var t=this.length;n<t;n++)h.event.remove(this[n],a,l)}return this},delegate:function(a,l,n,t){return this.live(l,n,t,a)},undelegate:function(a,l,n){return arguments.length===0?this.unbind("live"):this.die(l,null,n,a)},trigger:function(a,l){return this.each(function(){h.event.trigger(a,l,this)})},triggerHandler:function(a,l){if(this[0]){a=h.Event(a);a.preventDefault();a.stopPropagation();h.event.trigger(a,l,this[0]);return a.result}},toggle:function(a){for(var l=arguments,n=1;n<
l.length;)h.proxy(a,l[n++]);return this.click(h.proxy(a,function(t){var r=(h.data(this,"lastToggle"+a.guid)||0)%n;h.data(this,"lastToggle"+a.guid,r+1);t.preventDefault();return l[r].apply(this,arguments)||false}))},hover:function(a,l){return this.mouseenter(a).mouseleave(l||a)}});var Pa={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};h.each(["live","die"],function(a,l){h.fn[l]=function(n,t,r,D){var E,L=0,H,K,R=D||this.selector,W=D?this:h(this.context);if(h.isFunction(t)){r=
t;t=undefined}for(n=(n||"").split(" ");(E=n[L++])!=null;){D=sa.exec(E);H="";if(D){H=D[0];E=E.replace(sa,"")}if(E==="hover")n.push("mouseenter"+H,"mouseleave"+H);else{K=E;if(E==="focus"||E==="blur"){n.push(Pa[E]+H);E+=H}else E=(Pa[E]||E)+H;l==="live"?W.each(function(){h.event.add(this,g(E,R),{data:t,selector:R,handler:r,origType:E,origHandler:r,preType:K})}):W.unbind(g(E,R),r)}}return this}});h.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),
function(a,l){h.fn[l]=function(n){return n?this.bind(l,n):this.trigger(l)};if(h.attrFn)h.attrFn[l]=true});window.attachEvent&&!window.addEventListener&&window.attachEvent("onunload",function(){for(var a in h.cache)if(h.cache[a].handle)try{h.event.remove(h.cache[a].handle.elem)}catch(l){}});(function(){function a(w){for(var B="",I,J=0;w[J];J++){I=w[J];if(I.nodeType===3||I.nodeType===4)B+=I.nodeValue;else if(I.nodeType!==8)B+=a(I.childNodes)}return B}function l(w,B,I,J,O,N){O=0;for(var X=J.length;O<
X;O++){var V=J[O];if(V){V=V[w];for(var $=false;V;){if(V.sizcache===I){$=J[V.sizset];break}if(V.nodeType===1&&!N){V.sizcache=I;V.sizset=O}if(V.nodeName.toLowerCase()===B){$=V;break}V=V[w]}J[O]=$}}}function n(w,B,I,J,O,N){O=0;for(var X=J.length;O<X;O++){var V=J[O];if(V){V=V[w];for(var $=false;V;){if(V.sizcache===I){$=J[V.sizset];break}if(V.nodeType===1){if(!N){V.sizcache=I;V.sizset=O}if(typeof B!=="string"){if(V===B){$=true;break}}else if(H.filter(B,[V]).length>0){$=V;break}}V=V[w]}J[O]=$}}}var t=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,
r=0,D=Object.prototype.toString,E=false,L=true;[0,0].sort(function(){L=false;return 0});var H=function(w,B,I,J){I=I||[];var O=B=B||o;if(B.nodeType!==1&&B.nodeType!==9)return[];if(!w||typeof w!=="string")return I;for(var N=[],X,V,$,ta,oa=true,qa=Y(B),pa=w;(t.exec(""),X=t.exec(pa))!==null;){pa=X[3];N.push(X[1]);if(X[2]){ta=X[3];break}}if(N.length>1&&R.exec(w))if(N.length===2&&K.relative[N[0]])V=Ba(N[0]+N[1],B);else for(V=K.relative[N[0]]?[B]:H(N.shift(),B);N.length;){w=N.shift();if(K.relative[w])w+=
N.shift();V=Ba(w,V)}else{if(!J&&N.length>1&&B.nodeType===9&&!qa&&K.match.ID.test(N[0])&&!K.match.ID.test(N[N.length-1])){X=H.find(N.shift(),B,qa);B=X.expr?H.filter(X.expr,X.set)[0]:X.set[0]}if(B){X=J?{expr:N.pop(),set:ba(J)}:H.find(N.pop(),N.length===1&&(N[0]==="~"||N[0]==="+")&&B.parentNode?B.parentNode:B,qa);V=X.expr?H.filter(X.expr,X.set):X.set;if(N.length>0)$=ba(V);else oa=false;for(;N.length;){var ia=N.pop();X=ia;if(K.relative[ia])X=N.pop();else ia="";if(X==null)X=B;K.relative[ia]($,X,qa)}}else $=
[]}$||($=V);$||H.error(ia||w);if(D.call($)==="[object Array]")if(oa)if(B&&B.nodeType===1)for(w=0;$[w]!=null;w++){if($[w]&&($[w]===true||$[w].nodeType===1&&ja(B,$[w])))I.push(V[w])}else for(w=0;$[w]!=null;w++)$[w]&&$[w].nodeType===1&&I.push(V[w]);else I.push.apply(I,$);else ba($,I);if(ta){H(ta,O,I,J);H.uniqueSort(I)}return I};H.uniqueSort=function(w){if(da){E=L;w.sort(da);if(E)for(var B=1;B<w.length;B++)w[B]===w[B-1]&&w.splice(B--,1)}return w};H.matches=function(w,B){return H(w,null,null,B)};H.find=
function(w,B,I){var J,O;if(!w)return[];for(var N=0,X=K.order.length;N<X;N++){var V=K.order[N];if(O=K.leftMatch[V].exec(w)){var $=O[1];O.splice(1,1);if($.substr($.length-1)!=="\\"){O[1]=(O[1]||"").replace(/\\/g,"");J=K.find[V](O,B,I);if(J!=null){w=w.replace(K.match[V],"");break}}}}J||(J=B.getElementsByTagName("*"));return{set:J,expr:w}};H.filter=function(w,B,I,J){for(var O=w,N=[],X=B,V,$,ta=B&&B[0]&&Y(B[0]);w&&B.length;){for(var oa in K.filter)if((V=K.leftMatch[oa].exec(w))!=null&&V[2]){var qa=K.filter[oa],
pa,ia;ia=V[1];$=false;V.splice(1,1);if(ia.substr(ia.length-1)!=="\\"){if(X===N)N=[];if(K.preFilter[oa])if(V=K.preFilter[oa](V,X,I,N,J,ta)){if(V===true)continue}else $=pa=true;if(V)for(var ua=0;(ia=X[ua])!=null;ua++)if(ia){pa=qa(ia,V,ua,X);var Qa=J^!!pa;if(I&&pa!=null)if(Qa)$=true;else X[ua]=false;else if(Qa){N.push(ia);$=true}}if(pa!==undefined){I||(X=N);w=w.replace(K.match[oa],"");if(!$)return[];break}}}if(w===O)if($==null)H.error(w);else break;O=w}return X};H.error=function(w){throw"Syntax error, unrecognized expression: "+
w;};var K=H.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},
leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(w){return w.getAttribute("href")}},relative:{"+":function(w,B){var I=typeof B==="string",J=I&&!/\W/.test(B);I=I&&!J;if(J)B=B.toLowerCase();J=0;for(var O=w.length,N;J<O;J++)if(N=w[J]){for(;(N=N.previousSibling)&&N.nodeType!==1;);w[J]=I||N&&N.nodeName.toLowerCase()===B?N||false:N===B}I&&H.filter(B,w,true)},">":function(w,B){var I=typeof B==="string";if(I&&!/\W/.test(B)){B=B.toLowerCase();for(var J=0,O=w.length;J<O;J++){var N=
w[J];if(N){I=N.parentNode;w[J]=I.nodeName.toLowerCase()===B?I:false}}}else{J=0;for(O=w.length;J<O;J++)if(N=w[J])w[J]=I?N.parentNode:N.parentNode===B;I&&H.filter(B,w,true)}},"":function(w,B,I){var J=r++,O=n;if(typeof B==="string"&&!/\W/.test(B)){var N=B=B.toLowerCase();O=l}O("parentNode",B,J,w,N,I)},"~":function(w,B,I){var J=r++,O=n;if(typeof B==="string"&&!/\W/.test(B)){var N=B=B.toLowerCase();O=l}O("previousSibling",B,J,w,N,I)}},find:{ID:function(w,B,I){if(typeof B.getElementById!=="undefined"&&
!I)return(w=B.getElementById(w[1]))?[w]:[]},NAME:function(w,B){if(typeof B.getElementsByName!=="undefined"){var I=[];B=B.getElementsByName(w[1]);for(var J=0,O=B.length;J<O;J++)B[J].getAttribute("name")===w[1]&&I.push(B[J]);return I.length===0?null:I}},TAG:function(w,B){return B.getElementsByTagName(w[1])}},preFilter:{CLASS:function(w,B,I,J,O,N){w=" "+w[1].replace(/\\/g,"")+" ";if(N)return w;N=0;for(var X;(X=B[N])!=null;N++)if(X)if(O^(X.className&&(" "+X.className+" ").replace(/[\t\n]/g," ").indexOf(w)>=
0))I||J.push(X);else if(I)B[N]=false;return false},ID:function(w){return w[1].replace(/\\/g,"")},TAG:function(w){return w[1].toLowerCase()},CHILD:function(w){if(w[1]==="nth"){var B=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(w[2]==="even"&&"2n"||w[2]==="odd"&&"2n+1"||!/\D/.test(w[2])&&"0n+"+w[2]||w[2]);w[2]=B[1]+(B[2]||1)-0;w[3]=B[3]-0}w[0]=r++;return w},ATTR:function(w,B,I,J,O,N){B=w[1].replace(/\\/g,"");if(!N&&K.attrMap[B])w[1]=K.attrMap[B];if(w[2]==="~=")w[4]=" "+w[4]+" ";return w},PSEUDO:function(w,B,I,J,
O){if(w[1]==="not")if((t.exec(w[3])||"").length>1||/^\w/.test(w[3]))w[3]=H(w[3],null,null,B);else{w=H.filter(w[3],B,I,true^O);I||J.push.apply(J,w);return false}else if(K.match.POS.test(w[0])||K.match.CHILD.test(w[0]))return true;return w},POS:function(w){w.unshift(true);return w}},filters:{enabled:function(w){return w.disabled===false&&w.type!=="hidden"},disabled:function(w){return w.disabled===true},checked:function(w){return w.checked===true},selected:function(w){return w.selected===true},parent:function(w){return!!w.firstChild},
empty:function(w){return!w.firstChild},has:function(w,B,I){return!!H(I[3],w).length},header:function(w){return/h\d/i.test(w.nodeName)},text:function(w){return"text"===w.type},radio:function(w){return"radio"===w.type},checkbox:function(w){return"checkbox"===w.type},file:function(w){return"file"===w.type},password:function(w){return"password"===w.type},submit:function(w){return"submit"===w.type},image:function(w){return"image"===w.type},reset:function(w){return"reset"===w.type},button:function(w){return"button"===
w.type||w.nodeName.toLowerCase()==="button"},input:function(w){return/input|select|textarea|button/i.test(w.nodeName)}},setFilters:{first:function(w,B){return B===0},last:function(w,B,I,J){return B===J.length-1},even:function(w,B){return B%2===0},odd:function(w,B){return B%2===1},lt:function(w,B,I){return B<I[3]-0},gt:function(w,B,I){return B>I[3]-0},nth:function(w,B,I){return I[3]-0===B},eq:function(w,B,I){return I[3]-0===B}},filter:{PSEUDO:function(w,B,I,J){var O=B[1],N=K.filters[O];if(N)return N(w,
I,B,J);else if(O==="contains")return(w.textContent||w.innerText||a([w])||"").indexOf(B[3])>=0;else if(O==="not"){B=B[3];I=0;for(J=B.length;I<J;I++)if(B[I]===w)return false;return true}else H.error("Syntax error, unrecognized expression: "+O)},CHILD:function(w,B){var I=B[1],J=w;switch(I){case "only":case "first":for(;J=J.previousSibling;)if(J.nodeType===1)return false;if(I==="first")return true;J=w;case "last":for(;J=J.nextSibling;)if(J.nodeType===1)return false;return true;case "nth":I=B[2];var O=
B[3];if(I===1&&O===0)return true;B=B[0];var N=w.parentNode;if(N&&(N.sizcache!==B||!w.nodeIndex)){var X=0;for(J=N.firstChild;J;J=J.nextSibling)if(J.nodeType===1)J.nodeIndex=++X;N.sizcache=B}w=w.nodeIndex-O;return I===0?w===0:w%I===0&&w/I>=0}},ID:function(w,B){return w.nodeType===1&&w.getAttribute("id")===B},TAG:function(w,B){return B==="*"&&w.nodeType===1||w.nodeName.toLowerCase()===B},CLASS:function(w,B){return(" "+(w.className||w.getAttribute("class"))+" ").indexOf(B)>-1},ATTR:function(w,B){var I=
B[1];w=K.attrHandle[I]?K.attrHandle[I](w):w[I]!=null?w[I]:w.getAttribute(I);I=w+"";var J=B[2];B=B[4];return w==null?J==="!=":J==="="?I===B:J==="*="?I.indexOf(B)>=0:J==="~="?(" "+I+" ").indexOf(B)>=0:!B?I&&w!==false:J==="!="?I!==B:J==="^="?I.indexOf(B)===0:J==="$="?I.substr(I.length-B.length)===B:J==="|="?I===B||I.substr(0,B.length+1)===B+"-":false},POS:function(w,B,I,J){var O=K.setFilters[B[2]];if(O)return O(w,I,B,J)}}},R=K.match.POS;for(var W in K.match){K.match[W]=new RegExp(K.match[W].source+/(?![^\[]*\])(?![^\(]*\))/.source);
K.leftMatch[W]=new RegExp(/(^(?:.|\r|\n)*?)/.source+K.match[W].source.replace(/\\(\d+)/g,function(w,B){return"\\"+(B-0+1)}))}var ba=function(w,B){w=Array.prototype.slice.call(w,0);if(B){B.push.apply(B,w);return B}return w};try{Array.prototype.slice.call(o.documentElement.childNodes,0)}catch(ea){ba=function(w,B){B=B||[];if(D.call(w)==="[object Array]")Array.prototype.push.apply(B,w);else if(typeof w.length==="number")for(var I=0,J=w.length;I<J;I++)B.push(w[I]);else for(I=0;w[I];I++)B.push(w[I]);return B}}var da;
if(o.documentElement.compareDocumentPosition)da=function(w,B){if(!w.compareDocumentPosition||!B.compareDocumentPosition){if(w==B)E=true;return w.compareDocumentPosition?-1:1}w=w.compareDocumentPosition(B)&4?-1:w===B?0:1;if(w===0)E=true;return w};else if("sourceIndex"in o.documentElement)da=function(w,B){if(!w.sourceIndex||!B.sourceIndex){if(w==B)E=true;return w.sourceIndex?-1:1}w=w.sourceIndex-B.sourceIndex;if(w===0)E=true;return w};else if(o.createRange)da=function(w,B){if(!w.ownerDocument||!B.ownerDocument){if(w==
B)E=true;return w.ownerDocument?-1:1}var I=w.ownerDocument.createRange(),J=B.ownerDocument.createRange();I.setStart(w,0);I.setEnd(w,0);J.setStart(B,0);J.setEnd(B,0);w=I.compareBoundaryPoints(Range.START_TO_END,J);if(w===0)E=true;return w};(function(){var w=o.createElement("div"),B="script"+(new Date).getTime();w.innerHTML="<a name='"+B+"'/>";var I=o.documentElement;I.insertBefore(w,I.firstChild);if(o.getElementById(B)){K.find.ID=function(J,O,N){if(typeof O.getElementById!=="undefined"&&!N)return(O=
O.getElementById(J[1]))?O.id===J[1]||typeof O.getAttributeNode!=="undefined"&&O.getAttributeNode("id").nodeValue===J[1]?[O]:undefined:[]};K.filter.ID=function(J,O){var N=typeof J.getAttributeNode!=="undefined"&&J.getAttributeNode("id");return J.nodeType===1&&N&&N.nodeValue===O}}I.removeChild(w);I=w=null})();(function(){var w=o.createElement("div");w.appendChild(o.createComment(""));if(w.getElementsByTagName("*").length>0)K.find.TAG=function(B,I){I=I.getElementsByTagName(B[1]);if(B[1]==="*"){B=[];
for(var J=0;I[J];J++)I[J].nodeType===1&&B.push(I[J]);I=B}return I};w.innerHTML="<a href='#'></a>";if(w.firstChild&&typeof w.firstChild.getAttribute!=="undefined"&&w.firstChild.getAttribute("href")!=="#")K.attrHandle.href=function(B){return B.getAttribute("href",2)};w=null})();o.querySelectorAll&&function(){var w=H,B=o.createElement("div");B.innerHTML="<p class='TEST'></p>";if(!(B.querySelectorAll&&B.querySelectorAll(".TEST").length===0)){H=function(J,O,N,X){O=O||o;if(!X&&O.nodeType===9&&!Y(O))try{return ba(O.querySelectorAll(J),
N)}catch(V){}return w(J,O,N,X)};for(var I in w)H[I]=w[I];B=null}}();(function(){var w=o.createElement("div");w.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!w.getElementsByClassName||w.getElementsByClassName("e").length===0)){w.lastChild.className="e";if(w.getElementsByClassName("e").length!==1){K.order.splice(1,0,"CLASS");K.find.CLASS=function(B,I,J){if(typeof I.getElementsByClassName!=="undefined"&&!J)return I.getElementsByClassName(B[1])};w=null}}})();var ja=o.compareDocumentPosition?
function(w,B){return!!(w.compareDocumentPosition(B)&16)}:function(w,B){return w!==B&&(w.contains?w.contains(B):true)},Y=function(w){return(w=(w?w.ownerDocument||w:0).documentElement)?w.nodeName!=="HTML":false},Ba=function(w,B){var I=[],J="",O;for(B=B.nodeType?[B]:B;O=K.match.PSEUDO.exec(w);){J+=O[0];w=w.replace(K.match.PSEUDO,"")}w=K.relative[w]?w+"*":w;O=0;for(var N=B.length;O<N;O++)H(w,B[O],I);return H.filter(J,I)};h.find=H;h.expr=H.selectors;h.expr[":"]=h.expr.filters;h.unique=H.uniqueSort;h.text=
a;h.isXMLDoc=Y;h.contains=ja})();var eb=/Until$/,fb=/^(?:parents|prevUntil|prevAll)/,gb=/,/;P=Array.prototype.slice;var Ra=function(a,l,n){if(h.isFunction(l))return h.grep(a,function(r,D){return!!l.call(r,D,r)===n});else if(l.nodeType)return h.grep(a,function(r){return r===l===n});else if(typeof l==="string"){var t=h.grep(a,function(r){return r.nodeType===1});if(G.test(l))return h.filter(l,t,!n);else l=h.filter(l,t)}return h.grep(a,function(r){return h.inArray(r,l)>=0===n})};h.fn.extend({find:function(a){for(var l=
this.pushStack("","find",a),n=0,t=0,r=this.length;t<r;t++){n=l.length;h.find(a,this[t],l);if(t>0)for(var D=n;D<l.length;D++)for(var E=0;E<n;E++)if(l[E]===l[D]){l.splice(D--,1);break}}return l},has:function(a){var l=h(a);return this.filter(function(){for(var n=0,t=l.length;n<t;n++)if(h.contains(this,l[n]))return true})},not:function(a){return this.pushStack(Ra(this,a,false),"not",a)},filter:function(a){return this.pushStack(Ra(this,a,true),"filter",a)},is:function(a){return!!a&&h.filter(a,this).length>
0},closest:function(a,l){if(h.isArray(a)){var n=[],t=this[0],r,D={},E;if(t&&a.length){r=0;for(var L=a.length;r<L;r++){E=a[r];D[E]||(D[E]=h.expr.match.POS.test(E)?h(E,l||this.context):E)}for(;t&&t.ownerDocument&&t!==l;){for(E in D){r=D[E];if(r.jquery?r.index(t)>-1:h(t).is(r)){n.push({selector:E,elem:t});delete D[E]}}t=t.parentNode}}return n}var H=h.expr.match.POS.test(a)?h(a,l||this.context):null;return this.map(function(K,R){for(;R&&R.ownerDocument&&R!==l;){if(H?H.index(R)>-1:h(R).is(a))return R;
R=R.parentNode}return null})},index:function(a){if(!a||typeof a==="string")return h.inArray(this[0],a?h(a):this.parent().children());return h.inArray(a.jquery?a[0]:a,this)},add:function(a,l){a=typeof a==="string"?h(a,l||this.context):h.makeArray(a);l=h.merge(this.get(),a);return this.pushStack(k(a[0])||k(l[0])?l:h.unique(l))},andSelf:function(){return this.add(this.prevObject)}});h.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return h.dir(a,"parentNode")},
parentsUntil:function(a,l,n){return h.dir(a,"parentNode",n)},next:function(a){return h.nth(a,2,"nextSibling")},prev:function(a){return h.nth(a,2,"previousSibling")},nextAll:function(a){return h.dir(a,"nextSibling")},prevAll:function(a){return h.dir(a,"previousSibling")},nextUntil:function(a,l,n){return h.dir(a,"nextSibling",n)},prevUntil:function(a,l,n){return h.dir(a,"previousSibling",n)},siblings:function(a){return h.sibling(a.parentNode.firstChild,a)},children:function(a){return h.sibling(a.firstChild)},
contents:function(a){return h.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:h.makeArray(a.childNodes)}},function(a,l){h.fn[a]=function(n,t){var r=h.map(this,l,n);eb.test(a)||(t=n);if(t&&typeof t==="string")r=h.filter(t,r);r=this.length>1?h.unique(r):r;if((this.length>1||gb.test(t))&&fb.test(a))r=r.reverse();return this.pushStack(r,a,P.call(arguments).join(","))}});h.extend({filter:function(a,l,n){if(n)a=":not("+a+")";return h.find.matches(a,l)},dir:function(a,l,n){var t=[];for(a=
a[l];a&&a.nodeType!==9&&(n===undefined||a.nodeType!==1||!h(a).is(n));){a.nodeType===1&&t.push(a);a=a[l]}return t},nth:function(a,l,n){l=l||1;for(var t=0;a;a=a[n])if(a.nodeType===1&&++t===l)break;return a},sibling:function(a,l){for(var n=[];a;a=a.nextSibling)a.nodeType===1&&a!==l&&n.push(a);return n}});var Sa=/ jQuery\d+="(?:\d+|null)"/g,va=/^\s+/,Ta=/(<([\w:]+)[^>]*?)\/>/g,hb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,Ua=/<([\w:]+)/,ib=/<tbody/i,jb=/<|&#?\w+;/,Ha=/<script|<object|<embed|<option|<style/i,
Ia=/checked\s*(?:[^=]|=\s*.checked.)/i,Va=function(a,l,n){return hb.test(n)?a:l+"></"+n+">"},ka={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};ka.optgroup=ka.option;ka.tbody=ka.tfoot=ka.colgroup=ka.caption=ka.thead;ka.th=
ka.td;if(!h.support.htmlSerialize)ka._default=[1,"div<div>","</div>"];h.fn.extend({text:function(a){if(h.isFunction(a))return this.each(function(l){var n=h(this);n.text(a.call(this,l,n.text()))});if(typeof a!=="object"&&a!==undefined)return this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(a));return h.text(this)},wrapAll:function(a){if(h.isFunction(a))return this.each(function(n){h(this).wrapAll(a.call(this,n))});if(this[0]){var l=h(a,this[0].ownerDocument).eq(0).clone(true);
this[0].parentNode&&l.insertBefore(this[0]);l.map(function(){for(var n=this;n.firstChild&&n.firstChild.nodeType===1;)n=n.firstChild;return n}).append(this)}return this},wrapInner:function(a){if(h.isFunction(a))return this.each(function(l){h(this).wrapInner(a.call(this,l))});return this.each(function(){var l=h(this),n=l.contents();n.length?n.wrapAll(a):l.append(a)})},wrap:function(a){return this.each(function(){h(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){h.nodeName(this,
"body")||h(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(l){this.parentNode.insertBefore(l,this)});else if(arguments.length){var a=h(arguments[0]);a.push.apply(a,this.toArray());
return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(l){this.parentNode.insertBefore(l,this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,h(arguments[0]).toArray());return a}},remove:function(a,l){for(var n=0,t;(t=this[n])!=null;n++)if(!a||h.filter(a,[t]).length){if(!l&&t.nodeType===1){h.cleanData(t.getElementsByTagName("*"));h.cleanData([t])}t.parentNode&&
t.parentNode.removeChild(t)}return this},empty:function(){for(var a=0,l;(l=this[a])!=null;a++)for(l.nodeType===1&&h.cleanData(l.getElementsByTagName("*"));l.firstChild;)l.removeChild(l.firstChild);return this},clone:function(a){var l=this.map(function(){if(!h.support.noCloneEvent&&!h.isXMLDoc(this)){var n=this.outerHTML,t=this.ownerDocument;if(!n){n=t.createElement("div");n.appendChild(this.cloneNode(true));n=n.innerHTML}return h.clean([n.replace(Sa,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(va,
"")],t)[0]}else return this.cloneNode(true)});if(a===true){m(this,l);m(this.find("*"),l.find("*"))}return l},html:function(a){if(a===undefined)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Sa,""):null;else if(typeof a==="string"&&!Ha.test(a)&&(h.support.leadingWhitespace||!va.test(a))&&!ka[(Ua.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ta,Va);try{for(var l=0,n=this.length;l<n;l++)if(this[l].nodeType===1){h.cleanData(this[l].getElementsByTagName("*"));this[l].innerHTML=a}}catch(t){this.empty().append(a)}}else h.isFunction(a)?
this.each(function(r){var D=h(this),E=D.html();D.empty().append(function(){return a.call(this,r,E)})}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(h.isFunction(a))return this.each(function(l){var n=h(this),t=n.html();n.replaceWith(a.call(this,l,t))});if(typeof a!=="string")a=h(a).detach();return this.each(function(){var l=this.nextSibling,n=this.parentNode;h(this).remove();l?h(l).before(a):h(n).append(a)})}else return this.pushStack(h(h.isFunction(a)?
a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,l,n){function t(W){return h.nodeName(W,"table")?W.getElementsByTagName("tbody")[0]||W.appendChild(W.ownerDocument.createElement("tbody")):W}var r,D,E=a[0],L=[],H;if(!h.support.checkClone&&arguments.length===3&&typeof E==="string"&&Ia.test(E))return this.each(function(){h(this).domManip(a,l,n,true)});if(h.isFunction(E))return this.each(function(W){var ba=h(this);a[0]=E.call(this,W,l?ba.html():undefined);ba.domManip(a,
l,n)});if(this[0]){r=E&&E.parentNode;r=h.support.parentNode&&r&&r.nodeType===11&&r.childNodes.length===this.length?{fragment:r}:p(a,this,L);H=r.fragment;if(D=H.childNodes.length===1?(H=H.firstChild):H.firstChild){l=l&&h.nodeName(D,"tr");for(var K=0,R=this.length;K<R;K++)n.call(l?t(this[K],D):this[K],K>0||r.cacheable||this.length>1?H.cloneNode(true):H)}L.length&&h.each(L,q)}return this}});h.fragments={};h.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},
function(a,l){h.fn[a]=function(n){var t=[];n=h(n);var r=this.length===1&&this[0].parentNode;if(r&&r.nodeType===11&&r.childNodes.length===1&&n.length===1){n[l](this[0]);return this}else{r=0;for(var D=n.length;r<D;r++){var E=(r>0?this.clone(true):this).get();h.fn[l].apply(h(n[r]),E);t=t.concat(E)}return this.pushStack(t,a,n.selector)}}});h.extend({clean:function(a,l,n,t){l=l||o;if(typeof l.createElement==="undefined")l=l.ownerDocument||l[0]&&l[0].ownerDocument||o;for(var r=[],D=0,E;(E=a[D])!=null;D++){if(typeof E===
"number")E+="";if(E){if(typeof E==="string"&&!jb.test(E))E=l.createTextNode(E);else if(typeof E==="string"){E=E.replace(Ta,Va);var L=(Ua.exec(E)||["",""])[1].toLowerCase(),H=ka[L]||ka._default,K=H[0],R=l.createElement("div");for(R.innerHTML=H[1]+E+H[2];K--;)R=R.lastChild;if(!h.support.tbody){K=ib.test(E);L=L==="table"&&!K?R.firstChild&&R.firstChild.childNodes:H[1]==="<table>"&&!K?R.childNodes:[];for(H=L.length-1;H>=0;--H)h.nodeName(L[H],"tbody")&&!L[H].childNodes.length&&L[H].parentNode.removeChild(L[H])}!h.support.leadingWhitespace&&
va.test(E)&&R.insertBefore(l.createTextNode(va.exec(E)[0]),R.firstChild);E=R.childNodes}if(E.nodeType)r.push(E);else r=h.merge(r,E)}}if(n)for(D=0;r[D];D++)if(t&&h.nodeName(r[D],"script")&&(!r[D].type||r[D].type.toLowerCase()==="text/javascript"))t.push(r[D].parentNode?r[D].parentNode.removeChild(r[D]):r[D]);else{r[D].nodeType===1&&r.splice.apply(r,[D+1,0].concat(h.makeArray(r[D].getElementsByTagName("script"))));n.appendChild(r[D])}return r},cleanData:function(a){for(var l,n,t=h.cache,r=h.event.special,
D=h.support.deleteExpando,E=0,L;(L=a[E])!=null;E++)if(n=L[h.expando]){l=t[n];if(l.events)for(var H in l.events)r[H]?h.event.remove(L,H):La(L,H,l.handle);if(D)delete L[h.expando];else L.removeAttribute&&L.removeAttribute(h.expando);delete t[n]}}});var kb=/z-?index|font-?weight|opacity|zoom|line-?height/i,Wa=/alpha\([^)]*\)/,Xa=/opacity=([^)]*)/,Ca=/float/i,Da=/-([a-z])/ig,lb=/([A-Z])/g,mb=/^-?\d+(?:px)?$/i,nb=/^-?\d/,ob={position:"absolute",visibility:"hidden",display:"block"},pb=["Left","Right"],
qb=["Top","Bottom"],rb=o.defaultView&&o.defaultView.getComputedStyle,Ya=h.support.cssFloat?"cssFloat":"styleFloat",Ea=function(a,l){return l.toUpperCase()};h.fn.css=function(a,l){return f(this,a,l,true,function(n,t,r){if(r===undefined)return h.curCSS(n,t);if(typeof r==="number"&&!kb.test(t))r+="px";h.style(n,t,r)})};h.extend({style:function(a,l,n){if(!(!a||a.nodeType===3||a.nodeType===8)){if((l==="width"||l==="height")&&parseFloat(n)<0)n=undefined;var t=a.style||a,r=n!==undefined;if(!h.support.opacity&&
l==="opacity"){if(r){t.zoom=1;l=parseInt(n,10)+""==="NaN"?"":"alpha(opacity="+n*100+")";a=t.filter||h.curCSS(a,"filter")||"";t.filter=Wa.test(a)?a.replace(Wa,l):l}return t.filter&&t.filter.indexOf("opacity=")>=0?parseFloat(Xa.exec(t.filter)[1])/100+"":""}if(Ca.test(l))l=Ya;l=l.replace(Da,Ea);if(r)t[l]=n;return t[l]}},css:function(a,l,n,t){if(l==="width"||l==="height"){var r,D=l==="width"?pb:qb;n=function(){r=l==="width"?a.offsetWidth:a.offsetHeight;t!=="border"&&h.each(D,function(){t||(r-=parseFloat(h.curCSS(a,
"padding"+this,true))||0);if(t==="margin")r+=parseFloat(h.curCSS(a,"margin"+this,true))||0;else r-=parseFloat(h.curCSS(a,"border"+this+"Width",true))||0})};a.offsetWidth!==0?n():h.swap(a,ob,n);return Math.max(0,Math.round(r))}return h.curCSS(a,l,n)},curCSS:function(a,l,n){var t,r=a.style;if(!h.support.opacity&&l==="opacity"&&a.currentStyle){t=Xa.test(a.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return t===""?"1":t}if(Ca.test(l))l=Ya;if(!n&&r&&r[l])t=r[l];else if(rb){if(Ca.test(l))l=
"float";l=l.replace(lb,"-$1").toLowerCase();r=a.ownerDocument.defaultView;if(!r)return null;if(a=r.getComputedStyle(a,null))t=a.getPropertyValue(l);if(l==="opacity"&&t==="")t="1"}else if(a.currentStyle){n=l.replace(Da,Ea);t=a.currentStyle[l]||a.currentStyle[n];if(!mb.test(t)&&nb.test(t)){l=r.left;var D=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;r.left=n==="fontSize"?"1em":t||0;t=r.pixelLeft+"px";r.left=l;a.runtimeStyle.left=D}}return t},swap:function(a,l,n){var t={};for(var r in l){t[r]=
a.style[r];a.style[r]=l[r]}n.call(a);for(r in l)a.style[r]=t[r]}});if(h.expr&&h.expr.filters){h.expr.filters.hidden=function(a){var l=a.offsetWidth,n=a.offsetHeight,t=a.nodeName.toLowerCase()==="tr";return l===0&&n===0&&!t?true:l>0&&n>0&&!t?false:h.curCSS(a,"display")==="none"};h.expr.filters.visible=function(a){return!h.expr.filters.hidden(a)}}var sb=e(),tb=/<script(.|\s)*?\/script>/gi,ub=/select|textarea/i,vb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,
ra=/=\?(&|$)/,Fa=/\?/,wb=/(\?|&)_=.*?(&|$)/,xb=/^(\w+:)?\/\/([^\/?#]+)/,yb=/%20/g,zb=h.fn.load;h.fn.extend({load:function(a,l,n){if(typeof a!=="string")return zb.call(this,a);else if(!this.length)return this;var t=a.indexOf(" ");if(t>=0){var r=a.slice(t,a.length);a=a.slice(0,t)}t="GET";if(l)if(h.isFunction(l)){n=l;l=null}else if(typeof l==="object"){l=h.param(l,h.ajaxSettings.traditional);t="POST"}var D=this;h.ajax({url:a,type:t,dataType:"html",data:l,complete:function(E,L){if(L==="success"||L===
"notmodified")D.html(r?h("<div />").append(E.responseText.replace(tb,"")).find(r):E.responseText);n&&D.each(n,[E.responseText,L,E])}});return this},serialize:function(){return h.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?h.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ub.test(this.nodeName)||vb.test(this.type))}).map(function(a,l){a=h(this).val();return a==null?null:h.isArray(a)?h.map(a,
function(n){return{name:l.name,value:n}}):{name:l.name,value:a}}).get()}});h.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,l){h.fn[l]=function(n){return this.bind(l,n)}});h.extend({get:function(a,l,n,t){if(h.isFunction(l)){t=t||n;n=l;l=null}return h.ajax({type:"GET",url:a,data:l,success:n,dataType:t})},getScript:function(a,l){return h.get(a,null,l,"script")},getJSON:function(a,l,n){return h.get(a,l,n,"json")},post:function(a,l,n,t){if(h.isFunction(l)){t=
t||n;n=l;l={}}return h.ajax({type:"POST",url:a,data:l,success:n,dataType:t})},ajaxSetup:function(a){h.extend(h.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:window.XMLHttpRequest&&(window.location.protocol!=="file:"||!window.ActiveXObject)?function(){return new window.XMLHttpRequest}:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",
html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(a){function l(){r.success&&r.success.call(H,L,E,Y);r.global&&t("ajaxSuccess",[Y,r])}function n(){r.complete&&r.complete.call(H,Y,E);r.global&&t("ajaxComplete",[Y,r]);r.global&&!--h.active&&h.event.trigger("ajaxStop")}function t(O,N){(r.context?h(r.context):h.event).trigger(O,N)}var r=h.extend(true,{},h.ajaxSettings,a),D,
E,L,H=a&&a.context||r,K=r.type.toUpperCase();if(r.data&&r.processData&&typeof r.data!=="string")r.data=h.param(r.data,r.traditional);if(r.dataType==="jsonp"){if(K==="GET")ra.test(r.url)||(r.url+=(Fa.test(r.url)?"&":"?")+(r.jsonp||"callback")+"=?");else if(!r.data||!ra.test(r.data))r.data=(r.data?r.data+"&":"")+(r.jsonp||"callback")+"=?";r.dataType="json"}if(r.dataType==="json"&&(r.data&&ra.test(r.data)||ra.test(r.url))){D=r.jsonpCallback||"jsonp"+sb++;if(r.data)r.data=(r.data+"").replace(ra,"="+D+
"$1");r.url=r.url.replace(ra,"="+D+"$1");r.dataType="script";window[D]=window[D]||function(O){L=O;l();n();window[D]=undefined;try{delete window[D]}catch(N){}ba&&ba.removeChild(ea)}}if(r.dataType==="script"&&r.cache===null)r.cache=false;if(r.cache===false&&K==="GET"){var R=e(),W=r.url.replace(wb,"$1_="+R+"$2");r.url=W+(W===r.url?(Fa.test(r.url)?"&":"?")+"_="+R:"")}if(r.data&&K==="GET")r.url+=(Fa.test(r.url)?"&":"?")+r.data;r.global&&!h.active++&&h.event.trigger("ajaxStart");R=(R=xb.exec(r.url))&&(R[1]&&
R[1]!==location.protocol||R[2]!==location.host);if(r.dataType==="script"&&K==="GET"&&R){var ba=o.getElementsByTagName("head")[0]||o.documentElement,ea=o.createElement("script");ea.src=r.url;if(r.scriptCharset)ea.charset=r.scriptCharset;if(!D){var da=false;ea.onload=ea.onreadystatechange=function(){if(!da&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){da=true;l();n();ea.onload=ea.onreadystatechange=null;ba&&ea.parentNode&&ba.removeChild(ea)}}}ba.insertBefore(ea,ba.firstChild)}else{var ja=
false,Y=r.xhr();if(Y){r.username?Y.open(K,r.url,r.async,r.username,r.password):Y.open(K,r.url,r.async);try{if(r.data||a&&a.contentType)Y.setRequestHeader("Content-Type",r.contentType);if(r.ifModified){h.lastModified[r.url]&&Y.setRequestHeader("If-Modified-Since",h.lastModified[r.url]);h.etag[r.url]&&Y.setRequestHeader("If-None-Match",h.etag[r.url])}R||Y.setRequestHeader("X-Requested-With","XMLHttpRequest");Y.setRequestHeader("Accept",r.dataType&&r.accepts[r.dataType]?r.accepts[r.dataType]+", */*":
r.accepts._default)}catch(Ba){}if(r.beforeSend&&r.beforeSend.call(H,Y,r)===false){r.global&&!--h.active&&h.event.trigger("ajaxStop");Y.abort();return false}r.global&&t("ajaxSend",[Y,r]);var w=Y.onreadystatechange=function(O){if(!Y||Y.readyState===0||O==="abort"){ja||n();ja=true;if(Y)Y.onreadystatechange=h.noop}else if(!ja&&Y&&(Y.readyState===4||O==="timeout")){ja=true;Y.onreadystatechange=h.noop;E=O==="timeout"?"timeout":!h.httpSuccess(Y)?"error":r.ifModified&&h.httpNotModified(Y,r.url)?"notmodified":
"success";var N;if(E==="success")try{L=h.httpData(Y,r.dataType,r)}catch(X){E="parsererror";N=X}if(E==="success"||E==="notmodified")D||l();else h.handleError(r,Y,E,N);n();O==="timeout"&&Y.abort();if(r.async)Y=null}};try{var B=Y.abort;Y.abort=function(){Y&&B.call(Y);w("abort")}}catch(I){}r.async&&r.timeout>0&&setTimeout(function(){Y&&!ja&&w("timeout")},r.timeout);try{Y.send(K==="POST"||K==="PUT"||K==="DELETE"?r.data:null)}catch(J){h.handleError(r,Y,null,J);n()}r.async||w();return Y}}},handleError:function(a,
l,n,t){if(a.error)a.error.call(a.context||a,l,n,t);if(a.global)(a.context?h(a.context):h.event).trigger("ajaxError",[l,a,t])},active:0,httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===1223||a.status===0}catch(l){}return false},httpNotModified:function(a,l){var n=a.getResponseHeader("Last-Modified"),t=a.getResponseHeader("Etag");if(n)h.lastModified[l]=n;if(t)h.etag[l]=t;return a.status===304||a.status===0},httpData:function(a,
l,n){var t=a.getResponseHeader("content-type")||"",r=l==="xml"||!l&&t.indexOf("xml")>=0;a=r?a.responseXML:a.responseText;r&&a.documentElement.nodeName==="parsererror"&&h.error("parsererror");if(n&&n.dataFilter)a=n.dataFilter(a,l);if(typeof a==="string")if(l==="json"||!l&&t.indexOf("json")>=0)a=h.parseJSON(a);else if(l==="script"||!l&&t.indexOf("javascript")>=0)h.globalEval(a);return a},param:function(a,l){function n(E,L){if(h.isArray(L))h.each(L,function(H,K){l||/\[\]$/.test(E)?t(E,K):n(E+"["+(typeof K===
"object"||h.isArray(K)?H:"")+"]",K)});else!l&&L!=null&&typeof L==="object"?h.each(L,function(H,K){n(E+"["+H+"]",K)}):t(E,L)}function t(E,L){L=h.isFunction(L)?L():L;r[r.length]=encodeURIComponent(E)+"="+encodeURIComponent(L)}var r=[];if(l===undefined)l=h.ajaxSettings.traditional;if(h.isArray(a)||a.jquery)h.each(a,function(){t(this.name,this.value)});else for(var D in a)n(D,a[D]);return r.join("&").replace(yb,"+")}});var Ga={},Ab=/toggle|show|hide/,Bb=/^([+-]=)?([\d+-.]+)(.*)$/,wa,Ja=[["height","marginTop",
"marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];h.fn.extend({show:function(a,l){if(a||a===0)return this.animate(y("show",3),a,l);else{a=0;for(l=this.length;a<l;a++){var n=h.data(this[a],"olddisplay");this[a].style.display=n||"";if(h.css(this[a],"display")==="none"){n=this[a].nodeName;var t;if(Ga[n])t=Ga[n];else{var r=h("<"+n+" />").appendTo("body");t=r.css("display");if(t==="none")t="block";r.remove();Ga[n]=t}h.data(this[a],
"olddisplay",t)}}a=0;for(l=this.length;a<l;a++)this[a].style.display=h.data(this[a],"olddisplay")||"";return this}},hide:function(a,l){if(a||a===0)return this.animate(y("hide",3),a,l);else{a=0;for(l=this.length;a<l;a++){var n=h.data(this[a],"olddisplay");!n&&n!=="none"&&h.data(this[a],"olddisplay",h.css(this[a],"display"))}a=0;for(l=this.length;a<l;a++)this[a].style.display="none";return this}},_toggle:h.fn.toggle,toggle:function(a,l){var n=typeof a==="boolean";if(h.isFunction(a)&&h.isFunction(l))this._toggle.apply(this,
arguments);else a==null||n?this.each(function(){var t=n?a:h(this).is(":hidden");h(this)[t?"show":"hide"]()}):this.animate(y("toggle",3),a,l);return this},fadeTo:function(a,l,n){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:l},a,n)},animate:function(a,l,n,t){var r=h.speed(l,n,t);if(h.isEmptyObject(a))return this.each(r.complete);return this[r.queue===false?"each":"queue"](function(){var D=h.extend({},r),E,L=this.nodeType===1&&h(this).is(":hidden"),H=this;for(E in a){var K=
E.replace(Da,Ea);if(E!==K){a[K]=a[E];delete a[E];E=K}if(a[E]==="hide"&&L||a[E]==="show"&&!L)return D.complete.call(this);if((E==="height"||E==="width")&&this.style){D.display=h.css(this,"display");D.overflow=this.style.overflow}if(h.isArray(a[E])){(D.specialEasing=D.specialEasing||{})[E]=a[E][1];a[E]=a[E][0]}}if(D.overflow!=null)this.style.overflow="hidden";D.curAnim=h.extend({},a);h.each(a,function(R,W){var ba=new h.fx(H,D,R);if(Ab.test(W))ba[W==="toggle"?L?"show":"hide":W](a);else{var ea=Bb.exec(W),
da=ba.cur(true)||0;if(ea){W=parseFloat(ea[2]);var ja=ea[3]||"px";if(ja!=="px"){H.style[R]=(W||1)+ja;da=(W||1)/ba.cur(true)*da;H.style[R]=da+ja}if(ea[1])W=(ea[1]==="-="?-1:1)*W+da;ba.custom(da,W,ja)}else ba.custom(da,W,"")}});return true})},stop:function(a,l){var n=h.timers;a&&this.queue([]);this.each(function(){for(var t=n.length-1;t>=0;t--)if(n[t].elem===this){l&&n[t](true);n.splice(t,1)}});l||this.dequeue();return this}});h.each({slideDown:y("show",1),slideUp:y("hide",1),slideToggle:y("toggle",
1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(a,l){h.fn[a]=function(n,t){return this.animate(l,n,t)}});h.extend({speed:function(a,l,n){var t=a&&typeof a==="object"?a:{complete:n||!n&&l||h.isFunction(a)&&a,duration:a,easing:n&&l||l&&!h.isFunction(l)&&l};t.duration=h.fx.off?0:typeof t.duration==="number"?t.duration:h.fx.speeds[t.duration]||h.fx.speeds._default;t.old=t.complete;t.complete=function(){t.queue!==false&&h(this).dequeue();h.isFunction(t.old)&&t.old.call(this)};return t},easing:{linear:function(a,
l,n,t){return n+t*a},swing:function(a,l,n,t){return(-Math.cos(a*Math.PI)/2+0.5)*t+n}},timers:[],fx:function(a,l,n){this.options=l;this.elem=a;this.prop=n;if(!l.orig)l.orig={}}});h.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(h.fx.step[this.prop]||h.fx.step._default)(this);if((this.prop==="height"||this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==
null))return this.elem[this.prop];return(a=parseFloat(h.css(this.elem,this.prop,a)))&&a>-10000?a:parseFloat(h.curCSS(this.elem,this.prop))||0},custom:function(a,l,n){function t(D){return r.step(D)}this.startTime=e();this.start=a;this.end=l;this.unit=n||this.unit||"px";this.now=this.start;this.pos=this.state=0;var r=this;t.elem=this.elem;if(t()&&h.timers.push(t)&&!wa)wa=setInterval(h.fx.tick,13)},show:function(){this.options.orig[this.prop]=h.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop===
"width"||this.prop==="height"?1:0,this.cur());h(this.elem).show()},hide:function(){this.options.orig[this.prop]=h.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(a){var l=e(),n=true;if(a||l>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var t in this.options.curAnim)if(this.options.curAnim[t]!==true)n=false;if(n){if(this.options.display!=null){this.elem.style.overflow=
this.options.overflow;a=h.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(h.css(this.elem,"display")==="none")this.elem.style.display="block"}this.options.hide&&h(this.elem).hide();if(this.options.hide||this.options.show)for(var r in this.options.curAnim)h.style(this.elem,r,this.options.orig[r]);this.options.complete.call(this.elem)}return false}else{r=l-this.startTime;this.state=r/this.options.duration;a=this.options.easing||(h.easing.swing?"swing":"linear");this.pos=
h.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||a](this.state,r,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};h.extend(h.fx,{tick:function(){for(var a=h.timers,l=0;l<a.length;l++)a[l]()||a.splice(l--,1);a.length||h.fx.stop()},stop:function(){clearInterval(wa);wa=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){h.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=
null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(h.expr&&h.expr.filters)h.expr.filters.animated=function(a){return h.grep(h.timers,function(l){return a===l.elem}).length};h.fn.offset="getBoundingClientRect"in o.documentElement?function(a){var l=this[0];if(a)return this.each(function(r){h.offset.setOffset(this,a,r)});if(!l||!l.ownerDocument)return null;if(l===l.ownerDocument.body)return h.offset.bodyOffset(l);var n=l.getBoundingClientRect(),
t=l.ownerDocument;l=t.body;t=t.documentElement;return{top:n.top+(self.pageYOffset||h.support.boxModel&&t.scrollTop||l.scrollTop)-(t.clientTop||l.clientTop||0),left:n.left+(self.pageXOffset||h.support.boxModel&&t.scrollLeft||l.scrollLeft)-(t.clientLeft||l.clientLeft||0)}}:function(a){var l=this[0];if(a)return this.each(function(R){h.offset.setOffset(this,a,R)});if(!l||!l.ownerDocument)return null;if(l===l.ownerDocument.body)return h.offset.bodyOffset(l);h.offset.initialize();var n=l.offsetParent,t=
l,r=l.ownerDocument,D,E=r.documentElement,L=r.body;t=(r=r.defaultView)?r.getComputedStyle(l,null):l.currentStyle;for(var H=l.offsetTop,K=l.offsetLeft;(l=l.parentNode)&&l!==L&&l!==E;){if(h.offset.supportsFixedPosition&&t.position==="fixed")break;D=r?r.getComputedStyle(l,null):l.currentStyle;H-=l.scrollTop;K-=l.scrollLeft;if(l===n){H+=l.offsetTop;K+=l.offsetLeft;if(h.offset.doesNotAddBorder&&!(h.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(l.nodeName))){H+=parseFloat(D.borderTopWidth)||
0;K+=parseFloat(D.borderLeftWidth)||0}t=n;n=l.offsetParent}if(h.offset.subtractsBorderForOverflowNotVisible&&D.overflow!=="visible"){H+=parseFloat(D.borderTopWidth)||0;K+=parseFloat(D.borderLeftWidth)||0}t=D}if(t.position==="relative"||t.position==="static"){H+=L.offsetTop;K+=L.offsetLeft}if(h.offset.supportsFixedPosition&&t.position==="fixed"){H+=Math.max(E.scrollTop,L.scrollTop);K+=Math.max(E.scrollLeft,L.scrollLeft)}return{top:H,left:K}};h.offset={initialize:function(){var a=o.body,l=o.createElement("div"),
n,t,r,D=parseFloat(h.curCSS(a,"marginTop",true))||0;h.extend(l.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});l.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";a.insertBefore(l,a.firstChild);
n=l.firstChild;t=n.firstChild;r=n.nextSibling.firstChild.firstChild;this.doesNotAddBorder=t.offsetTop!==5;this.doesAddBorderForTableAndCells=r.offsetTop===5;t.style.position="fixed";t.style.top="20px";this.supportsFixedPosition=t.offsetTop===20||t.offsetTop===15;t.style.position=t.style.top="";n.style.overflow="hidden";n.style.position="relative";this.subtractsBorderForOverflowNotVisible=t.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==D;a.removeChild(l);h.offset.initialize=h.noop},
bodyOffset:function(a){var l=a.offsetTop,n=a.offsetLeft;h.offset.initialize();if(h.offset.doesNotIncludeMarginInBodyOffset){l+=parseFloat(h.curCSS(a,"marginTop",true))||0;n+=parseFloat(h.curCSS(a,"marginLeft",true))||0}return{top:l,left:n}},setOffset:function(a,l,n){if(/static/.test(h.curCSS(a,"position")))a.style.position="relative";var t=h(a),r=t.offset(),D=parseInt(h.curCSS(a,"top",true),10)||0,E=parseInt(h.curCSS(a,"left",true),10)||0;if(h.isFunction(l))l=l.call(a,n,r);n={top:l.top-r.top+D,left:l.left-
r.left+E};"using"in l?l.using.call(a,n):t.css(n)}};h.fn.extend({position:function(){if(!this[0])return null;var a=this[0],l=this.offsetParent(),n=this.offset(),t=/^body|html$/i.test(l[0].nodeName)?{top:0,left:0}:l.offset();n.top-=parseFloat(h.curCSS(a,"marginTop",true))||0;n.left-=parseFloat(h.curCSS(a,"marginLeft",true))||0;t.top+=parseFloat(h.curCSS(l[0],"borderTopWidth",true))||0;t.left+=parseFloat(h.curCSS(l[0],"borderLeftWidth",true))||0;return{top:n.top-t.top,left:n.left-t.left}},offsetParent:function(){return this.map(function(){for(var a=
this.offsetParent||o.body;a&&!/^body|html$/i.test(a.nodeName)&&h.css(a,"position")==="static";)a=a.offsetParent;return a})}});h.each(["Left","Top"],function(a,l){var n="scroll"+l;h.fn[n]=function(t){var r=this[0],D;if(!r)return null;if(t!==undefined)return this.each(function(){if(D=v(this))D.scrollTo(!a?t:h(D).scrollLeft(),a?t:h(D).scrollTop());else this[n]=t});else return(D=v(r))?"pageXOffset"in D?D[a?"pageYOffset":"pageXOffset"]:h.support.boxModel&&D.document.documentElement[n]||D.document.body[n]:
r[n]}});h.each(["Height","Width"],function(a,l){var n=l.toLowerCase();h.fn["inner"+l]=function(){return this[0]?h.css(this[0],n,false,"padding"):null};h.fn["outer"+l]=function(t){return this[0]?h.css(this[0],n,false,t?"margin":"border"):null};h.fn[n]=function(t){var r=this[0];if(!r)return t==null?null:this;if(h.isFunction(t))return this.each(function(D){var E=h(this);E[n](t.call(this,D,E[n]()))});return"scrollTo"in r&&r.document?r.document.compatMode==="CSS1Compat"&&r.document.documentElement["client"+
l]||r.document.body["client"+l]:r.nodeType===9?Math.max(r.documentElement["client"+l],r.body["scroll"+l],r.documentElement["scroll"+l],r.body["offset"+l],r.documentElement["offset"+l]):t===undefined?h.css(r,n):this.css(n,typeof t==="string"?t:t+"px")}});s.$=s.jQuery=h});bespin.tiki.register("::embedded",{name:"embedded",dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"}});bespin.tiki.module("embedded:index",function(){});
bespin.tiki.register("::settings",{name:"settings",dependencies:{types:"0.0.0"}});
bespin.tiki.module("settings:commands",function(x,s){x("bespin:plugins");x("environment");var u=x("settings").settings;s.setCommand=function(q,f){var e;if(q.setting)if(q.value===undefined)e="<strong>"+q.setting+"</strong> = "+u.get(q.setting);else{e="Setting: <strong>"+q.setting+"</strong> = "+q.value;u.set(q.setting,q.value)}else{q=u._list();e="";q.sort(function(d,b){return d.key<b.key?-1:d.key==b.key?0:1});q.forEach(function(d){e+='<a class="setting" href="https://wiki.mozilla.org/Labs/Bespin/Settings#'+
d.key+'" title="View external documentation on setting: '+d.key+'" target="_blank">'+d.key+"</a> = "+d.value+"<br/>"})}f.done(e)};s.unsetCommand=function(q,f){u.resetValue(q.setting);f.done("Reset "+q.setting+" to default: "+u.get(q.setting))}});
bespin.tiki.module("settings:cookie",function(x,s){var u=x("bespin:util/cookie");s.CookiePersister=function(){};s.CookiePersister.prototype={loadInitialValues:function(q){q._loadDefaultValues().then(function(){var f=u.get("settings");q._loadFromObject(JSON.parse(f))}.bind(this))},persistValue:function(q){try{var f={};q._getSettingNames().forEach(function(b){f[b]=q.get(b)});var e=JSON.stringify(f);u.set("settings",e)}catch(d){console.error("Unable to JSONify the settings! "+d)}}}});
bespin.tiki.module("settings:index",function(x,s){var u=x("bespin:plugins").catalog,q=x("bespin:console").console,f=x("bespin:promise").Promise,e=x("bespin:promise").group,d=x("types:types");s.addSetting=function(b){x("settings").settings.addSetting(b)};s.getSettings=function(){return u.getExtensions("setting")};s.getTypeSpecFromAssignment=function(b){var j=b.assignments;b="text";if(j){var i=null;j.forEach(function(g){if(g.param.name==="setting")i=g});if(i)if((j=i.value)&&j!=="")if(j=u.getExtensionByKey("setting",
j))b=j.type}return b};s.MemorySettings=function(){};s.MemorySettings.prototype={_values:{},_deactivated:{},setPersister:function(b){(this._persister=b)&&b.loadInitialValues(this)},get:function(b){return this._values[b]},set:function(b,j){var i=u.getExtensionByKey("setting",b);if(i)if(typeof j=="string"&&i.type=="string")this._values[b]=j;else{var g=false;d.fromString(j,i.type).then(function(k){g=true;this._values[b]=k;u.publish(this,"settingChange",b,k)}.bind(this),function(k){q.error("Error setting",
b,": ",k)});if(!g){q.warn("About to set string version of ",b,"delaying typed set.");this._values[b]=j}}else{q.warn("Setting not defined: ",b,j);this._deactivated[b]=j}this._persistValue(b,j);return this},addSetting:function(b){if(b.name){!b.defaultValue===undefined&&q.error("Setting.defaultValue == undefined",b);d.isValid(b.defaultValue,b.type).then(function(j){j||q.warn("!Setting.isValid(Setting.defaultValue)",b);this.set(b.name,this._deactivated[b.name]||b.defaultValue)}.bind(this),function(j){q.error("Type error ",
j," ignoring setting ",b)})}else q.error("Setting.name == undefined. Ignoring.",b)},resetValue:function(b){var j=u.getExtensionByKey("setting",b);j?this.set(b,j.defaultValue):q.log("ignore resetValue on ",b)},resetAll:function(){this._getSettingNames().forEach(function(b){this.resetValue(b)}.bind(this))},_getSettingNames:function(){var b=[];u.getExtensions("setting").forEach(function(j){b.push(j.name)});return b},_list:function(){var b=[];this._getSettingNames().forEach(function(j){b.push({key:j,
value:this.get(j)})}.bind(this));return b},_persistValue:function(b,j){var i=this._persister;i&&i.persistValue(this,b,j)},_loadInitialValues:function(){var b=this._persister;b?b.loadInitialValues(this):this._loadDefaultValues()},_loadDefaultValues:function(){return this._loadFromObject(this._defaultValues())},_loadFromObject:function(b){var j=[],i=function(y){return function(v){this.set(y,v)}};for(var g in b)if(b.hasOwnProperty(g)){var k=b[g],m=u.getExtensionByKey("setting",g);if(m){k=d.fromString(k,
m.type);m=i(g);k.then(m);j.push(k)}}var p=new f;e(j).then(function(){p.resolve()});return p},_saveToObject:function(){var b=[],j={};this._getSettingNames().forEach(function(g){var k=this.get(g),m=u.getExtensionByKey("setting",g);if(m){k=d.toString(k,m.type);k.then(function(p){j[g]=p});b.push(k)}}.bind(this));var i=new f;e(b).then(function(){i.resolve(j)});return i},_defaultValues:function(){var b={};u.getExtensions("setting").forEach(function(j){b[j.name]=j.defaultValue});return b}};s.settings=new s.MemorySettings});
bespin.tiki.register("::appconfig",{name:"appconfig",dependencies:{jquery:"0.0.0",canon:"0.0.0",settings:"0.0.0"}});
bespin.tiki.module("appconfig:index",function(x,s){var u=x("jquery").$,q=x("settings").settings,f=x("bespin:promise").group,e=x("bespin:promise").Promise,d=x("bespin:console").console,b=x("bespin:util/stacktrace").Trace,j=x("bespin:util/util"),i=true;s.launch=function(m){var p=new e;u("#_bespin_loading").remove();var y;if(i){y=bespin.tiki.require;i=false}else y=(new (bespin.tiki.require("bespin:sandbox").Sandbox)).createRequire({id:"index",ownerPackage:bespin.tiki.loader.anonymousPackage});var v=
y("bespin:plugins").catalog;m=m||{};s.normalizeConfig(v,m);var h=m.objects;for(var A in h)v.registerObject(A,h[A]);for(var F in m.settings)q.set(F,m.settings[F]);var o=function(){var C=y("environment").env,G=C.editor;if(G){m.lineNumber&&G.setLineNumber(m.lineNumber);if(m.stealFocus)G.focus=true;if(m.readOnly)G.readOnly=m.readOnly;if(m.syntax)G.syntax=m.syntax}if(G=v.getObject("commandLine"))C.commandLine=G;v.publish(this,"appLaunched");p.resolve(C)}.bind(this),z=new e;z.then(function(){h.loginController?
v.createObject("loginController").then(function(C){C.showLogin().then(function(G){m.objects.session.arguments.push(G);s.launchEditor(v,m).then(o,p.reject.bind(p))})}):s.launchEditor(v,m).then(o,p.reject.bind(p))},function(C){p.reject(C)});v.plugins.theme_manager?bespin.tiki.require.ensurePackage("::theme_manager",function(){var C=y("theme_manager");m.theme.basePlugin&&C.setBasePlugin(m.theme.basePlugin);m.theme.standard&&C.setStandardTheme(m.theme.standard);C.startParsing().then(function(){z.resolve()},
function(G){z.reject(G)})}):z.resolve();return p};s.normalizeConfig=function(m,p){if(p.objects===undefined)p.objects={};if(p.autoload===undefined)p.autoload=[];if(p.theme===undefined)p.theme={};if(!p.theme.basePlugin&&m.plugins.screen_theme)p.theme.basePlugin="screen_theme";if(!p.initialContent)p.initialContent="";if(!p.settings)p.settings={};if(!p.objects.notifier&&m.plugins.notifier)p.objects.notifier={};if(!p.objects.loginController&&m.plugins.userident)p.objects.loginController={};if(!p.objects.fileHistory&&
m.plugins.file_history)p.objects.fileHistory={factory:"file_history",arguments:["session"],objects:{"0":"session"}};if(!p.objects.server&&m.plugins.bespin_server){p.objects.server={factory:"bespin_server"};p.objects.filesource={factory:"bespin_filesource",arguments:["server"],objects:{"0":"server"}}}if(!p.objects.files&&m.plugins.filesystem&&p.objects.filesource)p.objects.files={arguments:["filesource"],objects:{"0":"filesource"}};if(!p.objects.editor)p.objects.editor={factory:"text_editor",arguments:[p.initialContent]};
if(!p.objects.session)p.objects.session={arguments:["editor"],objects:{"0":"editor"}};if(!p.objects.commandLine&&m.plugins.command_line)p.objects.commandLine={};if(p.gui===undefined)p.gui={};m={};for(var y in p.gui){var v=p.gui[y];if(v.component)m[v.component]=true}if(!p.gui.center&&p.objects.editor&&!m.editor)p.gui.center={component:"editor"};if(!p.gui.south&&p.objects.commandLine&&!m.commandLine)p.gui.south={component:"commandLine"}};s.launchEditor=function(m,p){var y=new e;if(p===null){d.error("Cannot start editor without a configuration!");
y.reject("Cannot start editor without a configuration!");return y}g(m,p).then(function(){k(m,p,y)},function(v){d.error("Error while creating objects");(new b(v)).log();y.reject(v)});return y};var g=function(m,p){var y=[];for(var v in p.objects)y.push(m.createObject(v));return f(y)},k=function(m,p,y){var v=document.createElement("div");v.setAttribute("class","container");var h=document.createElement("div");h.setAttribute("class","center-container");v.appendChild(h);var A=p.element||document.body;j.addClass(A,
"bespin");A.appendChild(v);for(var F in p.gui){var o=p.gui[F],z=m.getObject(o.component);if(!z){m="Cannot find object "+o.component+" to attach to the Bespin UI";d.error(m);y.reject(m);return}A=z.element;if(!A){m="Component "+o.component+' does not have an "element" attribute to attach to the Bespin UI';d.error(m);y.reject(m);return}u(A).addClass(F);F=="west"||F=="east"||F=="center"?h.appendChild(A):v.appendChild(A);z.elementAppended&&z.elementAppended()}y.resolve()}});
bespin.tiki.register("::events",{name:"events",dependencies:{traits:"0.0.0"}});bespin.tiki.module("events:index",function(x,s){s.Event=function(){var u=[],q=function(){var f=arguments;u.forEach(function(e){e.func.apply(null,f)})};q.add=function(){arguments.length==1?u.push({ref:arguments[0],func:arguments[0]}):u.push({ref:arguments[0],func:arguments[1]})};q.remove=function(f){u=u.filter(function(e){return f!==e.ref})};q.removeAll=function(){u=[]};return q}});
bespin.tiki.register("::screen_theme",{name:"screen_theme",dependencies:{theme_manager:"0.0.0"}});bespin.tiki.module("screen_theme:index",function(){});
(function(){var x=bespin.tiki.require("jquery").$;x(document).ready(function(){bespin.tiki.require("bespin:plugins").catalog.registerMetadata({text_editor:{resourceURL:"resources/text_editor/",description:"Canvas-based text editor component and many common editing commands",dependencies:{completion:"0.0.0",undomanager:"0.0.0",settings:"0.0.0",canon:"0.0.0",rangeutils:"0.0.0",traits:"0.0.0",theme_manager:"0.0.0",keyboard:"0.0.0",edit_session:"0.0.0",syntax_manager:"0.0.0"},testmodules:["tests/controllers/testLayoutmanager",
"tests/models/testTextstorage","tests/testScratchcanvas","tests/utils/testRect"],provides:[{action:"new",pointer:"views/editor#EditorView",ep:"factory",name:"text_editor"},{pointer:"views/editor#EditorView",ep:"appcomponent",name:"editor_view"},{predicates:{isTextView:true},pointer:"commands/editing#backspace",ep:"command",key:"backspace",name:"backspace"},{predicates:{isTextView:true},pointer:"commands/editing#deleteCommand",ep:"command",key:"delete",name:"delete"},{description:"Delete all lines currently selected",
key:"ctrl_d",predicates:{isTextView:true},pointer:"commands/editing#deleteLines",ep:"command",name:"deletelines"},{description:"Create a new, empty line below the current one",key:"ctrl_return",predicates:{isTextView:true},pointer:"commands/editing#openLine",ep:"command",name:"openline"},{description:"Join the current line with the following",key:"ctrl_shift_j",predicates:{isTextView:true},pointer:"commands/editing#joinLines",ep:"command",name:"joinline"},{params:[{defaultValue:"",type:"text",name:"text",
description:"The text to insert"}],pointer:"commands/editing#insertText",ep:"command",name:"insertText"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#newline",ep:"command",key:"return",name:"newline"},{predicates:{completing:false,isTextView:true},pointer:"commands/editing#tab",ep:"command",key:"tab",name:"tab"},{predicates:{isTextView:true},pointer:"commands/editing#untab",ep:"command",key:"shift_tab",name:"untab"},{predicates:{isTextView:true},ep:"command",name:"move"},
{description:"Repeat the last search (forward)",pointer:"commands/editor#findNextCommand",ep:"command",key:"ctrl_g",name:"findnext"},{description:"Repeat the last search (backward)",pointer:"commands/editor#findPrevCommand",ep:"command",key:"ctrl_shift_g",name:"findprev"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveDown",ep:"command",key:"down",name:"move down"},{predicates:{isTextView:true},pointer:"commands/movement#moveLeft",ep:"command",key:"left",name:"move left"},
{predicates:{isTextView:true},pointer:"commands/movement#moveRight",ep:"command",key:"right",name:"move right"},{predicates:{completing:false,isTextView:true},pointer:"commands/movement#moveUp",ep:"command",key:"up",name:"move up"},{predicates:{isTextView:true},ep:"command",name:"select"},{predicates:{isTextView:true},pointer:"commands/movement#selectDown",ep:"command",key:"shift_down",name:"select down"},{predicates:{isTextView:true},pointer:"commands/movement#selectLeft",ep:"command",key:"shift_left",
name:"select left"},{predicates:{isTextView:true},pointer:"commands/movement#selectRight",ep:"command",key:"shift_right",name:"select right"},{predicates:{isTextView:true},pointer:"commands/movement#selectUp",ep:"command",key:"shift_up",name:"select up"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineEnd",ep:"command",key:["end","ctrl_right"],name:"move lineend"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineEnd",ep:"command",key:["shift_end","ctrl_shift_right"],
name:"select lineend"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocEnd",ep:"command",key:"ctrl_down",name:"move docend"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocEnd",ep:"command",key:"ctrl_shift_down",name:"select docend"},{predicates:{isTextView:true},pointer:"commands/movement#moveLineStart",ep:"command",key:["home","ctrl_left"],name:"move linestart"},{predicates:{isTextView:true},pointer:"commands/movement#selectLineStart",ep:"command",key:["shift_home",
"ctrl_shift_left"],name:"select linestart"},{predicates:{isTextView:true},pointer:"commands/movement#moveDocStart",ep:"command",key:"ctrl_up",name:"move docstart"},{predicates:{isTextView:true},pointer:"commands/movement#selectDocStart",ep:"command",key:"ctrl_shift_up",name:"select docstart"},{predicates:{isTextView:true},pointer:"commands/movement#moveNextWord",ep:"command",key:["alt_right"],name:"move nextword"},{predicates:{isTextView:true},pointer:"commands/movement#selectNextWord",ep:"command",
key:["alt_shift_right"],name:"select nextword"},{predicates:{isTextView:true},pointer:"commands/movement#movePreviousWord",ep:"command",key:["alt_left"],name:"move prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectPreviousWord",ep:"command",key:["alt_shift_left"],name:"select prevword"},{predicates:{isTextView:true},pointer:"commands/movement#selectAll",ep:"command",key:["ctrl_a","meta_a"],name:"select all"},{predicates:{isTextView:true},ep:"command",name:"scroll"},{predicates:{isTextView:true},
pointer:"commands/scrolling#scrollDocStart",ep:"command",key:"ctrl_home",name:"scroll start"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollDocEnd",ep:"command",key:"ctrl_end",name:"scroll end"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageDown",ep:"command",key:"pagedown",name:"scroll down"},{predicates:{isTextView:true},pointer:"commands/scrolling#scrollPageUp",ep:"command",key:"pageup",name:"scroll up"},{pointer:"commands/editor#lcCommand",description:"Change all selected text to lowercase",
withKey:"CMD SHIFT L",ep:"command",name:"lc"},{pointer:"commands/editor#detabCommand",description:"Convert tabs to spaces.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"detab"},{pointer:"commands/editor#entabCommand",description:"Convert spaces to tabs.",params:[{defaultValue:null,type:"text",name:"tabsize",description:"Optionally, specify a tab size. (Defaults to setting.)"}],ep:"command",name:"entab"},
{pointer:"commands/editor#trimCommand",description:"trim trailing or leading whitespace from each line in selection",params:[{defaultValue:"both",type:{data:[{name:"left"},{name:"right"},{name:"both"}],name:"selection"},name:"side",description:"Do we trim from the left, right or both"}],ep:"command",name:"trim"},{pointer:"commands/editor#ucCommand",description:"Change all selected text to uppercase",withKey:"CMD SHIFT U",ep:"command",name:"uc"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",
ep:"command",key:["ctrl_shift_z"],name:"redo"},{predicates:{isTextView:true},pointer:"controllers/undo#undoManagerCommand",ep:"command",key:["ctrl_z"],name:"undo"},{description:"The distance in characters between each tab",defaultValue:8,type:"number",ep:"setting",name:"tabstop"},{description:"Customize the keymapping",defaultValue:"{}",type:"text",ep:"setting",name:"customKeymapping"},{description:"The keymapping to use",defaultValue:"standard",type:"text",ep:"setting",name:"keymapping"},{description:"The editor font size in pixels",
defaultValue:14,type:"number",ep:"setting",name:"fontsize"},{description:"The editor font face",defaultValue:"Monaco, Lucida Console, monospace",type:"text",ep:"setting",name:"fontface"},{defaultValue:{color:"#e5c138",paddingLeft:5,backgroundColor:"#4c4a41",paddingRight:10},ep:"themevariable",name:"gutter"},{defaultValue:{color:"#e6e6e6",selectedTextBackgroundColor:"#526da5",backgroundColor:"#2a211c",cursorColor:"#879aff",unfocusedCursorBackgroundColor:"#73171e",unfocusedCursorColor:"#ff0033"},ep:"themevariable",
name:"editor"},{defaultValue:{comment:"#666666",directive:"#999999",keyword:"#42A8ED",plain:"#e6e6e6",error:"#ff0000",operator:"#88BBFF",identifier:"#D841FF",string:"#039A0A"},ep:"themevariable",name:"highlighter"},{defaultValue:{nibStrokeStyle:"rgb(150, 150, 150)",fullAlpha:1,barFillStyle:"rgb(0, 0, 0)",particalAlpha:0.3,barFillGradientBottomStop:"rgb(44, 44, 44)",backgroundStyle:"#2A211C",thickness:17,padding:5,trackStrokeStyle:"rgb(150, 150, 150)",nibArrowStyle:"rgb(255, 255, 255)",barFillGradientBottomStart:"rgb(22, 22, 22)",
barFillGradientTopStop:"rgb(40, 40, 40)",barFillGradientTopStart:"rgb(90, 90, 90)",nibStyle:"rgb(100, 100, 100)",trackFillStyle:"rgba(50, 50, 50, 0.8)"},ep:"themevariable",name:"scroller"},{description:"Event: Notify when something within the editor changed.",params:[{required:true,name:"pointer",description:"Function that is called whenever a change happened."}],ep:"extensionpoint",name:"editorChange"}],type:"plugins/supported",name:"text_editor"},less:{resourceURL:"resources/less/",description:"Leaner CSS",
contributors:[],author:"Alexis Sellier <self@cloudhead.net>",url:"http://lesscss.org",version:"1.0.11",dependencies:{},testmodules:[],provides:[],keywords:["css","parser","lesscss","browser"],type:"plugins/thirdparty",name:"less"},theme_manager_base:{resourceURL:"resources/theme_manager_base/",name:"theme_manager_base",share:true,environments:{main:true},dependencies:{},testmodules:[],provides:[{description:"(Less)files holding the CSS style information for the UI.",params:[{required:true,name:"url",
description:"Name of the ThemeStylesFile - can also be an array of files."}],ep:"extensionpoint",name:"themestyles"},{description:"Event: Notify when the theme(styles) changed.",params:[{required:true,name:"pointer",description:"Function that is called whenever the theme is changed."}],ep:"extensionpoint",name:"themeChange"},{indexOn:"name",description:"A theme is a way change the look of the application.",params:[{required:false,name:"url",description:"Name of a ThemeStylesFile that holds theme specific CSS rules - can also be an array of files."},
{required:true,name:"pointer",description:"Function that returns the ThemeData"}],ep:"extensionpoint",name:"theme"}],type:"plugins/supported",description:"Defines extension points required for theming"},canon:{resourceURL:"resources/canon/",name:"canon",environments:{main:true,worker:false},dependencies:{environment:"0.0.0",events:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{indexOn:"name",description:"A command is a bit of functionality with optional typed arguments which can do something small like moving the cursor around the screen, or large like cloning a project from VCS.",
ep:"extensionpoint",name:"command"},{description:"An extension point to be called whenever a new command begins output.",ep:"extensionpoint",name:"addedRequestOutput"},{description:"A dimensionsChanged is a way to be notified of changes to the dimension of Bespin",ep:"extensionpoint",name:"dimensionsChanged"},{description:"How many typed commands do we recall for reference?",defaultValue:50,type:"number",ep:"setting",name:"historyLength"},{action:"create",pointer:"history#InMemoryHistory",ep:"factory",
name:"history"}],type:"plugins/supported",description:"Manages commands"},traits:{resourceURL:"resources/traits/",description:"Traits library, traitsjs.org",dependencies:{},testmodules:[],provides:[],type:"plugins/thirdparty",name:"traits"},keyboard:{resourceURL:"resources/keyboard/",description:"Keyboard shortcuts",dependencies:{canon:"0.0",settings:"0.0"},testmodules:["tests/testKeyboard"],provides:[{description:"A keymapping defines how keystrokes are interpreted.",params:[{required:true,name:"states",
description:"Holds the states and all the informations about the keymapping. See docs: pluginguide/keymapping"}],ep:"extensionpoint",name:"keymapping"}],type:"plugins/supported",name:"keyboard"},worker_manager:{resourceURL:"resources/worker_manager/",description:"Manages a web worker on the browser side",dependencies:{canon:"0.0.0",events:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{description:"Low-level web worker control (for plugin development)",ep:"command",name:"worker"},{description:"Restarts all web workers (for plugin development)",
pointer:"#workerRestartCommand",ep:"command",name:"worker restart"}],type:"plugins/supported",name:"worker_manager"},diff:{testmodules:[],type:"plugins/thirdparty",resourceURL:"resources/diff/",description:"Diff/Match/Patch module (support code, no UI)",name:"diff"},edit_session:{resourceURL:"resources/edit_session/",description:"Ties together the files being edited with the views on screen",dependencies:{events:"0.0.0"},testmodules:["tests/testSession"],provides:[{action:"call",pointer:"#createSession",
ep:"factory",name:"session"}],type:"plugins/supported",name:"edit_session"},syntax_manager:{resourceURL:"resources/syntax_manager/",name:"syntax_manager",environments:{main:true,worker:false},dependencies:{worker_manager:"0.0.0",events:"0.0.0",underscore:"0.0.0",syntax_directory:"0.0.0"},testmodules:[],provides:[],type:"plugins/supported",description:"Provides syntax highlighting services for the editor"},completion:{resourceURL:"resources/completion/",description:"Code completion support",dependencies:{jquery:"0.0.0",
ctags:"0.0.0",rangeutils:"0.0.0",canon:"0.0.0",underscore:"0.0.0"},testmodules:[],provides:[{indexOn:"name",description:"Code completion support for specific languages",ep:"extensionpoint",name:"completion"},{description:"Accept the chosen completion",key:["return","tab"],predicates:{completing:true},pointer:"controller#completeCommand",ep:"command",name:"complete"},{description:"Abandon the completion",key:"escape",predicates:{completing:true},pointer:"controller#completeCancelCommand",ep:"command",
name:"complete cancel"},{description:"Choose the completion below",key:"down",predicates:{completing:true},pointer:"controller#completeDownCommand",ep:"command",name:"complete down"},{description:"Choose the completion above",key:"up",predicates:{completing:true},pointer:"controller#completeUpCommand",ep:"command",name:"complete up"}],type:"plugins/supported",name:"completion"},environment:{testmodules:[],dependencies:{settings:"0.0.0"},resourceURL:"resources/environment/",name:"environment",type:"plugins/supported"},
undomanager:{resourceURL:"resources/undomanager/",description:"Manages undoable events",testmodules:["tests/testUndomanager"],provides:[{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_shift_z"],name:"redo"},{pointer:"#undoManagerCommand",ep:"command",key:["ctrl_z"],name:"undo"}],type:"plugins/supported",name:"undomanager"},command_line:{resourceURL:"resources/command_line/",description:"Provides the command line user interface",dependencies:{templater:"0.0.0",settings:"0.0.0",matcher:"0.0.0",
theme_manager_base:"0.0.0",canon:"0.0.0",keyboard:"0.0.0",diff:"0.0.0",types:"0.0.0"},testmodules:["tests/testInput"],provides:[{url:["article.less","cli.less","menu.less","requestOutput.less","global.less"],ep:"themestyles"},{defaultValue:"@global_container_background",ep:"themevariable",name:"bg"},{defaultValue:"@global_container_background + #090807",ep:"themevariable",name:"input_bg_light"},{defaultValue:"@global_container_background - #030303",ep:"themevariable",name:"input_bg"},{defaultValue:"@global_container_background - #050506",
ep:"themevariable",name:"input_bg2"},{defaultValue:"@global_menu_inset_color_top_left",ep:"themevariable",name:"border_fg"},{defaultValue:"@global_menu_inset_color_right",ep:"themevariable",name:"border_fg2"},{defaultValue:"@global_menu_background",ep:"themevariable",name:"menu_bg"},{defaultValue:"@global_menu_border_color",ep:"themevariable",name:"border_bg"},{defaultValue:"@global_color",ep:"themevariable",name:"text"},{defaultValue:"@global_header_color",ep:"themevariable",name:"hi_text"},{defaultValue:"@global_hint_color",
ep:"themevariable",name:"lo_text"},{defaultValue:"@global_hint_color",ep:"themevariable",name:"lo_text2"},{defaultValue:"@global_link_color",ep:"themevariable",name:"link_text"},{defaultValue:"@global_error_color",ep:"themevariable",name:"error_text"},{defaultValue:"@global_selectable_hover_background",ep:"themevariable",name:"theme_text"},{comment:"#FFCE00",defaultValue:"rgb(255,206,0)",ep:"themevariable",name:"theme_text_light"},{defaultValue:"@global_selectable_hover_background - #222000",ep:"themevariable",
name:"theme_text_dark"},{defaultValue:"@global_accelerator_color",ep:"themevariable",name:"theme_text_dark2"},{comment:"#0E0906",defaultValue:"rgb(14,9,6)",ep:"themevariable",name:"input_submenu"},{defaultValue:"@global_font",ep:"themevariable",name:"fonts"},{defaultValue:"@global_selectable_hover_color",ep:"themevariable",name:"li_hover_color"},{defaultValue:"@global_hint_hover_color",ep:"themevariable",name:"li_hint_hover_color"},{defaultValue:"@global_accelerator_hover_color",ep:"themevariable",
name:"li_accelerator_hover_color"},{action:"new",pointer:"views/cli#CliInputView",ep:"factory",name:"commandLine"},{pointer:"views/cli#CliInputView",ep:"appcomponent",name:"command_line"},{description:"Display number|date|none next to each historical instruction",defaultValue:"none",type:{data:["number","date","none"],name:"selection"},ep:"setting",name:"historyTimeMode"},{description:"The maximum size (in pixels) for the command line output area",defaultValue:0,type:"number",ep:"setting",name:"minConsoleHeight"},
{description:"The minimum size (in pixels) for the command line output area",defaultValue:300,type:"number",ep:"setting",name:"maxConsoleHeight"},{predicates:{isKeyUp:false,isCommandLine:true},pointer:"commands/simple#completeCommand",ep:"command",key:"tab",name:"complete"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_1",name:"menu1"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_2",
name:"menu2"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_1",name:"menu1"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_3",name:"menu3"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_4",name:"menu4"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_5",name:"menu5"},
{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_6",name:"menu6"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_7",name:"menu7"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_8",name:"menu8"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_9",name:"menu9"},{predicates:{isKeyUp:true,
isCommandLine:true},pointer:"views/menu#activateItemAction",ep:"command",key:"alt_0",name:"menu0"},{pointer:"commands/simple#helpCommand",description:"Get help on the available commands.",params:[{defaultValue:null,type:"text",name:"search",description:"Search string to narrow the output."}],ep:"command",name:"help"},{pointer:"commands/simple#aliasCommand",description:"define and show aliases for commands",params:[{defaultValue:null,type:"text",name:"alias",description:"optionally, your alias name"},
{defaultValue:null,type:"text",name:"command",description:"optionally, the command name"}],ep:"command",name:"alias"},{description:"evals given js code and show the result",params:[{type:"text",name:"javascript",description:"The JavaScript to evaluate"}],hidden:true,pointer:"commands/basic#evalCommand",ep:"command",name:"eval"},{description:"show the Bespin version",hidden:true,pointer:"commands/basic#versionCommand",ep:"command",name:"version"},{description:"has",hidden:true,pointer:"commands/basic#bespinCommand",
ep:"command",name:"bespin"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"commands/history#historyPreviousCommand",ep:"command",key:"up",name:"historyPrevious"},{predicates:{isKeyUp:true,isCommandLine:true},pointer:"commands/history#historyNextCommand",ep:"command",key:"down",name:"historyNext"},{params:[],description:"Show history of the commands",pointer:"commands/history#historyCommand",ep:"command",name:"history"},{pointer:"commands/history#addedRequestOutput",ep:"addedRequestOutput"},
{indexOn:"name",description:"A function to allow the command line to show a hint to the user on how they should finish what they're typing",ep:"extensionpoint",name:"typehint"},{description:"A UI for string that is constrained to be one of a number of pre-defined values",pointer:"views/basic#selection",ep:"typehint",name:"selection"},{description:"A UI for a boolean",pointer:"views/basic#bool",ep:"typehint",name:"boolean"}],type:"plugins/supported",name:"command_line"},rangeutils:{testmodules:["tests/test"],
type:"plugins/supported",resourceURL:"resources/rangeutils/",description:"Utility functions for dealing with ranges of text",name:"rangeutils"},js_syntax:{resourceURL:"resources/js_syntax/",name:"js_syntax",environments:{worker:true},dependencies:{standard_syntax:"0.0.0"},testmodules:[],provides:[{pointer:"#JSSyntax",ep:"syntax",fileexts:["js","json"],name:"js"}],type:"plugins/supported",description:"JavaScript syntax highlighter"},ctags:{resourceURL:"resources/ctags/",description:"Reads and writes tag files",
dependencies:{traits:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"ctags"},events:{resourceURL:"resources/events/",description:"Dead simple event implementation",dependencies:{traits:"0.0"},testmodules:["tests/test"],provides:[],type:"plugins/supported",name:"events"},templater:{testmodules:[],resourceURL:"resources/templater/",name:"templater",type:"plugins/supported"},matcher:{resourceURL:"resources/matcher/",description:"Provides various routines to match items in a list",
dependencies:{},testmodules:["tests/testIndex","tests/testPrefix","tests/testQuick"],type:"plugins/supported",name:"matcher"},theme_manager:{resourceURL:"resources/theme_manager/",name:"theme_manager",share:true,environments:{main:true,worker:false},dependencies:{theme_manager_base:"0.0.0",settings:"0.0.0",events:"0.0.0",less:"0.0.0"},testmodules:[],provides:[{unregister:"themestyles#unregisterThemeStyles",register:"themestyles#registerThemeStyles",ep:"extensionhandler",name:"themestyles"},{unregister:"index#unregisterTheme",
register:"index#registerTheme",ep:"extensionhandler",name:"theme"},{defaultValue:"standard",description:"The theme plugin's name to use. If set to 'standard' no theme will be used",type:"text",ep:"setting",name:"theme"},{pointer:"#appLaunched",ep:"appLaunched"}],type:"plugins/supported",description:"Handles colors in Bespin"},whitetheme:{resourceURL:"resources/whitetheme/",description:"Provides a white theme for Bespin",dependencies:{theme_manager:"0.0.0"},testmodules:[],provides:[{url:["theme.less"],
description:"A basic white theme",pointer:"index#whiteTheme",ep:"theme",name:"white"}],type:"plugins/supported",name:"whitetheme"},standard_syntax:{resourceURL:"resources/standard_syntax/",description:"Easy-to-use basis for syntax engines",environments:{worker:true},dependencies:{syntax_worker:"0.0.0",syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"standard_syntax"},types:{resourceURL:"resources/types/",description:"Defines parameter types for commands",
testmodules:["tests/testBasic","tests/testTypes"],provides:[{indexOn:"name",description:"Commands can accept various arguments that the user enters or that are automatically supplied by the environment. Those arguments have types that define how they are supplied or completed. The pointer points to an object with methods convert(str value) and getDefault(). Both functions have `this` set to the command's `takes` parameter. If getDefault is not defined, the default on the command's `takes` is used, if there is one. The object can have a noInput property that is set to true to reflect that this type is provided directly by the system. getDefault must be defined in that case.",
ep:"extensionpoint",name:"type"},{description:"Text that the user needs to enter.",pointer:"basic#text",ep:"type",name:"text"},{description:"A JavaScript number",pointer:"basic#number",ep:"type",name:"number"},{description:"A true/false value",pointer:"basic#bool",ep:"type",name:"boolean"},{description:"An object that converts via JavaScript",pointer:"basic#object",ep:"type",name:"object"},{description:"A string that is constrained to be one of a number of pre-defined values",pointer:"basic#selection",
ep:"type",name:"selection"},{description:"A type which we don't understand from the outset, but which we hope context can help us with",ep:"type",name:"deferred"}],type:"plugins/supported",name:"types"},jquery:{testmodules:[],resourceURL:"resources/jquery/",name:"jquery",type:"plugins/thirdparty"},embedded:{testmodules:[],dependencies:{theme_manager:"0.0.0",text_editor:"0.0.0",appconfig:"0.0.0",edit_session:"0.0.0",screen_theme:"0.0.0"},resourceURL:"resources/embedded/",name:"embedded",type:"plugins/supported"},
settings:{resourceURL:"resources/settings/",description:"Infrastructure and commands for managing user preferences",share:true,dependencies:{types:"0.0"},testmodules:[],provides:[{description:"Storage for the customizable Bespin settings",pointer:"index#settings",ep:"appcomponent",name:"settings"},{indexOn:"name",description:"A setting is something that the application offers as a way to customize how it works",register:"index#addSetting",ep:"extensionpoint",name:"setting"},{description:"A settingChange is a way to be notified of changes to a setting",
ep:"extensionpoint",name:"settingChange"},{pointer:"commands#setCommand",description:"define and show settings",params:[{defaultValue:null,type:{pointer:"settings:index#getSettings",name:"selection"},name:"setting",description:"The name of the setting to display or alter"},{defaultValue:null,type:{pointer:"settings:index#getTypeSpecFromAssignment",name:"deferred"},name:"value",description:"The new value for the chosen setting"}],ep:"command",name:"set"},{pointer:"commands#unsetCommand",description:"unset a setting entirely",
params:[{type:{pointer:"settings:index#getSettings",name:"selection"},name:"setting",description:"The name of the setting to return to defaults"}],ep:"command",name:"unset"}],type:"plugins/supported",name:"settings"},appconfig:{resourceURL:"resources/appconfig/",description:"Instantiates components and displays the GUI based on configuration.",dependencies:{jquery:"0.0.0",canon:"0.0.0",settings:"0.0.0"},testmodules:[],provides:[{description:"Event: Fired when the app is completely launched.",ep:"extensionpoint",
name:"appLaunched"}],type:"plugins/supported",name:"appconfig"},syntax_worker:{resourceURL:"resources/syntax_worker/",description:"Coordinates multiple syntax engines",environments:{worker:true},dependencies:{syntax_directory:"0.0.0",underscore:"0.0.0"},testmodules:[],type:"plugins/supported",name:"syntax_worker"},screen_theme:{resourceURL:"resources/screen_theme/",description:"Bespins standard theme basePlugin",dependencies:{theme_manager:"0.0.0"},testmodules:[],provides:[{url:["theme.less"],ep:"themestyles"},
{defaultValue:"@global_font",ep:"themevariable",name:"container_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"container_font_size"},{defaultValue:"@global_container_background",ep:"themevariable",name:"container_bg"},{defaultValue:"@global_color",ep:"themevariable",name:"container_color"},{defaultValue:"@global_line_height",ep:"themevariable",name:"container_line_height"},{defaultValue:"@global_pane_background",ep:"themevariable",name:"pane_bg"},{defaultValue:"@global_pane_border_radius",
ep:"themevariable",name:"pane_border_radius"},{defaultValue:"@global_form_font",ep:"themevariable",name:"form_font"},{defaultValue:"@global_form_font_size",ep:"themevariable",name:"form_font_size"},{defaultValue:"@global_form_line_height",ep:"themevariable",name:"form_line_height"},{defaultValue:"@global_form_color",ep:"themevariable",name:"form_color"},{defaultValue:"@global_form_text_shadow",ep:"themevariable",name:"form_text_shadow"},{defaultValue:"@global_pane_link_color",ep:"themevariable",name:"pane_a_color"},
{defaultValue:"@global_font",ep:"themevariable",name:"pane_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"pane_font_size"},{defaultValue:"@global_pane_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_pane_h1_font",ep:"themevariable",name:"pane_h1_font"},{defaultValue:"@global_pane_h1_font_size",ep:"themevariable",name:"pane_h1_font_size"},{defaultValue:"@global_pane_h1_color",ep:"themevariable",name:"pane_h1_color"},{defaultValue:"@global_font_size * 1.8",
ep:"themevariable",name:"pane_line_height"},{defaultValue:"@global_pane_color",ep:"themevariable",name:"pane_color"},{defaultValue:"@global_text_shadow",ep:"themevariable",name:"pane_text_shadow"},{defaultValue:"@global_font",ep:"themevariable",name:"button_font"},{defaultValue:"@global_font_size",ep:"themevariable",name:"button_font_size"},{defaultValue:"@global_button_color",ep:"themevariable",name:"button_color"},{defaultValue:"@global_button_background",ep:"themevariable",name:"button_bg"},{defaultValue:"@button_bg - #063A27",
ep:"themevariable",name:"button_bg2"},{defaultValue:"@button_bg - #194A5E",ep:"themevariable",name:"button_border"},{defaultValue:"@global_control_background",ep:"themevariable",name:"control_bg"},{defaultValue:"@global_control_color",ep:"themevariable",name:"control_color"},{defaultValue:"@global_control_border",ep:"themevariable",name:"control_border"},{defaultValue:"@global_control_border_radius",ep:"themevariable",name:"control_border_radius"},{defaultValue:"@global_control_active_background",
ep:"themevariable",name:"control_active_bg"},{defaultValue:"@global_control_active_border",ep:"themevariable",name:"control_active_border"},{defaultValue:"@global_control_active_color",ep:"themevariable",name:"control_active_color"},{defaultValue:"@global_control_active_inset_color",ep:"themevariable",name:"control_active_inset_color"}],type:"plugins/supported",name:"screen_theme"}})})})();
(function(){var x=bespin.tiki.require("jquery").$,s=function(u,q,f){u=u.style[f]||document.defaultView.getComputedStyle(u,"").getPropertyValue(f);if(!u||u=="auto"||u=="intrinsic")u=q.style[f];return u};bespin.useBespin=function(u,q){var f=bespin.tiki.require("bespin:util/util"),e={},d=e.settings;q=q||{};for(var b in q)e[b]=q[b];q=e.settings;if(d!==undefined)for(b in d)if(q[b]===undefined)e.settings[b]=d[b];var j=null,i=new (bespin.tiki.require("bespin:promise").Promise);bespin.tiki.require.ensurePackage("::appconfig",
function(){var g=bespin.tiki.require("appconfig");if(f.isString(u))u=document.getElementById(u);if(f.none(e.initialContent))e.initialContent=u.value||u.innerHTML;u.innerHTML="";if(u.type=="textarea"){var k=u.parentNode,m=document.createElement("div"),p=function(){var v="position:relative;";["margin-top","margin-left","margin-right","margin-bottom"].forEach(function(F){v+=F+":"+s(u,m,F)+";"});var h=s(u,m,"width"),A=s(u,m,"height");v+="height:"+A+";width:"+h+";";v+="display:inline-block;";m.setAttribute("style",
v)};window.addEventListener("resize",p,false);p();for(u.nextSibling?k.insertBefore(m,u.nextSibling):k.appendChild(m);k!==document;){if(k.tagName.toUpperCase()==="FORM"){var y=k.onsubmit;k.onsubmit=function(v){u.value=j.editor.value;u.innerHTML=j.editor.value;y&&y.call(this,v)};break}k=k.parentNode}u.style.display="none";e.element=m;if(!f.none(u.getAttribute("readonly")))e.readOnly=true}else e.element=u;g.launch(e).then(function(v){j=v;i.resolve(v)})});return i};x(document).ready(function(){for(var u=
[],q=document.querySelectorAll(".bespin"),f=0;f<q.length;f++){var e=q[f],d=e.getAttribute("data-bespinoptions")||"{}";d=bespin.useBespin(e,JSON.parse(d));d.then(function(b){e.bespin=b},function(b){throw new Error("Launch failed: "+b);});u.push(d)}if(window.onBespinLoad){q=bespin.tiki.require("bespin:promise").group;q(u).then(function(){window.onBespinLoad()},function(){throw new Error("At least one Bespin failed to launch!");})}})})();
